(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[245],{1227:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);n(1227),n(302);var i=n(0),r=n(3),a=n(8);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$.extend(this,new a.a),this.data=t,this.timer=null}var t,i,r;return t=e,(i=[{key:"render",value:function(){var e=n(1228);$(".room-energy .energy-main .record-box").html(e({data:this.data}))}},{key:"show",value:function(){var e=this;this.render(),this.timer=setTimeout((function(){clearTimeout(e.timer),e.emit("end")}),5e3)}},{key:"stop",value:function(){clearTimeout(this.timer)}}])&&o(t.prototype,i),r&&o(t,r),e}();function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$.extend(this,new a.a),this.list=[],this.current=null}var t,n,i;return t=e,(n=[{key:"add",value:function(e){var t=this;e.on("end",(function(){t.current=null,t.current=t.list.shift(),t.current&&t.emit("show")})),this.current?this.list.push(e):(this.current=e,this.emit("show"))}},{key:"clear",value:function(){this.current&&this.current.stop()&&(this.current=null),this.list=[]}}])&&f(t.prototype,n),i&&f(t,i),e}());function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var w=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$.extend(this,new a.a);var t=window.sessionStorage.getItem("propsDict");this.giftShelf=JSON.parse(t),this.data={},this.addListener()}var t,n,o;return t=e,(n=[{key:"pushRecord",value:function(e){var t=[];t=t.concat(e);var n=this.data.mAwardPoolGiftInfo.value[1].sItemName;for(var i in t){var r=t[i];c.add(new u(d(d({},r),{recordGift:n})))}}},{key:"showBigAward",value:function(){this.data.tBigAwardRemainTimeInfo.iTime>0&&this.emit("notice:bigAward")}},{key:"init",value:function(){var e=this;i.default.ready((function(e){e.registerGroup("comm:giftInventServer")})),new Promise((function(e,t){i.default.isH5&&i.default.ready((function(t){var n=new t.taf.HUYA.GiftInventGetPanelInfoReq;n.tId=t.userId,n.lPid=r.default.lp,t.sendWup2("revenueui","getAwardPoolPanelInfo",n,(function(t){e(t)}))}))})).then((function(t){e.data={tAwardPoolInfo:t.tAwardPoolInfo,tAwardPoolCountDown:t.tAwardPoolCountDown,mAwardPoolGiftInfo:t.mAwardPoolGiftInfo,tBigAwardRemainTimeInfo:t.tBigAwardRemainTimeInfo,tParticipateItemInfo:t.tParticipateItemInfo},e.emit("update:initialize"),e.emit("update:countdown"),e.pushRecord(t.vPrizeUserList.value),e.showBigAward()}))}},{key:"getRankListReq",value:function(e){var t="user"==e?2:1;return new Promise((function(e,n){var r;(r=t,new Promise((function(e,t){i.default.isH5&&i.default.ready((function(t){var n=new t.taf.HUYA.GetGiftInventRankListReq;n.tId=t.userId,n.iRankType=r,t.sendWup2("revenueui","getGiftInventRankList",n,(function(t){e(t)}))}))}))).then((function(n){var i=1==t?n.vPresenterRankInfo.value:n.vUserRankInfo.value;e(i)}))}))}},{key:"sendGift",value:function(e){var t=this.data.tParticipateItemInfo.iItemType;i.default.call("giveGift",{num:e,fromType:1,type:t})}},{key:"addListener",value:function(){var e=this;TT.getUserInfo().done((function(t){i.default.isH5&&i.default.ready((function(n){n.addTafListener("1030005",(function(t){TT.log("-----------------结构体GiftInventSmallPrizeInfoPush，小奖池中奖广播",t),e.pushRecord(t.tPrizeUserInfo)})),n.addTafListener("1030006",(function(n){TT.log("-----------------结构体GiftInventSmallPrizeInfoPush，小奖池中奖单播",n),n.tPrizeUserInfo.lUid==t.uid&&e.emit("notice:smallAward",n)})),n.addTafListener("1030007",(function(t){TT.log("-----------------结构体GiftInventBigAwardRemainTimeInfo，大奖池中奖广播",t),e.data.tBigAwardRemainTimeInfo=t,e.showBigAward()})),n.addTafListener("1030009",(function(t){TT.log("-----------------结构体GiftInventBigAwardPoolInfo，大奖池奖池总额有一定变化后广播",t),e.data.tAwardPoolInfo=t,e.emit("update:bigAward")})),n.addTafListener("1030010",(function(t){TT.log("-----------------结构体GiftInventBigAwardPoolCountDown，大奖池倒计时状态改变推送广播",t),e.data.tAwardPoolCountDown=t,e.emit("update:countdown")})),n.addTafListener("6501",(function(n){try{t.uid==n.lSenderUid&&e.data.tParticipateItemInfo.iItemType==n.iItemType&&e.emit("notice:sendGift")}catch(e){}}))}))}))}},{key:"quit",value:function(){i.default.ready((function(e){e.unRegisterGroup("comm:giftInventServer")}))}}])&&v(t.prototype,n),o&&v(t,o),e}()),m=n(1229),h=n.n(m),g=n(1230),p=n.n(g);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function A(e){for(var t=(e+"").split(""),n="",i=0;i<t.length;i++)n+='<b class="room-energy-n n-'+t[i]+'"></b>';return n}var k=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isShow=!1,this.$view=null,this.countdownTimer=null,this.addListen()}var t,i,r;return t=e,(i=[{key:"initialize",value:function(){this.isShow?(clearTimeout(this.countdownTimer),this.isShow=!1,this.$view.remove()):(this.isShow=!0,w.init())}},{key:"render",value:function(){var e=n(1231);this.$view=$(e({stageGift:h.a,defaultAward:p.a,data:w.data,giftShelf:w.giftShelf,createN:A})),$("body").append(this.$view),this.bindEvent()}},{key:"renderRank",value:function(e){var t=n(1232),i=this.$view.find(".energy-rank");w.getRankListReq(e).then((function(n){var r;i.html(t({tab:e,data:n})).show(),r={scrollbarWidth:6,mouseWheelSpeed:20,verticalGutter:0,isOutsideNotPrevent:!1},$(".room-energy .energy-rank .rank-box").each((function(){var e=$(this).data("jsp");e?e.reinitialise():$(this).jScrollPane(r)}))}))}},{key:"renderCountDown",value:function(){var e=this,t=n(1233);if(this.$view){var i=this.$view.find(".energy-main .energy-tips"),r=w.data.tAwardPoolCountDown;if(i.html(t({data:w.data})),1==r.iStatus&&r.iSeconds>0){clearTimeout(this.countdownTimer);var a=parseInt(+new Date/1e3)+r.iSeconds;!function t(){var n=a-parseInt(+new Date/1e3),r=e.$view.find(".energy-timer");if(n<0)return i.text("开奖中，请稍后"),void r.text("");var o=parseInt(n/60),u=n%60,f=(o=o<10?"0"+o:o)+":"+(u=u<10?"0"+u:u);r.text(f),e.countdownTimer=setTimeout((function(){t()}),1e3)}()}}}},{key:"renderBigAward",value:function(){var e=n(1234);this.$view&&this.$view.find(".energy-stage").html(e({createN:A,stageGift:h.a,data:w.data}))}},{key:"showSmallAward",value:function(e){var t=n(1235);this.$view.find(".energy-main").append(t({defaultAward:p.a,sendGiftInfo:w.giftShelf[w.data.tParticipateItemInfo.iItemType],award:b(b({},e),{awardImg:w.giftShelf[w.data.mAwardPoolGiftInfo.value[2].iItemType].vPropsIdentity.value[0].sPropsPic24.replace("&","?"),awardName:w.data.mAwardPoolGiftInfo.value[2].sItemName})}))}},{key:"showBigAward",value:function(){var e=n(1236),t=w.data.tBigAwardRemainTimeInfo;this.$view.find(".energy-main").append(e({createN:A,defaultAward:p.a,award:b(b({},t),{awardName:w.data.mAwardPoolGiftInfo.value[1].sItemName})}))}},{key:"sendGift",value:function(e){w.sendGift(e)}},{key:"addListen",value:function(){var e=this;w.on("update:initialize",(function(){e.render()})),w.on("update:bigAward",(function(){e.renderBigAward()})),w.on("update:countdown",(function(){e.renderCountDown()})),w.on("notice:smallAward",(function(t){e.showSmallAward(t.tPrizeUserInfo)}));var t=null;w.on("notice:bigAward",(function(){clearTimeout(t);var n=w.data.tBigAwardRemainTimeInfo;e.showBigAward(),clearTimeout(t),t=setTimeout((function(){var t=e.$view.find(".energy-bigAward");t&&t.remove()}),1e3*n.iTime)}));var n=null;w.on("notice:sendGift",(function(){e.$view&&e.$view.find(".energy-toase").stop().show(),clearTimeout(n),n=setTimeout((function(){e.$view&&e.$view.find(".energy-toase").fadeOut()}),1e3)})),c.on("show",(function(){c.current.show()}))}},{key:"bindEvent",value:function(){var e=this,t=this;this.$view.on("click",".j_energy-close",(function(){e.isShow=!1,e.$view&&e.$view.remove()})).on("click",".j_rank",(function(){e.$view[0].setAttribute("data-current","rank"),e.renderRank("anchor")})).on("click",".energy-rank .btn-back",(function(){e.$view[0].setAttribute("data-current","main")})).on("click",".energy-rank .rank-tab-item",(function(){var e=$(this);if(!e.hasClass("current")){var n=e.data("tab");t.renderRank(n)}})).on("click",".energy-gift-count .icon-arrow",(function(){t.$view.find(".energy-amount-list").toggle(),$(this).hasClass("open")?$(this).removeClass("open"):$(this).addClass("open")})).on("change",".energy-gift-count .gift-amount",(function(){var e=$(this),t=e.val();t=NaN==parseInt(t)||t<1?1:t>9999?9999:t,e.val(t)})).on("click",".energy-amount-list .amount-item",(function(){var e=$(this).data("val");t.$view.find(".energy-gift-count .gift-amount").val(e),t.$view.find(".energy-amount-list").hide(),t.$view.find(".energy-gift-count .icon-arrow").removeClass("open")})).on("click",".j_btn-send",(function(){var n=t.$view.find(".energy-gift-count input.gift-amount").val();NaN!=parseInt(n)&&e.sendGift(n),e.$view.find(".energy-amount-list").hide(),e.$view.find(".energy-gift-count .icon-arrow").removeClass("open")})).on("click",".smallAward-close",(function(){$(this).parents(".energy-smallAward").remove()}))}}])&&I(t.prototype,i),r&&I(t,r),e}();window.enertyModel=w;t.default=new k}}]);