(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[293],{1287:function(t,e,a){"use strict";var n=a(8),i=a(3);function o(t,e){var a=new n.a;return a.team=0,a.update=function(t){t!=a.team&&(a.team=t,a.emit("change",t))},a.to=function(n){var i=new $.Deferred;if(n==a.team)return i.resolve(n);return $.ajax({type:"GET",url:"//activityapi.huya.com/camp/joinCamp",dataType:"jsonp",data:{mid:t,sid:e,cid:n}}).done((function(t){200==t.status&&t.data?(a.update(n),i.resolve(n)):i.reject(t.status,t.msg)})).fail((function(t,e){i.reject(e,"网络请求失败")})),i},a.destory=function(){a.off("change")},a._initState=new $.Deferred,a.initStateReady=function(t){return a._initState.done(t)},a.fetchRemoteState=function(){return $.ajax({url:"//activityapi.huya.com/camp/getUserCamp",type:"GET",dataType:"jsonp",data:{mid:t,sid:e}})},a}function p(t,e){var a=new n.a;a.pop={red:0,blue:0},a.gift={red:0,blue:0},a.giftOpenState=0,a.update=function(t){a.pop.red=parseInt(t.red+"",10),a.pop.blue=parseInt(t.blue+"",10),a.gift.red=parseInt(t.gold_red+"",10),a.gift.blue=parseInt(t.gold_blue+"",10);var e=a.giftOpenState,n=a.giftOpenState=t.gold_online;a.emit("change"),e!=n&&a.emit("change:openState",n,e)};var i={abort:function(){}};a.fetchRemoteData=function(){return i=$.ajax({type:"GET",url:"//activityapi.huya.com/cache/camp/getMatchCampStat",dataType:"jsonp",jsonpCallback:"getMatchCampStatCallback",data:{mid:t,sid:e},cache:!0}).done((function(t){t&&200==t.status&&t.data&&a.update(t.data)}))};var o=null;return-1!=e&&(o=setInterval((function(){a.fetchRemoteData()}),3e4)),a.destory=function(){i.abort(),clearInterval(o),a.off("change"),a.off("change:openState")},a}e.a=new function(t,e,a){var i=new n.a,r=t?t.id:-1;i.info={sid:r,teams:t,support:new o(e,r),pk:new p(e,r)},-1==r?i.info.support._initState.resolve(0):(TT.getUserInfo((function(t){t.isLogined?i.info.support.fetchRemoteState().done((function(t){200==t.status?(i.info.support.update(t.data),i.info.support._initState.resolve(t.data)):i.info.support._initState.resolve(0)})).fail((function(){i.info.support._initState.resolve(0)})):i.info.support._initState.resolve(0)})),i.info.pk.fetchRemoteData());return i.update=function(t){var a=t?t.id:-1;a!=i.info.sid&&(i.info.support.destory(),i.info.pk.destory(),i.info={sid:a,teams:t,support:new o(e,a),pk:new p(e,a)},i.info.support._initState.resolve(0),i.emit("change",i.info))},setInterval((function(){$.ajax({type:"GET",url:TT.app.main+"cache.php?m=InternationMatchApi&do=getMatchNotice",dataType:"json",data:{mid:e,liveUid:a}}).done((function(t){t&&200==t.status&&i.update(t.data?t.data[0]:null)}))}),35e3),i}(G_info.camp,G_info.mid,i.default.lp)}}]);