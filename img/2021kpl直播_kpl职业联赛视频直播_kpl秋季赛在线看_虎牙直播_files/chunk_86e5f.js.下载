(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[500],{101:function(e,t,a){"use strict";a.r(t);a(738);var n=a(3),i=a(2),s=a(0),r=a(4),o=a.n(r),d=a(8),c=a(33),u=a.n(c),l=a(739),f=a.n(l),p=a(740),v=a.n(p),h=a(741),g=a.n(h),y=a(742),m=a.n(y),w=a(743),T=a.n(w),I=a(744),C=a.n(I),N=a(745),b=a.n(N),P=a(746),D=a.n(P),z=a(747),k=a.n(z),S=a(748),R=a.n(S);
/*!
 * 藏宝箱
 * prd: https://svn.yy.com/dwjs/huya/001产品文档/02-web端/v4.4版本/Web端接入藏宝图道具.docx
 */
function x(e){$.extend(this,new d.a);this.state="READY",this.data=$.extend({},e),this.type=this.data.type,this.name=this.data.name,this.delay=this.data.delay}x.prototype={delay:180,duration:15,start:function(){var e=this;if("READY"===e.state)switch(e.state="START",e.emit("stateChange",e.state),e.data.state){case"CD":e.countdown(e.delay);break;case"ING":e.open(e.duration);break;case"ED":e.ed();break;default:e.countdown(e.delay)}},countdown:function(e){var t=this;t.state="CD",t.emit("stateChange",t.state);var a=e,n=e;t.emit("cd",a,n),t.cdInterval=setInterval((function(){a--,t.emit("cd",a,n),a<=0&&(clearInterval(t.cdInterval),t.open(t.duration))}),1e3)},open:function(e){var t=this;t.state="ING",t.emit("stateChange",t.state)},end:function(){var e=this;clearInterval(e.cdInterval),e.state="END",e.emit("stateChange",e.state)},ed:function(){var e=this;e.state="ED",e.emit("stateChange",e.state)},draw:function(){if("ING"===this.state){var e=this;TT.sudo((function(){s.default.ready((function(e){s.default.isH5?TT.getUserInfo((function(t){var a=new e.taf.HUYA.TreasureLotteryDrawReq;$.extend(a,{tId:e.userId,sStarterNick:t.userNick,lSid:i.default.id,lSubSid:i.default.sid,lPid:n.default.lp,lRoomId:i.default.profileRoom,iFromType:5}),e.sendWup2("PropsUIServer","sendTreasureLotteryDraw",a,E)})):(s.default.one("treasureLotteryDrawRsp",(function(e){E(e.param)})),e.callAs("treasureLotteryDrawReq"))})),e.ed()}))}}};var A=function(){$.extend(this,new d.a),this.list=[],this.size=0};A.prototype.enqueue=function(e){this.list=this.list.concat(e),this.size=this.list.length,this.emit("change",1)},A.prototype.dequeue=function(){if(!(this.size<=0)){this.list.shift();this.size=this.list.length,this.emit("change",0)}};var _=o.a.once((function(){return new $.Deferred((function(e){s.default.on("getGifObj",(function(t){for(var a=$.isArray(t.param)?t.param:t.param.vPropsItemList.value,n={},i=0,s=a.length;i<s;i++)n[a[i].iPropsId]=a[i];e.resolve(n,a)}),!0)}))}));function q(e,t){var a={giftId:12,png:f.a,gif:v.a},n={1:a,2:{giftId:20279,png:g.a,gif:m.a},3:{giftId:20267,png:T.a,gif:C.a},4:{giftId:20269,png:b.a,gif:D.a},5:{giftId:20291,png:k.a,gif:R.a}},i=[];function s(e,t){var s=n[e]||a;try{s={giftId:t,png:i[t].vPropsIdentity.value[0].sPropWebStaticDown,gif:i[t].vPropsIdentity.value[0].sPropWebDynamicDown}}catch(e){}return s}_().done((function(e){function t(t){var a=n[t].giftId;return e[a]&&e[a].vPropsIdentity&&e[a].vPropsIdentity.value[0]?{png:e[a].vPropsIdentity.value[0].sPropWebStaticDown||n[t].png,gif:e[a].vPropsIdentity.value[0].sPropWebDynamicDown||n[t].gif}:n[t]}i=e,n=$.extend(n,{1:t(1),2:t(2),3:t(3),4:t(4),5:t(5)})}));var r=$('<div class="liveRoom_treasureChest"><div class="box"><img src="'+s(e.type,e.data.gift).png+'" alt="宝箱" /></div><i class="num"></i><p class="btn-wrap"><span class="btn">loading</span></p><div class="waitTips"><p class="tit"><span class="nick">'+H(e.data.senderNick)+'</span><span class="aName">的'+e.name+'</span></p><div class="cont"><p>领取还未开始，请耐心等待~</p><p>多发弹幕可提高中奖概率哦！</p></div><i class="arrow"></i></div></div>');function o(a){var n=r.find(".btn");if(HUYA_UTIL.getCookieVal("udb_uid")){if("CD"===a&&e.on("cd",(function(e,t){var a=Math.floor(e/60),i=e%60;n.text((a<10?"0":"")+a+":"+(i<10?"0":"")+i)})),"ING"===a&&(r.find("img")[0].src=s(e.type,e.data.gift).gif,n.addClass("usable").text("领取"),n.on("click",(function(t){t.preventDefault(),e.draw();try{ya.reportProductEvent({eid:"click/zhibo/treasure/lq/"+e.type,eid_desc:"点击/直播间/藏宝箱/领取/"+e.name})}catch(t){}}))),"ED"===a){n.removeClass("usable").addClass("disable").text("已领取");var i=t.size-1;r.find(".num").text(i)[i>0?"show":"hide"]()}}else n.addClass("usable").text("登录领取").on("click",(function(e){e.preventDefault(),TT.login.login()}))}function d(){var a="ED"===e.state?t.size-1:t.size;r.find(".num").text(a)[a>1?"show":"hide"]()}r.on("mouseenter",(function(t){"CD"===e.state&&r.find(".waitTips").show()})).on("mouseleave",(function(e){r.find(".waitTips").hide()})),d(),e.on("stateChange",o),t.on("change",d),$("#J_treasureChestContainer").append(r),$.extend(this,{loading:function(){r.find("img")[0].src=s(e.type,e.data.gift).png,r.find(".btn").removeClass("usable disable").text("loading")},fadeOut:function(){r.hide(500)},destroy:function(){e.off("stateChange",o),t.off("change",d),r.remove()}})}function E(e){e.iPrizeType<=0?a.e(10).then(a.bind(null,24)).then((function(e){var t=e.default.layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<p class="tct-cont">手气不佳，你没有领取到奖励~</p>',"</div>",NaN].join(""),lock:!1});setTimeout((function(){t.close()}),3e3)})):6==e.iPrizeType||9==e.iPrizeType||14==e.iPrizeType?a.e(10).then(a.bind(null,24)).then((function(t){var a=t.default.layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<i class="tct-icon"></i>','<div class="tct-cont">','<p>恭喜你获得<em class="tct-prize">'+e.sPrizeName+"</em>！</p>",'<p class="tct-ps">奖励已存入'+(14==e.iPrizeType?'<a target="_blank" href="'+TT.app.i+'index.php?m=MyGift&do=listMyGift">我的福利</a>':"包裹")+"中，快去查看吧~</p>","</div>","</div>",'<a class="tct-x" href="#"></a>',NaN].join(""),lock:!1});a.view.find(".tct-x").on("click",(function(e){e.preventDefault(),a.close()}))})):a.e(10).then(a.bind(null,24)).then((function(t){var a=t.default.layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<i class="tct-icon"></i>','<p class="tct-cont">恭喜你获得<em class="tct-prize">'+e.sPrizeName+"</em>！</p>","</div>",NaN].join(""),lock:!1});setTimeout((function(){a.close()}),3e3)}))}function U(e){var t=['<div class="treasureChest-winningRecord">','<span class="treasureChest-winningRecord-user">'+H(e.sUserNick)+"</span>"," 获得 ",'<span class="treasureChest-winningRecord-sender">'+H(e.sStarterNick)+"</span>"," 派送的 ",'<span class="treasureChest-winningRecord-prize">'+H(e.sPrizeName)+"</span>","</div>"].join("");u.a.append((function(e,a){var n=document.createElement("div");return n.innerHTML=t,n}))}function H(e){return"string"!=typeof e?e:e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")}var L=o.a.once((function(e){try{console.log("前端: queryTreasureInfoRsp.iQueneSize:"+e.iQueneSize)}catch(e){}var t=new A,a=null,n=null;function i(e){n&&n.destroy(),a=new x(e),n=new q(a,t),a.on("stateChange",(function(e){if("END"===e)if(t.dequeue(),t.size>0)n.loading();else{var a=n;a.fadeOut(),setTimeout((function(){a.destroy()}),600),n=null}})),a.start()}function r(e){switch(TT.log("前端: treasureUpdateNotice.iState:"+e.iState),e.iState){case 1:i({delay:e.iCountDown,senderNick:e.sSendNick,type:e.iTreasureType,gift:e.iItemType,name:e.sTreasureName});break;case 2:a&&a.end();break;case 3:var n=e.iQueneSize-t.size;n&&n>0&&t.enqueue(new Array(n))}}e.iQueneSize>0&&(t.enqueue(new Array(e.iQueneSize)),i({state:["","CD","ING","ED"][e.iStatus],delay:e.iCountDown,senderNick:e.sNickName,type:e.iTreasureType,gift:e.iItemType,name:e.sTreasureName})),s.default.isH5?s.default.ready((function(e){e.addTafListener("6604",r)})):s.default.on("treasureUpdateNotice",(function(e){r(e.param)}))}));s.default.isH5?s.default.ready((function(e){var t=new e.taf.HUYA.QueryTreasureInfoReq;$.extend(t,{tId:e.userId,lSid:i.default.id,lSubSid:i.default.sid,lPid:n.default.lp,lRoomId:i.default.profileRoom,iFromType:5}),e.sendWup2("liveui","queryTreasure",t,L)})):(s.default.one("queryTreasureInfoRsp",(function(e){L(e.param)}),!0),s.default.ready((function(){s.default.call("queryTreasureInfoReq")}))),s.default.isH5?s.default.ready((function(e){e.addTafListener("6605",U)})):s.default.on("treasureLotteryResultNotice",(function(e){U(e.param)}))},738:function(e,t,a){}}]);