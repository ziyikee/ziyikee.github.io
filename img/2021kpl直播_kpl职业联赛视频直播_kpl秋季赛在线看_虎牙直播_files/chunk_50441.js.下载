(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[175],{506:function(t,i,n){"use strict";t.exports=n(507)},507:function(t,i,n){"use strict";var e=n(508),o=n(526);function s(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var r,a=s(e),c=s(o);function d(){const t=navigator.userAgent,i="Win32"==navigator.platform||"Windows"==navigator.platform,n="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(n)return r.Mac;if("X11"==navigator.platform&&!i&&!n)return r.Unix;if(String(navigator.platform).indexOf("Linux")>-1)return r.Linux;if(i){if(t.indexOf("Windows NT 5.0")>-1||t.indexOf("Windows 2000")>-1)return r.Win2000;if(t.indexOf("Windows NT 5.1")>-1||t.indexOf("Windows XP")>-1)return r.WinXP;if(t.indexOf("Windows NT 5.2")>-1||t.indexOf("Windows 2003")>-1)return r.Win2003;if(t.indexOf("Windows NT 6.0")>-1||t.indexOf("Windows Vista")>-1)return r.WinVista;if(t.indexOf("Windows NT 6.1")>-1||t.indexOf("Windows 7")>-1)return r.Win7;if(t.indexOf("Windows NT 10")>-1||t.indexOf("Windows 10")>-1)return r.Win10}return r.other}!function(t){t.Mac="Mac",t.Unix="Unix",t.Linux="Linux",t.Win2000="Win2000",t.WinXP="WinXP",t.Win2003="Win2003",t.WinVista="WinVista",t.Win7="Win7",t.Win10="Win10",t.other="other"}(r||(r={}));class f{constructor(t){this.list=[],this.len=0,this.push=(...t)=>{this.list.push(...t);const i=this.list.length;i>this.len&&(this.list=this.list.slice(i-this.len))},this.pop=()=>this.list.pop(),this.getListData=()=>this.list,this.len=t}}const l={appVersion:"",anchorId:"0",subsid:"0",appId:"200",isP2p:!1};class p{constructor(t){this.moduleMap={},this.setFbModule=(t,i=0)=>(this.moduleMap[t]||(this.moduleMap[t]={},this.moduleMap[t][p.limitModule]=new f(i)),this.moduleMap[t]),this.getFbModule=t=>this.moduleMap[t],this.report=async t=>{const i={errorText:t.errorText,content:t.content,appVersion:this.initOpt.appVersion,anchorId:""+this.initOpt.anchorId,subsid:""+this.initOpt.subsid,isP2p:this.initOpt.isP2p,appId:""+this.initOpt.appId},n=await function(t){const i=c.get("yyuid")||0,n=c.get("guid")||0,e=new FormData,o={fbType:t.errorText,fbDetails:t.content||t.errorText,uid:i,gid:n,device:d(),appVersion:t.appVersion,deviceType:1,anchorId:t.anchorId,ssid:t.subsid,appId:t.appId,isp2p:t.isP2p?1:0};for(let[t,i]of Object.entries(o)){if("object"==typeof i)try{i=JSON.stringify(i)}catch(t){console.error("getFbId catch error",t)}e.append(t,""+i)}return a.post("//ffilelogapp.huya.com/addFeedBack",e).then(t=>{const{result:i,fbId:n}=t.data;if(1===i)return console.info("获取fbid成功"),n;console.info("获取fbid失败, result:",i)}).catch(t=>{console.error("获取fbid出错:",t)})}(i);if(n){const t=this.handleInfoData();if(await function(t){const{log:i={},feedbackId:n}=t;let e=0;try{e=function(t){const i=t.length;let n=0;for(let e=0;e<i;e++){const i=t.charCodeAt(e);i>=1&&i<=126||65376<=i&&i<=65439?n++:n+=2}return n}(JSON.stringify(i))}catch(t){console.error("getLog length error:",t)}const o={feedbackId:n,log:i,fileSize:e},s=new FormData;for(let[t,i]of Object.entries(o)){let n="";if("object"==typeof i)try{n=JSON.stringify(i)}catch(t){console.error("getFbId catch error",t)}else n=""+i;s.append(t,""+n)}return a.post("//ffilelogupload.huya.com/uploadStringLog",s).then(({data:t})=>{const{status:i}=t;if(200===i)return console.info("上传日志成功!"),!0;console.info("上传日志失败")}).catch(t=>{console.error("上传日志出错",t)})}({feedbackId:n,log:t}))return Promise.resolve({isSuccess:!0,info:"反馈成功"})}return Promise.reject({isSuccess:!1,info:"反馈失败"})},this.handleInfoData=()=>{const t=Object.keys(this.moduleMap),i={};return t.forEach(t=>{const n=this.moduleMap[t],e=Object.keys(n);i[t]={},e.forEach(n=>{i[t][n]=n===p.limitModule?this.moduleMap[t][n].getListData():this.moduleMap[t][n]})}),i},this.initOpt={...l,...t}}}p.limitModule="$$feedbackLimitModule",t.exports=p}}]);