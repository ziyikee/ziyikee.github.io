(window.HUYA_MAIN_BASE_WEBPACK_JSONP=window.HUYA_MAIN_BASE_WEBPACK_JSONP||[]).push([[17],{354:function(e,t,n){"use strict";n.r(t);n(332);!function(e){function t(){var e=new $.Deferred((function(e){$.ajax({url:TT.app.main+"cache.php?m=Nav&do=ajaxGetHotMatch",type:"get",dataType:"jsonp",jsonpCallback:"huyaNavHotMatch",cache:!0}).done((function(t){var n=t.data;n?((!n.matchLives||!n.matchLives.length)&&(n.matchLives=[]),(!n.matchReplays||!n.matchReplays.length)&&(n.matchReplays=[]),(!n.matchNotices||!n.matchNotices.length)&&(n.matchNotices=[])):n={matchLives:[],matchReplays:[],matchNotices:[]},e.resolve(n)})).fail((function(){e.resolve({matchLives:[],matchReplays:[],matchNotices:[]})}))})),t=e.pipe((function(e){var t,n=$.map(e.matchNotices,(function(e,t){if(1!=e.liveState)return e.eventId}));return t=n,new $.Deferred((function(e){TT.getUserInfo((function(n){0!=n.uid&&t.length?$.ajax({url:"//upevent.huya.com/getSubscribeState",type:"get",dataType:"jsonp",data:{event_ids:t.join(","),uid:n.uid}}).done((function(t){0==t.code&&t.data&&t.data.length?e.resolve(t.data):e.resolve([])})).fail((function(){e.resolve([])})):e.resolve([])}))}))})),n=new $.Deferred((function(c){$.when(e,t).done((function(e,t){if("rejected"!=n.state()){var o=[],s={};$.each(t,(function(e,t){var n=new i(t.iEventID,t.bSubscribe);o.push(n),s[t.iEventID]=n})),c.resolve({matches:o,matchMap:s,matchView:new a(e,o,s)})}}))}));this.destroy=function(){"pending"==n.state()?n.reject():n.done((function(e){$.each(e.matches,(function(e,t){t.destroy()})),e.matchView.destroy()}))},this.ready=function(e){return n.done(e)}}function i(e,t){var n=$.extend(this,new TT.Event);n.eid=e,n.subState=t,n.subscribe=function(t){return new $.Deferred((function(i){TT.sudo((function(a){n.subState==t?i.resolve("成功"):$.ajax({url:TT.app.main+"member/index.php?m=Upcoming&do=subscribe",type:"get",dataType:"jsonp",data:{eid:e,subscribe:t?1:0,uid:a.uid}}).done((function(e){0==e.status?(n.emit("subStateChange",n.subState=t),i.resolve("成功")):i.reject(e.message)})).fail((function(e,t){i.reject("网络请求失败("+t+")")}))}))}))},n.destroy=function(){n.subscribe=function(){},n.off()}}function a(e,t,i){var a=n(333),c=$("#J_hyHdMatch");c.html(a({data:e,matchMap:i}));var o=c.find(".hy-header-match-panel");TT.getUserInfo((function(e){0!=e.uid?o.find(".J_book").each((function(){var e=$(this),t=e.data("eid"),n=i[t];function a(t){t?e.addClass("hy-header-match-preview-btn-gray").text("已预订"):e.removeClass("hy-header-match-preview-btn-gray").text("预订")}n.on("subStateChange",a),e.on("click",(function(){a(!n.subState),n.subscribe(!n.subState).reject((function(e){a(n.subState),alert("操作失败："+e)}))})),n.on("subStateChange",(function(e){if(e)try{ya.reportProductEvent({eid:"click/navi/saishi/book",eid_desc:"点击/导航/赛事/预定"})}catch(e){}}))})):o.on("click",".J_book",(function(e){e.preventDefault(),TT.login.login()}))})),$(".J_hyHdMatchSecLive").on("click","li",(function(e){var t=$(this).index();try{ya.reportProductEvent({eid:"click/navi/saishi/live/"+t,eid_desc:"点击/导航/赛事/赛事热播/位置-"+t})}catch(e){}})),$(".J_hyHdMatchSecReplay").on("click","li",(function(e){var t=$(this).index();try{ya.reportProductEvent({eid:"click/navi/saishi/replay/"+t,eid_desc:"点击/导航/赛事/赛事重播/位置-"+t})}catch(e){}})),this.destroy=function(){o.remove()}}var c=null,o=new function(){var e=$.extend(this,new TT.Event);this.visible=!1,this.elm=$("#J_hyHdMatch"),this.open=function(){e.visible||(e.visible=!0,e.elm.show(),e.emit("open"))},this.close=function(){e.visible&&(e.visible=!1,e.elm.hide(),e.emit("close"))}};o.on("open",(function(){o.elm.addClass("hy-header-loading"),(c=new t).ready((function(){o.elm.removeClass("hy-header-loading")}));try{ya.reportProductEvent({eid:"pageview/navi/saishiDiv",eid_desc:"点击/导航/赛事浮层"})}catch(e){}})),o.on("close",(function(){c.destroy(),c=null}));var s=null;$("#hy-nav-match").on("click",(function(e){try{ya.reportProductEvent({eid:"click/navi/saishi",eid_desc:"点击/导航/赛事"})}catch(e){}})),$(".hy-nav-item-match").on("mouseenter",(function(){null!==s&&clearTimeout(s),o.open()})).on("mouseleave",(function(){s=setTimeout(o.close,200)})),e.TT_HEADER_MATCH_PANEL=o}(window)}}]);