(window.TT_HD_WEBPACK_JSONP=window.TT_HD_WEBPACK_JSONP||[]).push([[42],{"cv/t":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="https://diy-front.cdn.huya.com/zt/frontpage/d5/lib_registry.html",n="JSONP_CALLBACK_LIB_GEGISTRY",o="LIB_GEGISTRY",a=86400,s=5e3;function u(t,e){return void 0===e&&(e=5e3),t&&"string"==typeof t?new Promise((function(r,i){var n=document,o=n.head||n.getElementsByTagName("head")[0]||n.documentElement,a=n.createElement("script"),s=setTimeout((function(){u(),i(new Error("Timeout"))}),e);function u(){a.onload=a.onerror=null}a.onload=function(){clearTimeout(s),u(),r(a)},a.onerror=function(){clearTimeout(s),u(),i(new Error("Error"))},a.type="text/javascript",a.async=!0,a.src=t,o.appendChild(a)})):Promise.reject(new Error('Invalid url: "'+t+'"'))}function c(){return Math.floor((new Date).getTime()/1e3)}var f=function(){function t(t,e){void 0===t&&(t=""),this.data=null,this.localStorageKey=t,this.normalize=e;var r=null;if(t)try{r=JSON.parse(""+localStorage.getItem(t))}catch(t){}r&&r.content&&"number"==typeof r.time&&(this.data={time:r.time,content:e(r.content)})}return t.prototype.save=function(t){if(t&&(this.data={time:c(),content:this.normalize(t)},this.localStorageKey))try{localStorage.setItem(this.localStorageKey,JSON.stringify(this.data))}catch(t){}},t.prototype.get=function(){if(this.data)return this.data.content},t.prototype.expired=function(t){return!(this.data&&c()-this.data.time<=t)},t}(),l=function(){function t(e){this.libMemo={},this.manifestRequst=null;var r=Object.assign({},e),n=r.loader,a=r.registryLoader,u=r.storageKey,c=r.storage,l=r.timeout;if(this.timeout="number"==typeof l?l:s,this.loader=n||t.scriptLoader,this.registryLoader=a||t.huyaDiyApiRegistryLoader,c)this.storage=c;else{var m=u&&"string"==typeof u?u:this.registryLoader===t.huyaDiyApiRegistryLoader?i:"";this.storage=new f(m&&o+"@"+m,t.manifestNormalize)}}return t.prototype.load=function(e,r){var i=this;if(!e||"string"!=typeof e)return Promise.reject(new Error("Invalid libName: '"+e+"'"));var n=Object.assign({},r),o=n.force,a=void 0!==o&&o,s=n.timeout,u=void 0===s?this.timeout:s,c=n.loader,f=void 0===c?this.loader:c;return this.loadManifest({force:a,timeout:u,cachingChecker:function(t){return!(!t[e]||i.storage.expired(t[e].maxAge))}}).then((function(r){var n=r[e];if(!n)throw new Error("cannot find the lib '"+e+"'");var o=n.url;return i.libMemo[o]||(i.libMemo[o]=t.getLib(f,n,u).then((function(t){return{lib:n,result:t}}))),i.libMemo[o]}))},t.prototype.loadManifest=function(t){var e,r=Object.assign({},t),i=r.force,n=void 0!==i&&i,o=r.timeout,a=void 0===o?this.timeout:o,s=r.cachingChecker,u=void 0===s?function(){}:s;if(n)e=this.ensureGetManifest(a);else{var c=this.storage.get();c?(e=Promise.resolve(c),!1===u(c)&&this.ensureGetManifest(a)):e=this.ensureGetManifest(a)}return e},t.prototype.ensureGetManifest=function(e){var r=this;return this.manifestRequst||(this.manifestRequst=t.getManifest(this.registryLoader,e).then((function(t){r.manifestRequst=null;try{r.storage.save(t)}catch(t){}return t})).catch((function(t){r.manifestRequst=null;var e=r.storage.get();if(e)return e;throw t}))),this.manifestRequst},t.getManifest=function(e,r){return new Promise((function(i,n){var o=setTimeout((function(){n(new Error("RegistryLoader timeout"))}),r);Promise.resolve("function"==typeof e?e({timeout:r}):e).then((function(e){clearTimeout(o);var r=t.manifestNormalize(e);if(!(Object.keys(r).length>0))throw new Error("manifest is not valid json");i(r)})).catch((function(t){clearTimeout(o),n(new Error("RegistryLoader error: "+(t&&t.message||"unknown")))}))}))},t.manifestNormalize=function(t){var e={};if(t&&"[object Object]"===Object.prototype.toString.call(t)){var r=t;Object.keys(r).forEach((function(t){var i=r[t];i&&("string"==typeof i?e[t]={url:i,maxAge:a}:i.url&&"string"==typeof i.url&&(e[t]=Object.assign({maxAge:a},i)))}))}return e},t.getLib=function(t,e,r){return new Promise((function(i,n){var o=setTimeout((function(){n(new Error("Loader timeout"))}),r);t({lib:e,timeout:r}).then((function(t){clearTimeout(o),i(t)})).catch((function(t){clearTimeout(o),n(new Error("Loader error: "+(t&&t.message||"unknown")))}))}))},t.scriptLoader=function(t){var e=t.lib,r=t.timeout;return u(e.url,r)},t.huyaDiyApiRegistryLoader=function(t){var e=t.timeout;return function(t,e,r){return void 0===r&&(r=5e3),new Promise((function(i,n){var o,a,s,c=window,f=c[e],l=(o=function(){c[e]=f},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return s||(s=!0,a=o.apply(void 0,t)),a}),m=setTimeout((function(){n(new Error("Timeout"))}),r);c[e]=function(t){clearTimeout(m),l(),i(t)},u(t,r).catch((function(t){clearTimeout(m),l(),n(new Error('getScript error "'+t.message+'"'))}))}))}(i,n,e)},t}();e.LibLoader=l,e.default=l}}]);