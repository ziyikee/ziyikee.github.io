(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[48],{337:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(12),i=(0,n.__importDefault)(a(3)),d=(0,n.__importDefault)(a(402)),g=function(e){function t(t,a){var n=e.call(this)||this;return n.pid=0,n.logined=!1,n.memoGetCurrentPresenterBadgeInfoReq=null,n.pid=t,n.logined=a,n.visualUsingBadge=n.usingBadge,n.setVisualUsingBadge(),n.on("update",(function(){return n.setVisualUsingBadge()})),n.on("use",(function(){return n.setVisualUsingBadge()})),n.logined&&n.listenScoreChangedNotice(),n}return(0,n.__extends)(t,e),t.prototype.getCurrentPresenterBadgeInfo=function(){return this.memoGetCurrentPresenterBadgeInfoReq||(this.memoGetCurrentPresenterBadgeInfoReq=d.default.getBadgeItem(this.pid)),this.memoGetCurrentPresenterBadgeInfoReq},t.prototype.ensureGetBadgeInfoList=function(){return this.logined?this.getBadgeInfoList():Promise.resolve({normalBadgeList:[],trialBadgeList:[],usingBadgeId:0})},t.prototype.hasUsableBadge=function(){return this.normalBadge.badgeList.length>0||null!=this.trialBadge.find(this.pid)},t.prototype.setVisualUsingBadge=function(){this.visualUsingBadge=this.usingBadge,"trial"==this.usingBadge.type&&this.usingBadge.id!=this.pid&&(this.visualUsingBadge={type:"none",id:0,name:"",info:null})},t}((0,n.__importDefault)(a(754)).default);t.default=new g(i.default.lp,!!HUYA_UTIL.getCookieVal("udb_uid"))},754:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(12),i=(0,n.__importDefault)(a(19)),d=(0,n.__importDefault)(a(402)),g=(0,n.__importDefault)(a(755)),s=function(e){function t(){var t=e.call(this)||this;return t.memoGetBadgeInfoListReq=null,t.normalBadge=new d.default([],0),t.trialBadge=new g.default([],0),t.usingBadge=t.find(0),t}return(0,n.__extends)(t,e),t.prototype.getBadgeInfoList=function(){var e=this;return this.memoGetBadgeInfoListReq||(this.memoGetBadgeInfoListReq=Promise.all([d.default.getBadgeInfoList(),g.default.getBadgeInfoList()]).then((function(e){var t=e[0],a=e[1];return{normalBadgeList:t.vBadgeInfo.value,trialBadgeList:a.vInfo.value,usingBadgeId:t.lUsingBadgeId||a.lUsingTrialBadgeId||0}})),this.memoGetBadgeInfoListReq.then((function(t){var a,n,i=t.normalBadgeList,d=t.trialBadgeList,g=t.usingBadgeId;(a=e.normalBadge.badgeList).push.apply(a,i),(n=e.trialBadge.badgeList).push.apply(n,d),e.usingBadge=e.find(g),e.emit("update")})).catch((function(){}))),this.memoGetBadgeInfoListReq.then((function(){return{normalBadgeList:e.normalBadge.badgeList,trialBadgeList:e.trialBadge.badgeList,usingBadgeId:e.usingBadge.id}}))},t.prototype.listenScoreChangedNotice=function(){var e=this;this.normalBadge.listenScoreChangedNotice(),d.default.addBadgeScoreChangedNoticeListener((function(t){var a=t.tBadgeInfo.lBadgeId;t.iNewBadge&&(null!==e.trialBadge.find(a)&&(e.trialBadge.removeBadge(a),a==e.usingBadge.id&&e.setUsingBadge(a)),1==e.normalBadge.badgeList.length&&"none"===e.usingBadge.type&&e.setUsingBadge(a)),e.emit("scoreChange:normal",t),e.emit("scoreChange",{type:"normal",badgeScore:t})})),this.trialBadge.listenScoreChangedNotice(),g.default.addBadgeScoreChangedNoticeListener((function(t){t.iNewBadge&&"none"===e.usingBadge.type&&e.setUsingBadge(t.tNewInfo.tCompactInfo.lBadgeId),e.emit("scoreChange:trial",t),e.emit("scoreChange",{type:"trial",badgeScore:t})}))},t.prototype.find=function(e){var t=this.normalBadge.find(e),a=this.trialBadge.find(e);return t?{type:"normal",id:t.lBadgeId,name:1==t.iBadgeType?t.tFaithInfo.sFaithName:t.sBadgeName,info:t}:a?{type:"trial",id:a.tCompactInfo.lBadgeId,name:a.sBadgeName,info:a}:{type:"none",id:0,name:"",info:null}},t.prototype.useBadge=function(e){var t,a=this,n=this.find(e),i=n.id;if(i==this.usingBadge.id&&n.type==this.usingBadge.type)return Promise.resolve({lBadgeId:i});if(this.canUse(e))switch(n.type){case"normal":var s=n.info.iBadgeType;t=d.default.useBadge(i,s).then((function(){return{lBadgeId:i}}));break;case"trial":t=g.default.useBadge(i).then((function(){return{lBadgeId:i}}));break;case"none":t="normal"===this.usingBadge.type?d.default.useBadge(0,0).then((function(){return{lBadgeId:0}})):g.default.useBadge(0).then((function(){return{lBadgeId:0}}));break;default:t=Promise.reject(new Error("UNKNOWN BADGE_TYPE"))}else t=Promise.reject(new Error("UNKNOWN BADGE '"+e+"'"));return t.then((function(e){var t=e.lBadgeId;return a.setUsingBadge(t)})).catch((function(){})),t},t.prototype.canUse=function(e){return 0===e||null!==this.normalBadge.find(e)||null!==this.trialBadge.find(e)},t.prototype.setUsingBadge=function(e){var t=this.find(e),a=t.id,n=t.type;if(a!=this.usingBadge.id||n!==this.usingBadge.type){switch(n){case"normal":this.normalBadge.usingBadgeId=a,this.trialBadge.usingBadgeId=0;break;case"trial":this.normalBadge.usingBadgeId=0,this.trialBadge.usingBadgeId=a;break;case"none":this.normalBadge.usingBadgeId=0,this.trialBadge.usingBadgeId=0}this.emit("use",this.usingBadge=t)}},t}(i.default);t.default=s}}]);