(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[375],{1205:function(e,t,n){},1206:function(e,t,n){},1207:function(e,t,n){},1208:function(e,t,n){},1431:function(e,t,n){"use strict";var a=n(14),r=n(158),l=n(312);n(1205);function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);c=!0);}catch(e){o=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(o)throw r}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function i(e){var t=e.children,n={};return e.order%3==0&&(n.paddingRight=0),a.default.createElement("div",{className:"shelf-item"},a.default.createElement("div",{className:"shelf-item-inner",style:n},t))}var u=function(e){var t=e.images,n=e.onAdd,r=e.onRemove,o=e.max,u=e.force,s=c(Object(a.useState)(!1),2),f=s[0],m=s[1],d=Object(a.useRef)(null),b=Object(a.useCallback)((function(e){if(!f){m(!0);var t=new FormData;t.append("file",e.target.files[0]),Object(l.n)(t).then((function(e){m(!1),n(e)})).catch((function(e){m(!1),TT.event.emit("TT_ALERT_MESSAGE","上传失败：".concat(e.message),"error")})),e.target.value=null}}),[n]);return Object(a.useEffect)((function(){u&&d.current&&d.current.click()}),[u]),a.default.createElement("div",{className:"postPublish-shelf"},t.map((function(e,t){return a.default.createElement(i,{order:t+1,key:t},a.default.createElement("span",{className:"shelf-item-image",style:{backgroundImage:"url(".concat(TT.trimUrl(e.corverUrl),")")}},a.default.createElement("i",{className:"image-del",onClick:function(){return r(e)}})))})),!f&&t.length<o&&a.default.createElement(i,{order:t.length+1},a.default.createElement("span",{className:"shelf-item-add",title:"插入图片"},a.default.createElement("i",{className:"icon-add"}),a.default.createElement("input",{className:"image-upload",type:"file",accept:"image/*",ref:d,onChange:b}))),f&&a.default.createElement(i,{order:t.length+1},a.default.createElement("span",{className:"shelf-item-pending",title:"正在上传"})))};n(1206);var s=function(e){var t=e.title,n=e.options,a=e.onRemove,r=e.onClick;return React.createElement("div",{className:"postPublish-vote",onClick:r},React.createElement("i",{className:"vote-del",onClick:a}),React.createElement("h2",{className:"vote-title"},t),n.map((function(e,t){var n=e.content;return React.createElement("span",{className:"vote-answer",key:t},n)})))},f=n(285),m=n.n(f);n(1207);function d(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);c=!0);}catch(e){o=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(o)throw r}}return l}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.content=e}function y(e){var t=e.msg,n=e.duration,r=void 0===n?2500:n,l=e.onClose,c=void 0===l?function(){}:l,o=b(Object(a.useState)(!0),2),i=o[0],u=o[1];return setTimeout((function(){u(!1),c()}),r),i?a.default.createElement("div",{className:"voteEditer-toast"},a.default.createElement("span",null,t)):null}var E=function(e){var t=e.onSubmit,n=e.onClose,r=b(Object(a.useState)(""),2),l=r[0],c=r[1],o=b(Object(a.useState)([new h,new h,new h]),2),i=o[0],u=o[1],s=b(Object(a.useState)(0),2),f=s[0],p=s[1],v=b(Object(a.useState)(""),2),E=v[0],g=v[1],j=Object(a.useCallback)((function(){i.length<4&&(p(i.length+1),u([].concat(d(i),[new h])))}),[i]),O=Object(a.useCallback)((function(e){i.length>2&&(i.splice(e,1),u(d(i)))}),[i]),C=Object(a.useCallback)((function(e){var t=e.target,n=t.name,a=t.value;i[n].content=a.slice(0,20),u(d(i))}),[i]),k=Object(a.useCallback)((function(e){var t=e.target,n=(t.name,t.value);c(n.slice(0,20))}),[]),N=Object(a.useCallback)((function(){if(""!=l.trim()){for(var e=0,n=i.length;e<n;e++)if(""==i[e].content.trim())return p(e+1),void g("选项不能为空");t({title:l.trim(),options:i.map((function(e){return new h(e.content.trim())}))})}else g("标题不能为空")}),[l,i]),S=Object(a.useCallback)((function(e){-1!=f&&e&&(e.focus(),p(-1))}),[f]);return a.default.createElement("div",{className:"voteEditer-wrap"},a.default.createElement("div",{className:"voteEditer-header"},a.default.createElement("i",{className:"voteEditer-close",onClick:n}),"添加投票",a.default.createElement("i",{className:"voteEditer-add",onClick:N},"添加")),a.default.createElement("div",{className:"voteEditer-content"},a.default.createElement("input",{className:"voteEditer-title",type:"text",placeholder:"投票标题...（20个字以内）",value:l,onChange:k,ref:0==f?S:function(){}}),i.map((function(e,t){var n=e.content;i.length;return a.default.createElement("p",{className:"voteEditer-answer-item",key:t},a.default.createElement("input",{className:"voteEditer-answer-input",type:"text",placeholder:"选项 ".concat(t+1,"（20个字以内）"),name:t,value:n,onChange:C,ref:f==t+1?S:function(){}}),a.default.createElement("i",{className:m()("voteEditer-item-del",{disable:i.length<=2}),onClick:function(){return O(t)}}))}))),a.default.createElement("div",{className:m()("voteEditer-item-add",{disable:i.length>=4}),onClick:j,title:i.length>=4?"最多可设置4个选项":""},a.default.createElement("i",{className:"icon-add"}),"添加选项"),!!E&&a.default.createElement(y,{msg:E,onClose:function(){return g("")}}))},g=n(442),j=(n(317),n(304));n(1208);function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function C(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||N(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var a,r,l=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);c=!0);}catch(e){o=!0,r=e}finally{try{c||null==n.return||n.return()}finally{if(o)throw r}}return l}(e,t)||N(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}t.a=function(e){var t=e.onExit,n=e.onPublish,l=k(Object(a.useState)(""),2),c=l[0],o=l[1],i=k(Object(a.useState)([]),2),f=i[0],m=i[1],d=k(Object(a.useState)(!1),2),b=d[0],p=d[1],v=k(Object(a.useState)(null),2),h=v[0],y=v[1],N=k(Object(a.useState)(!1),2),S=N[0],A=N[1],w=k(Object(a.useState)(!1),2),P=w[0],I=w[1],_=k(Object(a.useState)(!1),2),x=_[0],T=_[1],R=Object(j.a)(),U=Object(a.useCallback)((function(e){return o(e.target.value)}),[]),M=Object(a.useCallback)((function(){A(!S),I(!1),R({eid:"usr/click/publish-emoji/community",eid_desc:"赛事社区/发帖/点击表情按钮"})}),[S,R]),B=Object(a.useCallback)((function(){f.length<9&&(p(!0),R({eid:"usr/click/publish-pic/community",eid_desc:"赛事社区/发帖/点击图片按钮"}))}),[f,R]);Object(a.useEffect)((function(){b&&p(!1)}),[b]);var $=Object(a.useCallback)((function(){I(!P),A(!1),R({eid:"usr/click/publish-vote/community",eid_desc:"赛事社区/发帖/点击投票按钮"})}),[P,R]),H=Object(a.useCallback)((function(){I(!1)}),[]),J=Object(a.useCallback)((function(e){y(e),I(!1)}),[]),K=Object(a.useCallback)((function(e){e.stopPropagation(),y(null)}),[]),W=Object(a.useCallback)((function(e){e.stopPropagation(),I(!0)}),[]),Y=Object(a.useCallback)((function(e){f.push(e),m(C(f))}),[f]),D=Object(a.useCallback)((function(e){f.splice(f.indexOf(e),1),m(C(f))}),[f]),F=Object(a.useCallback)((function(){I(!1),A(!1)}),[]),G=Object(a.useCallback)((function(e){e&&e.focus()}),[]),L=Object(a.useCallback)((function(e){var t=e.name;o(c+t),A(!1)}),[c]);return a.default.createElement("div",{className:"postPublish-wrap"},a.default.createElement("div",{className:"postPublish-header"},a.default.createElement("span",{className:"postPublish-back",onClick:t},a.default.createElement("i",{className:"icon"}),"返回")),a.default.createElement("div",{className:"postPublish-body"},a.default.createElement("div",{className:"postPublish-box",onClick:F},a.default.createElement("textarea",{className:"postPublish-area",placeholder:"我要发帖。。。",value:c,onChange:U,ref:G}),a.default.createElement("div",{className:"postPublish-dynamic-wrap"},a.default.createElement(u,{images:f,onAdd:Y,onRemove:D,max:9,force:b}),!P&&h&&a.default.createElement(s,O({},h,{onRemove:K,onClick:W})))),a.default.createElement("div",{className:"postPublish-nav"},a.default.createElement("div",{className:"emot-wrap-box",style:{display:S?"block":"none"}},a.default.createElement(g.a,{onPick:L})),a.default.createElement("div",{className:"vote-wrap-box",style:{display:P?"block":"none"}},a.default.createElement(E,{onSubmit:J,onClose:H})),a.default.createElement("i",{className:"postPublish-nav-emot",onClick:M,title:"插入表情"}),a.default.createElement("i",{className:"postPublish-nav-image".concat(f.length>=9?" disable":""),onClick:B,title:f.length>=9?"最多可以插入".concat(9,"张图片"):"插入图片"}),a.default.createElement("i",{className:"postPublish-nav-vote",onClick:$,title:h?"编辑投票":"发起投票"}),a.default.createElement("i",{className:"postPublish-nav-submit".concat(x?" disable":""),onClick:function(){if(!x){T(!0);var e=c.trim();e?n({text:e,images:f,vote:h||{title:"",options:[]}}).then((function(){R({eid:"sys/success/publish-post/community",eid_desc:"赛事社区/发帖/发布成功"})})).catch((function(e){T(!1),R({eid:"sys/fail/publish-post/community",eid_desc:"赛事社区/发帖/发布失败"})})):(T(!1),Object(r.toast)({content:"内容不能为空",feature:"postPublish",container:document.getElementsByClassName("room-core-r")[0].getElementsByClassName("postPublish-body")[0],duration:1e3})),R({eid:"usr/click/publish-post/community",eid_desc:"赛事社区/发帖/点击发布按钮"})}}},x?"正在发送":"发送"))))}}}]);