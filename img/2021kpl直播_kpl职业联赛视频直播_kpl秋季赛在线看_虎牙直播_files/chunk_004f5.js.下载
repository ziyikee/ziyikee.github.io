(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[285],{145:function(e,o,t){"use strict";t.r(o);var n=t(0),c=t(3),i=t(33),l=t.n(i),r=t(4),a=t.n(r),s=t(8);function u(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}var d=function(e){var o,t,n=document.getElementById("chat-room__wrap"),c=($(n),$("#chat-room__list")),i=$(".scroll_bar"),l=$(".scroll_move");function r(){e.bottomed?(e.off("scroll",a),c.css("top","auto"),c.css("bottom",0)):(c.css("top",-e.scrollTop()),c.css("bottom","auto"),e.on("scroll",a))}function a(){c.css("top",-e.scrollTop())}function s(){i[e.scrollable()?"show":"hide"]()}function u(){var o=e.scrollable()?Math.max(20,e.containerSize()*e.scale()):e.containerSize();l.height(o)}function d(){e.bottomed?(e.off("scroll",f),e.off("resize",f),l.css("top","auto"),l.css("bottom",0)):(l.css("top",e.scrollTop()*e.scale()),l.css("bottom","auto"),e.on("scroll",f),e.on("resize",f))}function f(){l.css("top",e.scrollTop()*e.scale())}r(),e.on("bottomedChange",r),s(),e.on("scrollableChange",s),u(),e.on("resize",u),d(),e.on("bottomedChange",d),l.on("mousedown",(function(n){return o=n.pageY,$(document).on("mousemove.scroll_move",(function(n){return e.lockCd(),t=n.pageY-o,o=n.pageY,e.upScrollTop(t/e.scale()),!1})),$(document).on("mouseup.scroll_move",(function(){$(document).off("mousemove.scroll_move").off("mouseup.scroll_move")})),!1})),n.addEventListener("wheel",(function(o){o.stopPropagation(),o.preventDefault(),o.deltaY<0?e.upScrollTop(-50):e.upScrollTop(50),e.lockCd()}),!1)},f=new function(e){var o=$.extend(this,new s.a),t=Math.max(e.containerSize,0),n=Math.max(e.contentSize,1),c=0,i=l();function l(){return n>t}function r(){return i&&c+t>=n}function a(e){i&&u(e)&&(c=Math.max(0,Math.min(e,n-t)),o.emit("scroll"))}o.on("resize",(function(){var e=i;if(i=l()){var r=n-t;c>r&&a(r)}else 0!==c&&(c=0,o.emit("scroll"));i!=e&&o.emit("scrollableChange",i)})),$.extend(this,{containerSize:function(){return t},contentSize:function(){return n},scale:function(){return t/n},scrollTop:function(){return c},scrollable:function(){return i},isAtBottom:r,setContainerSize:function(e){u(e)&&e>=0&&(t=e,o.emit("resize",0))},setContentSize:function(e){u(e)&&e>0&&(n=e,o.emit("resize",1))},scrollToBottom:function(){!r()&&a(n-t)},setScrollTop:a,upScrollTop:function(e){a(c+e)}})}({containerSize:$("#chat-room__wrap").height(),contentSize:$("#chat-room__list").height()});f.locked=!1,f.lock=function(){!f.locked&&f.scrollable()&&f.emit("lockedChange",f.locked=!0)},f.unlock=function(){f.locked&&f.emit("lockedChange",f.locked=!1)},f.lockCd=a.a.debounce((function(){f.unlock()}),15e3),f.on("resize",(function(e){f.locked||f.scrollToBottom()})),f.bottomed=f.isAtBottom(),f.on("resize",(function(e){f.bottomed!==f.isAtBottom()&&f.emit("bottomedChange",f.bottomed=!f.bottomed)})),f.on("scroll",(function(e){f.bottomed!==f.isAtBottom()&&f.emit("bottomedChange",f.bottomed=!f.bottomed)})),f.on("scroll",(function(){f.scrollable()&&(f.isAtBottom()?f.unlock():f.lock())})),f.on("lockedChange",(function(e){e&&f.lockCd()})),new d(f);var m=f,p=t(76),h=(t(294),t(1065));Promise.all([t.e(4),t.e(5),t.e(6),t.e(3),t.e(7),t.e(8),t.e(9),t.e(0),t.e(1),t.e(2),t.e(12),t.e(15),t.e(24),t.e(25),t.e(37),t.e(63),t.e(58),t.e(66),t.e(51),t.e(64),t.e(62),t.e(57),t.e(60),t.e(65),t.e(49),t.e(61),t.e(52),t.e(97),t.e(78),t.e(75),t.e(79),t.e(101),t.e(142),t.e(169),t.e(170),t.e(168),t.e(171),t.e(172),t.e(149),t.e(143),t.e(118),t.e(173),t.e(224),t.e(228),t.e(226),t.e(225),t.e(235),t.e(197),t.e(234),t.e(227),t.e(229),t.e(385)]).then(t.bind(null,1465));var b=$("#chat-room__list"),k=a.a.throttle((function(){m.setContentSize(b.height()||1)}),120);l.a.on("msg",k),l.a.on("cls",k);var v=$("#chat-room__wrap"),g=a.a.debounce((function(){m.setContainerSize(v.height())}),60);$(window).on("resize",g),DUYA_SUB.subscribe("resizeWide",g),DUYA_SUB.subscribe("resizereinitialise",g);var _=document.getElementById("more-msg");$(_).on("click",(function(e){e.preventDefault(),m.scrollToBottom()})),l.a.on("msg",(function(){m.scrollable()&&!m.bottomed&&(_.style.display="block")})),m.on("bottomedChange",(function(){m.bottomed&&(_.style.display="none")})),m.on("scrollableChange",(function(){m.scrollable()||(_.style.display="none")}));var S=$(".lockBtn");m.on("lockedChange",(function(e){e?S.addClass("locked").find("span").text("解锁"):S.removeClass("locked").find("span").text("锁屏")})),S.on("click",(function(e){e.preventDefault();var o=m.locked;o?m.unlock():m.lock();try{ya.reportProductEvent({eid:"click/zhibo/gp/"+(o?"unlock":"lock"),eid_desc:"点击/直播/公屏/"+(o?"解锁":"锁屏")})}catch(e){}}));var C=$(".clearBtn");C.on("click",(function(e){e.preventDefault(),m.unlock(),l.a.clear();try{ya.reportProductEvent({eid:"click/zhibo/gp/cls",eid_desc:"点击/直播/公屏/清屏"})}catch(e){}})),p.default.on("update:lockAndClearBtn",(function(){var e=$("#wrap-"+p.default.topPanel()),o=e.length?e.height()+10+"px":"10px";S.css("top",o),C.css("top",o)})),m.on("lockedChange",(function(e){e?l.a.gc_close():l.a.gc_open()})),function(){function e(e){var o=e.param?e.param:e;$("#watchChat_pub").css("background-image","url("+TT.trimUrl(o.data.sWebPicUrl)+")")}function o(){$("#watchChat_pub").css("background-image","")}n.default.isH5?n.default.ready((function(t){t.addTafListener("getScreenSkin",(function(o){0==o.iRetCode&&e(o),t.removeTafListener("getScreenSkin")}));var n=new t.taf.HUYA.getScreenSkinReq;n.tId=t.userId,n.lPresenterUid=c.default.lp,n.iTemplate=0,n.iFromType=5,t.sendWup("liveui","getScreenSkin",n),t.addTafListener("6640",e),t.addTafListener("6641",o)})):(n.default.on("showScreenSkinNotify",e,!0),n.default.on("hideScreenSkinNotify",o,!0))}(),$("#chat-room__list").on("click",".J_userMenu",(function(e){e.preventDefault(),m.lock(),m.lockCd()}));var T={id:0,destroy:function(){}};function y(e){var o=$(this),t=o.data("id"),n=o.data("type");if(t&&0==n){T.destroy();var c=o.offset(),i=$(window).scrollLeft()+c.left+o.outerWidth()/2,l=$(window).scrollTop()+c.top+o.outerHeight(),r=$("<div></div>").css({paddingTop:30,top:l-30+5,left:i-18,zIndex:999,position:"absolute"});r.appendTo("body");var a,s=T=new h.a({pid:t,container:r});s.on("destroy",(function(){r.remove()})),o.on("mouseleave.fbaDestroy",(function(){clearTimeout(a),a=setTimeout(s.destroy,200)})),r.on("mouseleave",(function(){clearTimeout(a),a=setTimeout(s.destroy,200)})).on("mouseenter",(function(){clearTimeout(a)})),s.on("destroy",(function(){o.off("mouseleave.fbaDestroy")}))}}$("#chat-room__list").on("mouseenter",".fans-icon",y),$("#chat-room__list").on("mouseenter",".J_CustomFansBadge",y)}}]);