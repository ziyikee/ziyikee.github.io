!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=114)}([function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,i){"use strict";t.__esModule=!0;var s,a=i(117),r=(s=a)&&s.__esModule?s:{default:s};t.default=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),(0,r.default)(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={UserInfo:null,roomInfo:null,config:null,TafLink:null,Timer:null,TimeUtil:null,logger:null,HUYA:null,Taf:null,hyPlayer:null,Const:null,Event:null,StatCfg:null,P2PLibProxy:null,Ntp:null,AverageCalculator:null,Utils:null,ProtoLink:null,Status:null,MetadataTick:null,MSEPlayer:null,AacFrame:null,_isInit:!1,init:function(){this._isInit||(this._isInit=!0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={PAudienceGetProxyListReq:530178,PAudienceGetProxyListRsp:530434,PNotifyStreamSwitch:268034,PLoginVideoProxyUniformly:5650690,PLoginVideoProxyUniformlyRes:5650434,PNotifyCurrentCdnStream:2739202,PNotifyCurrentStream4:2675714,PSubscribeStream3:2667266,PSubscribeStreamRes3:2667522,PStreamData3:2666754,PStopStream3:2666498,PStopStream:2560514,PPullStreamData:2694146,PResendStreamData4:2689026,PResendStreamDataFailAck:2694402,PVideoSyncSpeakerTime3:2674690,PForceConnectVideoProxy3:2685442,PVideoProxyPing3:2669570,PVideoProxyPingRes4:2683650,PNotifyMultiVideo:2746370,PLoginAndSubscribe:4097282,PLoginAndSubscribeRes:4097538,PNotifyUplinkRecvCount3:2672642,PVideoBroadcast4:2754050,PUpdateVideoConfig2:2569474,PVideoQualityStatistics:2591746,PP2pPing2:40706,PP2pPing3:41218,PP2pVideoPing3:2671874,VIDEOP2P_PFlashP2PKeepAlive:3072514,VIDEOP2P_PFlashP2PKeepAliveRes:3072770,P2PGetNodesProxy3:2673410,P2PGetNodesProxyRes3:2673666,P2PSubscribeStream3:2673922,P2PRemoveSubscribe3:2674178,P2PKeepAlive:3074562,P2PKeepAliveRes:3074818,P2PNotifyNodeLeave:3075074,P2PSyncDepth:3075330,P2PKeepAliveWebrtc:3075842,P2PKeepAliveWebrtcRes:3076098,PP2PWSForward:2757378,PP2PWSForwardReject:5653506,P2PSubStream:3073026,P2PSubStreamRes:3073282,P2PSyncSubTree:3073538,P2PTest:3073794,P2PRemoveSub:3074306,P2PRemoveSubRes:3075586,P2PStreamAlive:3076354,P2POffer:12316162,P2PAnswer:12316418,P2PCandidate:12316674,P2POfferReject:12316930,P2PRequestOffer:12317186,P2PVersionFailed:12317442,P2PPingOverProxy:12317698,P2PPunchBackReq:12317954,P2PPunchBackRsp:12318210,PCDNNotifyUrl:20740866,PCDNStatusReport:20741122,PCDNGetUrl:20741378,PCDNSwitchUrl:20741634,PCdnP2PWSForward:53283,PCdnP2PWSForwardReject:53539,PCdnProxyPing:26147,PCdnProxyPingRes:26403,PCdnP2PStatics:26659,PCdnP2PErrStatics:26915,PCdnP2pGetNode:51235,PCdnP2pGetNodeRes:51491,PCdnP2PNodePingThroughProxy:52259,PCdnP2PNodePunchThroughProxy:52515,PCdnP2PUserRegister:52771,PCdnP2PUserRegisterRes:53027,PCdnP2pReportLog:54051,PCdnForceConnectVideoProxy:54563,PCDNGetProxyListReq:153635,PCDNGetProxyListRsp:153891,PCDNGetSliceStreamInfoReq:154147,PCDNGetSliceStreamInfoRsp:154403,PCDNSubscribeReq:768547,PCDNSubscribeRes:768803,PCDNCompeteSubscribeReq:769059,PCDNCompeteSubscribeRes:769315,PCDNForceSubscribeNotify:769571,PCdnP2pUserUnRegister:770083,PP2pSliceData:511779,PP2pSliceAudioData:512035,PP2pSliceVideoData:512291,PP2pSliceCommonData:514083,PP2pSliceSignalData:514595,PP2pSliceControlData:1024547,PForceConnectCdnVideoProxy3:2711042,HuyaDelaySeiData:17920770};!function e(){if(!e.done){e.done=!0;var t=[];for(var i in s){var a=s[i];t.push({uri:a,name:i})}t.forEach((function(e){s[e.uri]=e.name}))}}(),t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(0)),a=o(i(1)),r=o(i(39)),n=o(i(26)),u=o(i(7));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,s.default)(this,e),this.appid=0,this.streamType=0,this.codecType=0,this.sid=0,this.startTs=0,this.serverGenSeq=0}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new u.default(!1);return e.pushUInt8(this.appid),e.pushUInt8(this.streamType),e.pushUInt16(this.codecType),e.pushUInt64(this.sid),e.pushUInt32(this.startTs),e.pushUInt16(this.serverGenSeq),e.marshall()}},{key:"unmarshall",value:function(e){return this.appid=e.popUInt8(),this.streamType=e.popUInt8(),this.codecType=e.popUInt16(),this.sid=e.popUInt64(),this.startTs=e.popUInt32(),this.serverGenSeq=e.popUInt16(),this}},{key:"text",value:function(){return this.appid+"-"+this.streamType+"-"+this.codecType+"-"+this.sid+"-"+this.startTs+"-"+this.serverGenSeq}},{key:"equal",value:function(e){return null!==e&&(this.appid===e.appid&&this.streamType===e.streamType&&this.codecType===e.codecType&&this.sid===e.sid&&this.startTs===e.startTs&&this.serverGenSeq===e.serverGenSeq)}},{key:"isValidID",get:function(){return this.appid>0}},{key:"isTransStream",get:function(){return 1==(1&this.streamType)}},{key:"isAudioStream",get:function(){return this.streamType>=r.default.STRAEM_TYPE_AUDIO_START}},{key:"isVideoStream",get:function(){return this.streamType<r.default.STRAEM_TYPE_AUDIO_START}},{key:"isH264VideoStream",get:function(){return this.isVideoStream&&this.codecType>=n.default.VIDEO_264_START&&this.codecType<=n.default.VIDEO_H264_END}},{key:"isH265VideoStream",get:function(){return this.isVideoStream&&this.codecType>=n.default.VIDEO_265_START&&this.codecType<=n.default.VIDEO_H265_END}},{key:"videoTypeId",get:function(){return this.appid<<24|this.streamType<<16|this.codecType}},{key:"hashKey",get:function(){return 4294967296*this.sid+(this.codecType<<16|this.appid<<8|this.streamType)}},{key:"streamId",get:function(){return 281474976710656*this.streamType+4294967296*this.codecType+this.startTs}}]),e}();t.default=l},function(e,t,i){e.exports={default:i(134),__esModule:!0}},function(e,t){var i=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=i)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,s.default)(this,e),this.hasHeader=t,this.segments=[],this.data=null,this.totalLen=0,this.uri=0,this.hasHeader&&(this.pushUInt32(10),this.pushUInt32(this.uri),this.pushUInt16(200))}return(0,a.default)(e,[{key:"marshall",value:function(){if(0===this.segments.length)return null;this.data=new Uint8Array(this.totalLen);for(var e=0,t=0;t<this.segments.length;++t){var i=this.segments[t];this.data.set(i,e),e+=i.length}return this.hasHeader&&(this.replaceUInt32(0,this.totalLen),this.replaceUInt32(4,this.uri)),this.data}},{key:"setUri",value:function(e){this.uri=e}},{key:"replaceUInt32",value:function(e,t){new DataView(this.data.buffer).setUint32(e,t,!0)}},{key:"pushBool",value:function(e){this.pushUInt8(e?1:0)}},{key:"pushUInt8",value:function(e){var t=new Uint8Array(1);new DataView(t.buffer).setUint8(0,e),this.segments.push(t),this.totalLen++}},{key:"pushUInt16",value:function(e){var t=new Uint8Array(2);new DataView(t.buffer).setUint16(0,e,!0),this.segments.push(t),this.totalLen+=2}},{key:"pushUInt32",value:function(e){var t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,e,!0),this.segments.push(t),this.totalLen+=4}},{key:"pushUInt64",value:function(e){var t=new Uint8Array(8),i=new DataView(t.buffer),s=e%4294967296,a=e/4294967296>>0;i.setUint32(0,s,!0),i.setUint32(4,a,!0),this.segments.push(t),this.totalLen+=8}},{key:"pushUint8Array",value:function(e){this.pushUInt16(e.length),this.segments.push(e),this.totalLen+=e.length}},{key:"pushUint8ArrayWithoutLen",value:function(e){this.segments.push(e),this.totalLen+=e.length}},{key:"pushUint8Array32",value:function(e){this.pushUInt32(e.length),this.segments.push(e),this.totalLen+=e.length}},{key:"pushUInt32Vector",value:function(e){this.pushUInt32(e.length);for(var t=0;t<e.length;t++)this.pushUInt32(e[t])}},{key:"pushUInt64Vector",value:function(e){this.pushUInt32(e.length);for(var t=0;t<e.length;t++)this.pushUInt64(e[t])}},{key:"pushUInt16Vector",value:function(e){this.pushUInt32(e.length);for(var t=0;t<e.length;t++)this.pushUInt16(e[t])}},{key:"popObjVector",value:function(e){for(var t=this.popUInt32(),i=[],s=0;s<t;s++){var a=new e;i.push(a.unmarshall(this))}return i}},{key:"pushString",value:function(e){this.pushUInt16(e.length);for(var t=new Uint8Array(e.length),i=new DataView(t.buffer),s=0;s<e.length;++s)i.setUint8(s,e.charCodeAt(s));this.segments.push(t),this.totalLen+=e.length}},{key:"pushString32",value:function(e){this.pushUInt32(e.length);for(var t=new Uint8Array(e.length),i=new DataView(t.buffer),s=0;s<e.length;++s)i.setUint8(s,e.charCodeAt(s));this.segments.push(t),this.totalLen+=e.length}}]),e}();t.default=n},function(e,t,i){var s=i(51)("wks"),a=i(30),r=i(12).Symbol,n="function"==typeof r;(e.exports=function(e){return s[e]||(s[e]=n&&r[e]||(n?r:a)("Symbol."+e))}).store=s},function(e,t,i){var s=i(12),a=i(6),r=i(20),n=i(15),u=i(18),o=function(e,t,i){var l,d,h,f=e&o.F,c=e&o.G,p=e&o.S,v=e&o.P,y=e&o.B,m=e&o.W,g=c?a:a[t]||(a[t]={}),_=g.prototype,S=c?s:p?s[t]:(s[t]||{}).prototype;for(l in c&&(i=t),i)(d=!f&&S&&void 0!==S[l])&&u(g,l)||(h=d?S[l]:i[l],g[l]=c&&"function"!=typeof S[l]?i[l]:y&&d?r(h,s):m&&S[l]==h?function(e){var t=function(t,i,s){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,s)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(h):v&&"function"==typeof h?r(Function.call,h):h,v&&((g.virtual||(g.virtual={}))[l]=h,e&o.R&&_&&!_[l]&&n(_,l,h)))};o.F=1,o.G=2,o.S=4,o.P=8,o.B=16,o.W=32,o.U=64,o.R=128,e.exports=o},function(e,t,i){e.exports=!i(17)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(184)),a=n(i(186)),r=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}var u={extendConfig:{useWssAudio:!1},isHuya:!0,isH265:!1,isPull:!1,isLiveMeeting:!1,presenterUid:0,uid:0,uuid:0,convertUid:0,getUid:function(){return u.uuid},sid:0,subSid:0,appid:66,codeRate:0,curBitrate:0,userArea:0,proxyAreaType:0,clientAreaType:0,isFirstViewer:!1,videoStreamId:null,audioStreamId:null,videoMetaData:null,audioMetaData:null,videoNtp:new(n(i(189)).default),downlinkRTOCalculator:new a.default,proxyLink:null,videoLink:null,initTafTime:0,getVPTime:0,startTime:0,connectVideoTime:0,firstVideoPkgTime:0,firstIFrameTime:0,firstRenderTime:0,onPlayTime:0,initUseTime:function(e){u.startTime=e,u.connectVideoTime=0,u.loginTime=0,u.firstVideoPkgTime=0,u.firstIFrameTime=0,u.firstRenderTime=0,u.onPlayTime=0},printUseTime:function(){for(var e=["\n%c"+".".repeat(28)," getVPTime            = "+(u.getVPTime-u.startTime)," connectVideoTime     = "+(u.connectVideoTime-u.getVPTime)," loginTime            = "+(u.loginTime-u.connectVideoTime)," firstVideoPkgTime    = "+(u.firstVideoPkgTime-u.loginTime)," firstIFrameTime      = "+(u.firstIFrameTime-u.firstVideoPkgTime)," firstRenderTime      = "+(u.firstRenderTime-u.firstIFrameTime)," onPlayTime           = "+(u.onPlayTime-u.firstRenderTime)," totalTime            = "+(u.onPlayTime-u.startTime),".".repeat(28)],t=0;t<e.length;t++){var i=e[t];i.length<28&&(i+=" ".repeat(28-i.length),e[t]=i)}var s=e.join("\n");r.default.logger.log(s,"color:#007500;background:#FFF5C2")},getConfig:function(e){return o.getConfig(e)},setConfig:function(e,t){r.default.logger.log("G.setConfig key="+e+" val="+t),o.setConfig(e,t)},hasListener:d,addListener:function(e,t,i){if(d(e,t,i))return;var s=l[e]||[];s.push({callback:t,thisObj:i,bindCallback:i?t.bind(i):t}),l[e]=s},removeListener:function(e,t,i){var s=l[e];if(!s)return;for(var a=s.length-1;a>=0;a--){var r=s[a];if(r.callback==t&&r.thisObj==i)return void s.splice(a,1)}},_onYYData:function(e,t){var i=l[e];if(!i)return;i.forEach((function(e){(0,e.bindCallback)(t)}))},send:function(e){if(u.videoLink)return u.videoLink.send(e);return!1},sendWup:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!u.proxyLink)return void r.default.logger.error("G.sendWup proxyLink=null");u.proxyLink.sendWup(e,t,i,s,a,n,o)},sendYY:function(e,t){if(!u.proxyLink)return void r.default.logger.error("G.sendYY proxyLink=null");u.proxyLink.sendYY(e,t,u.getUid())}};t.default=u;var o=new s.default;var l={};function d(e,t,i){var s=l[e];if(!s)return!1;for(var a=0,r=s.length;a<r;a++){var n=s[a];if(n.callback==t&&n.thisObj==i)return!0}return!1}},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,i){var s=i(16),a=i(75),r=i(42),n=Object.defineProperty;t.f=i(10)?Object.defineProperty:function(e,t,i){if(s(e),t=r(t,!0),s(i),a)try{return n(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,i){var s=i(13),a=i(28);e.exports=i(10)?function(e,t,i){return s.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t,i){var s=i(14);e.exports=function(e){if(!s(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t,i){e.exports={default:i(125),__esModule:!0}},function(e,t,i){var s=i(74);e.exports=function(e,t,i){if(s(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,s){return e.call(t,i,s)};case 3:return function(i,s,a){return e.call(t,i,s,a)}}return function(){return e.apply(t,arguments)}}},function(e,t,i){var s=i(45),a=i(47);e.exports=function(e){return s(a(e))}},function(e,t,i){var s=i(47);e.exports=function(e){return Object(s(e))}},function(e,t){e.exports={}},function(e,t,i){var s=i(77),a=i(52);e.exports=Object.keys||function(e){return s(e,a)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(0)),a=u(i(1)),r=u(i(7)),n=u(i(60));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,s.default)(this,e),this.sid=0,this.fuzzyParam=new n.default}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new r.default(!1);return e.pushUInt64(this.sid),e.pushUint8ArrayWithoutLen(this.fuzzyParam.marshall()),e.marshall()}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={STREAM_UNKNOWN:0,AUDIO_SPEEX:0,AUDIO_AACPLUS:1,AUDIO_SILK:2,AUDIO_AAC_44100HZ_STEREO_128KBPS:35,AUDIO_AAC_44100HZ_STEREO_160KBPS:36,AUDIO_AAC_44100HZ_STEREO_192KBPS:37,AUDIO_ELD_AAC_44100HZ_STEREO:38,AUDIO_ELD_AAC_SBR_44100HZ_STEREO:39,AUDIO_MP3:50,AUDIO_NELLYMOSER:54,VIDEO_264_START:401,VIDEO_H264_100K:401,VIDEO_H264_500K:405,VIDEO_H264_800K:408,VIDEO_H264_1200K:412,VIDEO_H264_1500K:415,VIDEO_H264_2000K:420,VIDEO_H264_3000K:430,VIDEO_H264_4000K:440,VIDEO_H264_6000K:460,VIDEO_H264_8000K:480,VIDEO_H264_END:480,VIDEO_265_START:503,VIDEO_H265_300K:503,VIDEO_H265_500K:505,VIDEO_H265_800K:508,VIDEO_H265_1200K:512,VIDEO_H265_1500K:515,VIDEO_H265_2000K:520,VIDEO_H265_3000K:530,VIDEO_H265_4000K:540,VIDEO_H265_6000K:560,VIDEO_H265_8000K:580,VIDEO_H265_END:580}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(5)),a=u(i(0)),r=u(i(1)),n=u(i(7));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,a.default)(this,e),this.ip=0,this.tcpPorts=[],this.udpPorts=[],this.videoProxyInfo=new s.default}return(0,r.default)(e,[{key:"marshall",value:function(){var e=new n.default(!1);return"number"==typeof this.ip?e.pushUInt32(this.ip):e.pushUInt32(this.ip2uint(this.ip)),e.pushUInt16Vector(this.tcpPorts),e.pushUInt16Vector(this.udpPorts),e.pushUInt32(this.videoProxyInfo.size),this.videoProxyInfo.forEach((function(t,i){e.pushUInt8(i),e.pushUInt32(t)})),e.marshall()}},{key:"unmarshall",value:function(e){this.ip=this.uint2ip(e.popUInt32()),this.tcpPorts=e.popUInt16Vector(),this.udpPorts=e.popUInt16Vector(),this.videoProxyInfo.clear();for(var t=e.popUInt32(),i=0;i<t;i++){var s=e.popUInt8(),a=e.popUInt32();this.videoProxyInfo.set(s,a)}return this}},{key:"ip2uint",value:function(e){for(var t=0,i=e.split("."),s=0;s<i.length;s++){t|=Number(i[s])<<8*s}return t<0&&(t+=4294967296),t}},{key:"uint2ip",value:function(e){return(255&e)+"."+(e>>8&255)+"."+(e>>16&255)+"."+(e>>24&255)}}]),e}();t.default=o},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports=!0},function(e,t){var i=0,s=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+s).toString(36))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){i(126);for(var s=i(12),a=i(15),r=i(23),n=i(8)("toStringTag"),u="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),o=0;o<u.length;o++){var l=u[o],d=s[l],h=d&&d.prototype;h&&!h[n]&&a(h,n,l),r[l]=r.Array}},function(e,t,i){var s=i(16),a=i(129),r=i(52),n=i(50)("IE_PROTO"),u=function(){},o=function(){var e,t=i(76)("iframe"),s=r.length;for(t.style.display="none",i(130).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),o=e.F;s--;)delete o.prototype[r[s]];return o()};e.exports=Object.create||function(e,t){var i;return null!==e?(u.prototype=s(e),i=new u,u.prototype=null,i[n]=e):i=o(),void 0===t?i:a(i,t)}},function(e,t,i){var s=i(13).f,a=i(18),r=i(8)("toStringTag");e.exports=function(e,t,i){e&&!a(e=i?e:e.prototype,r)&&s(e,r,{configurable:!0,value:t})}},function(e,t,i){"use strict";var s=i(131)(!0);i(54)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=s(t,i),this._i+=e.length,{value:e,done:!1})}))},function(e,t,i){var s=i(20),a=i(137),r=i(138),n=i(16),u=i(48),o=i(81),l={},d={};(t=e.exports=function(e,t,i,h,f){var c,p,v,y,m=f?function(){return e}:o(e),g=s(i,h,t?2:1),_=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(r(m)){for(c=u(e.length);c>_;_++)if((y=t?g(n(p=e[_])[0],p[1]):g(e[_]))===l||y===d)return y}else for(v=m.call(e);!(p=v.next()).done;)if((y=a(v,g,p.value,t))===l||y===d)return y}).BREAK=l,t.RETURN=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={VIDEO_ACCESS_MODE:0,AUDIO_ACCESS_MODE:1,VIDEO_JIT_BUFLEN:2,AUDIO_JIT_BUFLEN:3,VIDEO_P2P_MODE:4,AUDIO_PUSH_LEN:5,VIDEO_JIT_MAX_BUFLEN:6,JIT_DOWN_MODE:7,JIT_UP_MODE:8,PUSH_GOP:9,JIT_ADJUST_MODE:10,P2P_MAX_SUB_NUM:50}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l(i(5)),a=l(i(0)),r=l(i(1)),n=l(i(3)),u=l(i(7)),o=(l(i(25)),l(i(61)));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(){(0,a.default)(this,e),this.uid=0,this.version=0,this.streamNames=[],this.fuzzyQueryKeys=[],this.currentInfo=new o.default,this.appid=0,this.clientAppid=0,this.clientType=0,this.ip=0,this.sendTime=0,this.sdkVersion=0,this.imsi=0,this.useCase=0,this.appSysName="",this.appUA="",this.retryFailCount=0,this.extInfo=new s.default}return(0,r.default)(e,[{key:"marshall",value:function(){var e=new u.default;return e.setUri(n.default.PAudienceGetProxyListReq),e.pushUInt64(this.uid),e.pushUInt8(this.version),e.pushUInt32(this.streamNames.length),this.streamNames.forEach((function(t){e.pushString(t)})),e.pushUInt32(this.fuzzyQueryKeys.length),this.fuzzyQueryKeys.forEach((function(t){e.pushUint8ArrayWithoutLen(t.marshall())})),e.pushUint8ArrayWithoutLen(this.currentInfo.marshall()),e.pushUInt8(this.appid),e.pushUInt32(this.clientAppid),e.pushUInt32(this.clientType),e.pushUInt32(this.ip),e.pushUInt32(this.sendTime),e.pushUInt32(this.sdkVersion),e.pushUInt64(this.imsi),e.pushUInt8(this.useCase),e.pushString(this.appSysName),e.pushString(this.appUA),e.pushUInt8(this.retryFailCount),e.pushUInt32(this.extInfo.size),this.extInfo.forEach((function(t,i){e.pushString(i),e.pushString(t)})),e.marshall()}}]),e}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={STREAM_VIDEO_RAW:0,STREAM_VIDEO_TRANSCODE:1,STREAM_VIDEO_RTMP_RAW:2,STREAM_VIDEO_RTMP_TRANSCODE:3,STRAEM_TYPE_AUDIO_START:32,STREAM_AUDIO_RAW:32,STREAM_AUDIO_TRANSCODE:33,STREAM_AUDIO_FLV_RAW:34,STREAM_AUDIO_FLV_TRANSCODE:35,STREAM_AUDIO_RTMP_RAW:36,STREAM_AUDIO_RTMP_TRANSCODE:37,STREAM_AUDIO_ALL_SID:39,STREAM_TYPE_UNKNOWN:255}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=d(i(5)),a=d(i(0)),r=d(i(1)),n=d(i(3)),u=d(i(7)),o=(d(i(4)),d(i(63))),l=d(i(64));function d(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(){(0,a.default)(this,e),this.version=0,this.uid=0,this.streamGroupIds=[],this.clientAppid=0,this.clientType=0,this.loginStamp=0,this.videoGroupId=0,this.tcpId=0,this.commandType=0,this.fastAccessInterval=0,this.cookie="",this.localIps=[],this.localPort=0,this.vpToken=new o.default,this.apToken=new l.default,this.token="",this.sdkVersion=0,this.tokenVersion=0,this.tokens=new s.default,this.audioCodecType=[],this.serviceType=0}return(0,r.default)(e,[{key:"marshall",value:function(){var e=new u.default;return e.setUri(n.default.PLoginVideoProxyUniformly),e.pushUInt8(this.version),e.pushUInt64(this.uid),e.pushUInt32(this.streamGroupIds.length),this.streamGroupIds.forEach((function(t){e.pushUint8ArrayWithoutLen(t.marshall())})),e.pushUInt32(this.clientAppid),e.pushUInt8(this.clientType),e.pushUInt32(this.loginStamp),e.pushUInt32(this.videoGroupId),e.pushUInt8(this.tcpId),e.pushUInt8(this.commandType),e.pushUInt32(this.fastAccessInterval),e.pushString(this.cookie),e.pushUInt32Vector(this.localIps),e.pushUInt16(this.localPort),e.pushUint8ArrayWithoutLen(this.vpToken.marshall()),e.pushUint8ArrayWithoutLen(this.apToken.marshall()),e.pushString(this.token),e.pushUInt32(this.sdkVersion),e.pushUInt32(this.tokenVersion),e.pushUInt32(this.tokens.size),this.tokens.forEach((function(t,i){e.pushUint8ArrayWithoutLen(i.marshall()),e.pushString(t)})),e.pushUInt32Vector(this.audioCodecType),e.pushUInt32(this.serviceType),e.marshall()}}]),e}();t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(0)),a=u(i(1)),r=u(i(3)),n=u(i(7));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,s.default)(this,e),this.uid=0,this.stampc=0,this.loginStamp=0,this.uplinkBw=0,this.availPeers=0,this.bPunched=!1,this.tcpEstableIds=0,this.tcpId=0,this.vipUser=0}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new n.default;return e.setUri(r.default.PVideoProxyPing3),e.pushUInt64(this.uid),e.pushUInt32(this.stampc),e.pushUInt32(this.loginStamp),e.pushUInt32(this.uplinkBw),e.pushUInt16(this.availPeers),e.pushBool(this.bPunched),e.pushUInt32(this.tcpEstableIds),e.pushUInt8(this.tcpId),e.pushUInt8(this.vipUser),e.marshall()}}]),e}();t.default=o},function(e,t,i){var s=i(14);e.exports=function(e,t){if(!s(e))return e;var i,a;if(t&&"function"==typeof(i=e.toString)&&!s(a=i.call(e)))return a;if("function"==typeof(i=e.valueOf)&&!s(a=i.call(e)))return a;if(!t&&"function"==typeof(i=e.toString)&&!s(a=i.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=f(i(44)),a=f(i(19)),r=f(i(82)),n=f(i(5)),u=f(i(0)),o=f(i(1)),l=f(i(2)),d=f(i(57)),h=f(i(151));function f(e){return e&&e.__esModule?e:{default:e}}var c=new(function(){function e(){(0,u.default)(this,e),this.streamPlayer=null,this.tsdbUtil=null,this.tsdbStat=null,this.streamMap=new n.default}return(0,o.default)(e,[{key:"onTurnBack",value:function(e,t){if(this.streamMap.has(e.info.sStreamName)){var i=this.streamPlayer.hyPlayer;i.trigger(l.default.Event.DATA_METRIC2,[i.stat.createAct(l.default.StatCfg.ACT.SIGNAL_TURN_BACK,{value:[t]})]),i.trigger(l.default.Event.SIGNAL_ERROR,e.info.oStreamName),this.stopStream(e.info.sStreamName)}}},{key:"start",value:function(e){var t=(0,r.default)(e).replace(/\,/g,"\n").replace(/[\"\{\}]/g,"");if(!e.groupId)return console.error("StreamMod.start 参数不完整！\n"+t),this.streamPlayer.trigger(l.default.Event.SIGNAL_ERROR),!1;l.default.logger.log("StreamMod.start \n"+t);var i=!0,n=!1,u=void 0;try{for(var o,d=(0,a.default)(e.groupId);!(i=(o=d.next()).done);i=!0){var f=o.value,c=f.replace(":","-");if(!this.streamMap.has(c)){var p=(0,s.default)({},e);p.sStreamName=c,p.oStreamName=f;var v=new h.default(p,this.streamPlayer.hyPlayer);v.onTurnBack=this.onTurnBack.bind(this),this.streamMap.set(p.sStreamName,v)}}}catch(e){n=!0,u=e}finally{try{!i&&d.return&&d.return()}finally{if(n)throw u}}l.default.Timer.add(this.onCheckTimer,this,1e3)}},{key:"stop",value:function(){this.sendMetric(!0);var e=!0,t=!1,i=void 0;try{for(var s,r=(0,a.default)(this.streamMap.values());!(e=(s=r.next()).done);e=!0){s.value.stop()}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}this.streamMap.clear(),l.default.Timer.remove(this.onCheckTimer,this)}},{key:"stopStream",value:function(e){if(d.default.signalUserProperty=4,e=e.replace(":","-"),this.streamMap.has(e)){var t=this.streamMap.get(e),i=t.getMetric(!0);i&&this.streamPlayer.hyPlayer.sendMetrics([i]),t.stop(),this.streamMap.delete(e)}}},{key:"onCheckTimer",value:function(e,t){if(t%20==0){var i=!0,s=!1,r=void 0;try{for(var n,u=(0,a.default)(this.streamMap.values());!(i=(n=u.next()).done);i=!0){n.value.printInfo()}}catch(e){s=!0,r=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw r}}this.sendMetric(!1)}if(t%3==0){var o=!0,d=!1,h=void 0;try{for(var f,c=(0,a.default)(this.streamMap.values());!(o=(f=c.next()).done);o=!0){var p=f.value;e-p.recvTime<1e4?this.streamPlayer.hyPlayer.trigger(l.default.Event.SIGNAL_HEART,p.info):p.turnToFlv(l.default.Const.turnToFlvReason.NO_DATA_TIMEOUT)}}catch(e){d=!0,h=e}finally{try{!o&&c.return&&c.return()}finally{if(d)throw h}}}}},{key:"sendMetric",value:function(e){if(this.streamMap.size>0){var t=[],i=!0,s=!1,r=void 0;try{for(var n,u=(0,a.default)(this.streamMap.values());!(i=(n=u.next()).done);i=!0){var o=n.value.getMetric(e);o&&t.push(o)}}catch(e){s=!0,r=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw r}}t.length>0&&this.streamPlayer.hyPlayer.sendMetrics(t)}}}]),e}());t.default=c},function(e,t,i){e.exports={default:i(120),__esModule:!0}},function(e,t,i){var s=i(46);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==s(e)?e.split(""):Object(e)}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,i){var s=i(49),a=Math.min;e.exports=function(e){return e>0?a(s(e),9007199254740991):0}},function(e,t){var i=Math.ceil,s=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?s:i)(e)}},function(e,t,i){var s=i(51)("keys"),a=i(30);e.exports=function(e){return s[e]||(s[e]=a(e))}},function(e,t,i){var s=i(6),a=i(12),r=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:s.version,mode:i(29)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,i){"use strict";var s=i(29),a=i(9),r=i(79),n=i(15),u=i(23),o=i(128),l=i(34),d=i(80),h=i(8)("iterator"),f=!([].keys&&"next"in[].keys()),c=function(){return this};e.exports=function(e,t,i,p,v,y,m){o(i,t,p);var g,_,S,P=function(e){if(!f&&e in E)return E[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},T=t+" Iterator",k="values"==v,I=!1,E=e.prototype,R=E[h]||E["@@iterator"]||v&&E[v],U=R||P(v),A=v?k?P("entries"):U:void 0,M="Array"==t&&E.entries||R;if(M&&(S=d(M.call(new e)))!==Object.prototype&&S.next&&(l(S,T,!0),s||"function"==typeof S[h]||n(S,h,c)),k&&R&&"values"!==R.name&&(I=!0,U=function(){return R.call(this)}),s&&!m||!f&&!I&&E[h]||n(E,h,U),u[t]=U,u[T]=c,v)if(g={values:k?U:P("values"),keys:y?U:P("keys"),entries:A},m)for(_ in g)_ in E||r(E,_,g[_]);else a(a.P+a.F*(f||I),t,g);return g}},function(e,t,i){var s=i(46),a=i(8)("toStringTag"),r="Arguments"==s(function(){return arguments}());e.exports=function(e){var t,i,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?i:r?s(t):"Object"==(n=s(t))&&"function"==typeof t.callee?"Arguments":n}},function(e,t,i){var s=i(30)("meta"),a=i(14),r=i(18),n=i(13).f,u=0,o=Object.isExtensible||function(){return!0},l=!i(17)((function(){return o(Object.preventExtensions({}))})),d=function(e){n(e,s,{value:{i:"O"+ ++u,w:{}}})},h=e.exports={KEY:s,NEED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!r(e,s)){if(!o(e))return"F";if(!t)return"E";d(e)}return e[s].i},getWeak:function(e,t){if(!r(e,s)){if(!o(e))return!0;if(!t)return!1;d(e)}return e[s].w},onFreeze:function(e){return l&&h.NEED&&o(e)&&!r(e,s)&&d(e),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={signalUserProperty:0}},function(e,t,i){t.f=i(8)},function(e,t,i){var s=i(12),a=i(6),r=i(29),n=i(58),u=i(13).f;e.exports=function(e){var t=a.Symbol||(a.Symbol=r?{}:s.Symbol||{});"_"==e.charAt(0)||e in t||u(t,e,{value:n.f(e)})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=n(i(7));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.h264Only=!1,this.maxCodeRateH264=0,this.maxCodeRateH265=0,this.reserve=0}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new r.default(!1);return e.pushBool(this.h264Only),e.pushUInt16(this.maxCodeRateH264),e.pushUInt16(this.maxCodeRateH265),e.pushUInt32(this.reserve),e.marshall()}},{key:"unmarshall",value:function(e){return this.h264Only=e.popBool(),this.maxCodeRateH264=e.popUInt16(),this.maxCodeRateH265=e.popUInt16(),this.reserve=e.popUInt32(),this}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l(i(5)),a=l(i(0)),r=l(i(1)),n=l(i(7)),u=l(i(4)),o=l(i(27));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(){(0,a.default)(this,e),this.currentProxyInfos=new s.default}return(0,r.default)(e,[{key:"marshall",value:function(){var e=new n.default(!1);return e.pushUInt32(this.currentProxyInfos.size),this.currentProxyInfos.forEach((function(t,i){e.pushUint8ArrayWithoutLen(i.marshall()),e.pushUInt32(t.length),t.forEach((function(t){e.pushUint8ArrayWithoutLen(t.marshall())}))})),e.marshall()}},{key:"unmarshall",value:function(e){this.currentProxyInfos.clear();for(var t=e.popUInt32(),i=0;i<t;i++){var s=new u.default;s.unmarshall(e);for(var a=[],r=e.popUInt32(),n=0;n<r;n++){var l=new o.default;a.push(l.unmarshall(e))}this.currentProxyInfos.set(s,a)}return this}}]),e}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(5)),a=n(i(0)),r=n(i(1));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,a.default)(this,e),this.view=t,this.pos=0,this.len=0,this.uri=0,this.resCode=0,!0===i&&(this.len=this.popUInt32(),this.uri=this.popUInt32(),this.resCode=this.popUInt16())}return(0,r.default)(e,[{key:"bytesAvailable",value:function(){return this.view.byteLength-this.pos}},{key:"popBool",value:function(){return 1==this.popUInt8()}},{key:"popUInt8",value:function(){if(this.pos+1>this.view.byteLength)return 0;var e=this.view.getUint8(this.pos);return this.pos++,e}},{key:"popUInt16",value:function(){if(this.pos+2>this.view.byteLength)return 0;var e=this.view.getUint16(this.pos,!0);return this.pos+=2,e}},{key:"popUInt32",value:function(){if(this.pos+4>this.view.byteLength)return 0;var e=this.view.getUint32(this.pos,!0);return this.pos+=4,e}},{key:"popUInt64",value:function(){if(this.pos+8>this.view.byteLength)return 0;var e=this.view.getUint32(this.pos,!0);this.pos+=4;var t=this.view.getUint32(this.pos,!0);return this.pos+=4,4294967296*t+e}},{key:"popInt64",value:function(){for(var e=0,t=(128&this.view.getUint8(this.pos+7))>0,i=!0,s=0;s<8;s++){var a=this.view.getUint8(this.pos+s);t&&(i?0!=a&&(a=255&~(a-1),i=!1):a=255&~a),e+=a*Math.pow(2,8*s)}return t&&(e=-e),this.pos+=8,e}},{key:"popUint8Array",value:function(){var e=this.popUInt16();if(this.pos+e>this.view.byteLength)return null;var t=new Uint8Array(this.view.buffer,this.pos,e);return this.pos+=e,t.slice()}},{key:"popUint8Array32",value:function(){var e=this.popUInt32();if(this.pos+e>this.view.byteLength)return null;var t=new Uint8Array(this.view.buffer,this.pos,e);return this.pos+=e,t.slice()}},{key:"popUInt64Vector",value:function(){var e=this.popUInt32();if(this.pos+8*e>this.view.byteLength)return null;for(var t=[],i=0;i<e;i++)t.push(this.popUInt64());return t}},{key:"popUInt32Vector",value:function(){var e=this.popUInt32();if(this.pos+4*e>this.view.byteLength)return null;for(var t=[],i=0;i<e;i++)t.push(this.popUInt32());return t}},{key:"popUInt16Vector",value:function(){var e=this.popUInt32();if(this.pos+2*e>this.view.byteLength)return null;for(var t=[],i=0;i<e;i++)t.push(this.popUInt16());return t}},{key:"popString",value:function(){var e=this.popUInt16();if(this.pos+e>this.view.byteLength)return null;for(var t=[],i=0;i<e;++i)t[i]=String.fromCharCode(this.popUInt8());return t.join("")}},{key:"popMapKey8Val32",value:function(){for(var e=this.popUInt32(),t=new s.default,i=0;i<e;i++){var a=this.popUInt8(),r=this.popUInt32();t.set(a,r)}return t}},{key:"popMapKey64Val64",value:function(){for(var e=this.popUInt32(),t=new s.default,i=0;i<e;i++){var a=this.popUInt64(),r=this.popUInt64();t.set(a,r)}return t}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=n(i(7));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.strToken=""}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new r.default(!1);return e.pushString(this.strToken),e.marshall()}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=n(i(7));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.strToken=""}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new r.default(!1);return e.pushString(this.strToken),e.marshall()}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){(0,s.default)(this,e),this.ip=0,this.tcpPorts=[],this.udpPorts=[]}return(0,a.default)(e,[{key:"unmarshall",value:function(e){return this.ip=e.popUInt32(),this.tcpPorts=e.popUInt16Vector(),this.udpPorts=e.popUInt16Vector(),this}}]),e}();t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){(0,s.default)(this,e),this.hopId=0,this.value=0}return(0,a.default)(e,[{key:"unmarshall",value:function(e){return this.hopId=e.popUInt64(),this.value=e.popUInt32(),this}}]),e}();t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={PUBLISHER_CUR_BIT_RATE:7,SERVER_H265_STREAM:112,SERVER_FASTACCESS_MODE:113,SERVER_FASTACCESS_FIRST_DTS:117,SERVER_FASTACCESS_LAST_DTS:118};t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(0)),a=u(i(1)),r=u(i(4)),n=u(i(27));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,s.default)(this,e),this.streamId=new r.default,this.videoProxyInfos=[],this.token=""}return(0,a.default)(e,[{key:"unmarshall",value:function(e){this.streamId.unmarshall(e),this.videoProxyInfos=[];for(var t=e.popUInt32(),i=0;i<t;i++){var s=new n.default;this.videoProxyInfos.push(s.unmarshall(e))}return this.token=e.popString(),this}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(0)),a=o(i(1)),r=o(i(3)),n=o(i(7)),u=o(i(4));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,s.default)(this,e),this.streamGroupId=new u.default,this.uid=0,this.seqNums=[]}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new n.default;return e.setUri(r.default.PPullStreamData),e.pushUint8ArrayWithoutLen(this.streamGroupId.marshall()),e.pushUInt64(this.uid),e.pushUInt32Vector(this.seqNums),e.marshall()}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(0)),a=o(i(1)),r=o(i(3)),n=o(i(7)),u=o(i(4));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,s.default)(this,e),this.streamGroupId=new u.default,this.sender=0,this.receiver=0,this.stampc=0,this.seqNums=[],this.mergeSeq=0}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new n.default;return e.setUri(r.default.PReSendStreamData4),e.pushUint8ArrayWithoutLen(this.streamGroupId.marshall()),e.pushUInt64(this.sender),e.pushUInt64(this.receiver),e.pushUInt32(this.stampc),e.pushUInt32Vector(this.seqNums),e.pushUInt32(this.mergeSeq),e.marshall()}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(0)),a=u(i(1)),r=u(i(3)),n=u(i(7));u(i(4));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,s.default)(this,e),this.streamGroupIds=[],this.uid=0,this.subscribe=!1,this.option=0,this.playStamp=0}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new n.default;return e.setUri(r.default.PSubscribeStream3),e.pushUInt32(this.streamGroupIds.length),this.streamGroupIds.forEach((function(t){e.pushUint8ArrayWithoutLen(t.marshall())})),e.pushUInt64(this.uid),e.pushBool(this.subscribe),e.pushUInt32(this.option),e.pushUInt32(this.playStamp),e.marshall()}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={ACCEPT_SUBSCRIBE:0,EMPTY_UPLINK_BW:1,DETECT_SUBSCRIBE_CYCLE:2,EMPTY_PEER_INFO:3,SUBSCRIBE_UPLINK_NOT_ENOUGH:4,PUBLISHER_KICK_OFF:5,NOT_SUBSCRIBER:6,INVALID_SUB_STREAM:7,ACCEPT_BY_SUBSCRIBER_UPLINK:9,INVALID_STREAMID:10,SERVER_EMPTY_BW:11,PUBLISHER_LEAVE:12,DIFFERENT_VIDEO_PROXY:13,OLD_VERSION_REQ:14,SUBSCRIBER_NO_PERMISSION:15}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){(0,s.default)(this,e),this.ssrc=0,this.framenum=0,this.type=0,this.framebase=0,this.critical=!1,this.payload=null,this.transMode=0,this.packData=!1,this.bHasVideoSid=!1,this.byteVoiceMarks=0,this.capTimeStamp=0,this.m_isMarshalVoiceMarks=!1}return(0,a.default)(e,[{key:"unmarshall",value:function(t){this.capTimeStamp=t.popUInt32(),this.ssrc=t.popUInt8();var i=t.popUInt8();return this.type=t.popUInt16(),this.framebase=t.popUInt32(),this.payload=t.popUint8Array(),t.bytesAvailable()?this.byteVoiceMarks=t.popUInt8():this.byteVoiceMarks=e.VOICE_MARK_KEY_BIT0,this.framenum=i&e.FRAMENUM_MASK,this.critical=!!(i&e.CRITICAL_MASK),this.bHasVideoSid=!!(i&e.VIDEOSID_MASK),this.transMode=1+((i&e.FTMMODE_MASK)>>4),this}},{key:"setIsKeyVoice",value:function(t){this.byteVoiceMarks|=t?e.VOICE_MARK_KEY_BIT0:0}},{key:"isKeyVoice",get:function(){return this.byteVoiceMarks&e.VOICE_MARK_KEY_BIT0}}]),e}();n.FRAMENUM_MASK=15,n.FTMMODE_MASK=48,n.VIDEOSID_MASK=64,n.CRITICAL_MASK=128,n.VOICE_MARK_KEY_BIT0=1,t.default=n},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,i){e.exports=!i(10)&&!i(17)((function(){return 7!=Object.defineProperty(i(76)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,i){var s=i(14),a=i(12).document,r=s(a)&&s(a.createElement);e.exports=function(e){return r?a.createElement(e):{}}},function(e,t,i){var s=i(18),a=i(21),r=i(123)(!1),n=i(50)("IE_PROTO");e.exports=function(e,t){var i,u=a(e),o=0,l=[];for(i in u)i!=n&&s(u,i)&&l.push(i);for(;t.length>o;)s(u,i=t[o++])&&(~r(l,i)||l.push(i));return l}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,i){e.exports=i(15)},function(e,t,i){var s=i(18),a=i(22),r=i(50)("IE_PROTO"),n=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),s(e,r)?e[r]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?n:null}},function(e,t,i){var s=i(55),a=i(8)("iterator"),r=i(23);e.exports=i(6).getIteratorMethod=function(e){if(null!=e)return e[a]||e["@@iterator"]||r[s(e)]}},function(e,t,i){e.exports={default:i(133),__esModule:!0}},function(e,t){},function(e,t,i){var s=i(15);e.exports=function(e,t,i){for(var a in t)i&&e[a]?e[a]=t[a]:s(e,a,t[a]);return e}},function(e,t){e.exports=function(e,t,i,s){if(!(e instanceof t)||void 0!==s&&s in e)throw TypeError(i+": incorrect invocation!");return e}},function(e,t,i){var s=i(14);e.exports=function(e,t){if(!s(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,i){var s=i(46);e.exports=Array.isArray||function(e){return"Array"==s(e)}},function(e,t,i){var s=i(9),a=i(6),r=i(17);e.exports=function(e,t){var i=(a.Object||{})[e]||Object[e],n={};n[e]=t(i),s(s.S+s.F*r((function(){i(1)})),"Object",n)}},function(e,t,i){"use strict";t.__esModule=!0;var s=n(i(156)),a=n(i(158)),r="function"==typeof a.default&&"symbol"==typeof s.default?function(e){return typeof e}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":typeof e};function n(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof a.default&&"symbol"===r(s.default)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":void 0===e?"undefined":r(e)}},function(e,t,i){var s=i(77),a=i(52).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return s(e,a)}},function(e,t,i){var s=i(31),a=i(28),r=i(21),n=i(42),u=i(18),o=i(75),l=Object.getOwnPropertyDescriptor;t.f=i(10)?l:function(e,t){if(e=r(e),t=n(t,!0),o)try{return l(e,t)}catch(e){}if(u(e,t))return a(!s.f.call(e,t),e[t])}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={STREAM_UNKNOWN:0,AUDIO_SPEEX:0,AUDIO_AACPLUS:1,AUDIO_SILK:2,AUDIO_AAC_44100HZ_STEREO_128KBPS:35,AUDIO_AAC_44100HZ_STEREO_160KBPS:36,AUDIO_AAC_44100HZ_STEREO_192KBPS:37,AUDIO_ELD_AAC_44100HZ_STEREO:38,AUDIO_ELD_AAC_SBR_44100HZ_STEREO:39,SIGNAL_STREAM_DATA:47,SIGNAL_STREAM_COMPRESS_DATA:48,AUDIO_MP3:50,AUDIO_NELLYMOSER:54,VIDEO_264_START:401,VIDEO_H264_100K:401,VIDEO_H264_500K:405,VIDEO_H264_800K:408,VIDEO_H264_1200K:412,VIDEO_H264_1500K:415,VIDEO_H264_2000K:420,VIDEO_H264_3000K:430,VIDEO_H264_4000K:440,VIDEO_H264_6000K:460,VIDEO_H264_8000K:480,VIDEO_H264_END:480,VIDEO_265_START:503,VIDEO_H265_300K:503,VIDEO_H265_500K:505,VIDEO_H265_800K:508,VIDEO_H265_1200K:512,VIDEO_H265_1500K:515,VIDEO_H265_2000K:520,VIDEO_H265_3000K:530,VIDEO_H265_4000K:540,VIDEO_H265_6000K:560,VIDEO_H265_8000K:580,VIDEO_H265_END:580,VIDEO_H264_EX_BASE:1e3,VIDEO_H264_EX_START:1005,VIDEO_H264_EX_500K:1005,VIDEO_H264_EX_1M:1010,VIDEO_H264_EX_5M:1050,VIDEO_H264_EX_8M:1080,VIDEO_H264_EX_10M:1100,VIDEO_H264_EX_12M:1120,VIDEO_H264_EX_15M:1150,VIDEO_H264_EX_20M:1200,VIDEO_H264_EX_END:1200,VIDEO_H265_EX_BASE:4e3,VIDEO_H265_EX_START:4005,VIDEO_H265_EX_500K:4005,VIDEO_H265_EX_1M:4010,VIDEO_H265_EX_5M:4050,VIDEO_H265_EX_8M:4080,VIDEO_H265_EX_10M:4100,VIDEO_H265_EX_12M:4120,VIDEO_H265_EX_15M:4150,VIDEO_H265_EX_20M:4200,VIDEO_H265_EX_END:4200}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,a=i(44),r=(s=a)&&s.__esModule?s:{default:s};var n={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(edg)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],s={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},a={};if(s.browser){a[s.browser]=!0;var u=s.majorVersion.split(".");a.version={major:parseInt(s.majorVersion,10),string:s.version},u.length>1&&(a.version.minor=parseInt(u[1],10)),u.length>2&&(a.version.build=parseInt(u[2],10))}if(s.platform&&(a[s.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),a.rv||a.iemobile){a.rv&&delete a.rv;s.browser="msie",a.msie=!0}if(a.edge){delete a.edge;s.browser="msedge",a.chrome=!0}if(a.edg){delete a.edg;s.browser="msedge",a.chrome=!0}if(a.opr){s.browser="opera",a.opera=!0}if(a.safari&&a.android){s.browser="android",a.android=!0}for(var o in a.name=s.browser,a.platform=s.platform,n)n.hasOwnProperty(o)&&delete n[o];(0,r.default)(n,a)}(),n.version||(n.version={major:0,minor:0,build:0,string:"0.0.0"}),t.default=n},function(e,t,i){"use strict";t.__esModule=!0;var s=r(i(181)),a=r(i(19));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,s.default)(Object(e)))return function(e,t){var i=[],s=!0,r=!1,n=void 0;try{for(var u,o=(0,a.default)(e);!(s=(u=o.next()).done)&&(i.push(u.value),!t||i.length!==t);s=!0);}catch(e){r=!0,n=e}finally{try{!s&&o.return&&o.return()}finally{if(r)throw n}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,i){var s={"./ApToken":64,"./ApToken.js":64,"./CurrentProxyInfo":61,"./CurrentProxyInfo.js":61,"./FuzzyQueryKey":25,"./FuzzyQueryKey.js":25,"./FuzzyQueryParam":60,"./FuzzyQueryParam.js":60,"./IpInfo":65,"./IpInfo.js":65,"./MeasureValueType":66,"./MeasureValueType.js":66,"./MetaDataInfo":67,"./MetaDataInfo.js":67,"./PAudienceGetProxyListReq":38,"./PAudienceGetProxyListReq.js":38,"./PAudienceGetProxyListRsp":96,"./PAudienceGetProxyListRsp.js":96,"./PForceConnectVideoProxy3":97,"./PForceConnectVideoProxy3.js":97,"./PLoginVideoProxyUniformly":40,"./PLoginVideoProxyUniformly.js":40,"./PLoginVideoProxyUniformlyRes":98,"./PLoginVideoProxyUniformlyRes.js":98,"./PNotifyCurrentStream4":99,"./PNotifyCurrentStream4.js":99,"./PNotifyStreamSwitch":100,"./PNotifyStreamSwitch.js":100,"./PNotifyUplinkRecvCount3":101,"./PNotifyUplinkRecvCount3.js":101,"./PP2pVideoPing3":102,"./PP2pVideoPing3.js":102,"./PPullStreamData":69,"./PPullStreamData.js":69,"./PReSendStreamData4":70,"./PReSendStreamData4.js":70,"./PResendStreamDataFailAck":103,"./PResendStreamDataFailAck.js":103,"./PStopStream":104,"./PStopStream.js":104,"./PStopStream3":105,"./PStopStream3.js":105,"./PStreamData3":106,"./PStreamData3.js":106,"./PSubscribeStream3":71,"./PSubscribeStream3.js":71,"./PSubscribeStreamRes3":107,"./PSubscribeStreamRes3.js":107,"./PUpdateVideoConfig2":108,"./PUpdateVideoConfig2.js":108,"./PVideoBroadcast4":109,"./PVideoBroadcast4.js":109,"./PVideoProxyPing3":41,"./PVideoProxyPing3.js":41,"./PVideoProxyPingRes4":110,"./PVideoProxyPingRes4.js":110,"./PVideoSyncSpeakerTime3":111,"./PVideoSyncSpeakerTime3.js":111,"./SlaveProxyInfo":27,"./SlaveProxyInfo.js":27,"./StreamAllocateInfo":68,"./StreamAllocateInfo.js":68,"./StreamCodecType":26,"./StreamCodecType.js":26,"./StreamGroupID":4,"./StreamGroupID.js":4,"./StreamType":39,"./StreamType.js":39,"./SubscribeResCode":72,"./SubscribeResCode.js":72,"./VoiceChatEx":73,"./VoiceChatEx.js":73,"./VpToken":63,"./VpToken.js":63};function a(e){var t=r(e);return i(t)}function r(e){if(!i.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}a.keys=function(){return Object.keys(s)},a.resolve=r,e.exports=a,a.id=95},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(5)),a=u(i(0)),r=u(i(1)),n=(u(i(3)),u(i(68)));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,a.default)(this,e),this.uid=0,this.allocatedStreams=new s.default,this.clientAppid=0,this.clientType=0,this.sendTime=0,this.userArea=0,this.videoGroupId=0,this.retryType=0,this.retryFreq=0,this.result=0,this.proxyType=0,this.tokenVersion=0,this.sslUrl=""}return(0,r.default)(e,[{key:"unmarshall",value:function(e){this.uid=e.popUInt64(),this.allocatedStreams.clear();for(var t=e.popUInt32(),i=0;i<t;i++){for(var s=e.popString(),a=[],r=e.popUInt32(),u=0;u<r;u++){var o=new n.default;a.push(o.unmarshall(e))}this.allocatedStreams.set(s,a)}return this.clientAppid=e.popUInt32(),this.clientType=e.popUInt32(),this.sendTime=e.popUInt32(),this.userArea=e.popUInt32(),this.videoGroupId=e.popUInt32(),this.retryType=e.popUInt8(),this.retryFreq=e.popUInt16(),this.result=e.popUInt32(),this.proxyType=e.popUInt32(),this.tokenVersion=e.popUInt32(),this.sslUrl=e.popString(),this}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(0)),a=o(i(1)),r=(o(i(3)),o(i(4))),n=o(i(65)),u=o(i(27));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,s.default)(this,e),this.streamGroupId=new r.default,this.reconnectTime=0,this.videoProxyInfo=[],this.reconnectStatu=0,this.videoProxyIpInfo=[],this.reason=0}return(0,a.default)(e,[{key:"unmarshall",value:function(e){this.streamGroupId.unmarshall(e),this.reconnectTime=e.popUInt32(),this.videoProxyInfo=[];for(var t=e.popUInt32(),i=0;i<t;i++){var s=new n.default;this.videoProxyInfo.push(s.unmarshall(e))}this.reconnectStatu=e.popUInt8(),this.videoProxyIpInfo=[];for(t=e.popUInt32(),i=0;i<t;i++){s=new u.default;this.videoProxyIpInfo.push(s.unmarshall(e))}return this.reason=e.popUInt8(),this}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=(n(i(3)),n(i(4)));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.streamGroupIds=[],this.uid=0,this.wlanIp=0,this.wlanPort=0,this.reject=0,this.clientAreaType=0,this.proxyAreaType=0,this.firstViewer=0,this.clientAppid=0,this.subscribe=0}return(0,a.default)(e,[{key:"unmarshall",value:function(e){this.streamGroupIds=[];for(var t=e.popUInt32(),i=0;i<t;i++){var s=new r.default;this.streamGroupIds.push(s.unmarshall(e))}return this.uid=e.popUInt64(),this.wlanIp=e.popUInt32(),this.wlanPort=e.popUInt16(),this.reject=e.popUInt8(),this.clientAreaType=e.popUInt16(),this.proxyAreaType=e.popUInt16(),this.firstViewer=e.popUInt8(),this.clientAppid=e.popUInt32(),this.subscribe=e.popUInt8(),this}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(5)),a=u(i(0)),r=u(i(1)),n=(u(i(3)),u(i(4)));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,a.default)(this,e),this.streamGroupId=new n.default,this.uid=0,this.metaDatasMap=new s.default,this.streamName=""}return(0,r.default)(e,[{key:"unmarshall",value:function(e){this.streamGroupId.unmarshall(e),this.uid=e.popUInt64(),this.metaDatasMap.clear();for(var t=e.popUInt32(),i=0;i<t;i++){var s=e.popUInt8(),a=e.popUInt32();this.metaDatasMap.set(s,a)}return e.bytesAvailable()>0?this.streamName=e.popString():this.streamName=this.streamGroupId.text(),this}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(0)),a=u(i(1)),r=u(i(3)),n=u(i(7));u(i(4));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,s.default)(this,e),this.streamGroupIds=[],this.switchReason=""}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new n.default;return e.setUri(r.default.PNotifyStreamSwitch),e.pushUInt32(this.streamGroupIds.length),this.streamGroupIds.forEach((function(t){e.pushUint8ArrayWithoutLen(t.marshall())})),e.pushString(this.switchReason),e.marshall()}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=(n(i(3)),n(i(4)));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.streamGroupIds=[],this.uid=0,this.sendCount=0,this.recvCount=0,this.reserve=0}return(0,a.default)(e,[{key:"unmarshall",value:function(e){this.streamGroupIds=[];for(var t=e.popUInt32(),i=0;i<t;i++){var s=new r.default;this.streamGroupIds.push(s.unmarshall(e))}return this.uid=e.popUInt64(),this.sendCount=e.popUInt32(),this.recvCount=e.popUInt32(),this.reserve=e.popUInt32(),this}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(0)),a=u(i(1)),r=(u(i(3)),u(i(4))),n=u(i(66));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,s.default)(this,e),this.streamGroupId=new r.default,this.uid=0,this.serial=0,this.measureType=0,this.measureValues=[]}return(0,a.default)(e,[{key:"unmarshall",value:function(e){this.streamGroupId.unmarshall(e),this.uid=e.popUInt64(),this.serial=e.popUInt32(),this.measureType=e.popUInt8(),this.measureValues=[];for(var t=e.popUInt32(),i=0;i<t;i++){var s=new n.default;this.measureValues.push(s.unmarshall(e))}return this}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=(n(i(3)),n(i(4)));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.streamGroupId=new r.default,this.failReason=0,this.seqNums=[]}return(0,a.default)(e,[{key:"unmarshall",value:function(e){return this.streamGroupId.unmarshall(e),this.failReason=e.popUInt8(),this.seqNums=e.popUInt32Vector(),this}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=(n(i(3)),n(i(4)));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.streamGroupId=new r.default,this.uid=0}return(0,a.default)(e,[{key:"unmarshall",value:function(e){return this.streamGroupId.unmarshall(e),this.uid=e.popUInt64(),this}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=(n(i(3)),n(i(4)));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.streamGroupId=new r.default,this.uid=0}return(0,a.default)(e,[{key:"unmarshall",value:function(e){return this.streamGroupId.unmarshall(e),this.uid=e.popUInt64(),this}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l(i(0)),a=l(i(1)),r=l(i(3)),n=l(i(7)),u=l(i(4)),o=l(i(2));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(){(0,s.default)(this,e),this.streamGroupId=new u.default,this.uid=0,this.seqNum=0,this.priority=0,this.lastKeyFrame=0,this.playTime=0,this.frameNum=0,this.stampc=0,this.ext=0,this.checkSum=0,this.streamData=null,this.dts=o.default.Utils.UintMax,this.uplinkResendTimes=0,this.isDownlinkResend=!1,this.fromPeer=!1,this.recvOsTime=0}return(0,a.default)(e,[{key:"reset",value:function(){this.streamGroupId=new u.default,this.uid=0,this.seqNum=0,this.priority=0,this.lastKeyFrame=0,this.playTime=0,this.frameNum=0,this.stampc=0,this.ext=0,this.checkSum=0,this.streamData=null,this.uplinkResendTimes=0,this.dts=o.default.Utils.UintMax,this.isDownlinkResend=!1,this.fromPeer=!1,this.recvOsTime=0}},{key:"marshall",value:function(){var e=new n.default;return e.setUri(r.default.PStreamData3),e.pushUint8ArrayWithoutLen(this.streamGroupId.marshall()),e.pushUInt64(this.uid),e.pushUInt32(this.seqNum),e.pushUInt8(this.priority),e.pushUInt32(this.lastKeyFrame),e.pushUInt16(this.playTime),e.pushUInt16(this.frameNum),e.pushUInt32(this.stampc),e.pushUInt32(this.ext),e.pushUInt8(this.checkSum),e.pushUint8Array32(this.streamData),e.marshall()}},{key:"unmarshall",value:function(e){return this.streamGroupId.unmarshall(e),this.uid=e.popUInt64(),this.seqNum=e.popUInt32(),this.priority=e.popUInt8(),this.lastKeyFrame=e.popUInt32(),this.playTime=e.popUInt16(),this.frameNum=e.popUInt16(),this.stampc=e.popUInt32(),this.ext=e.popUInt32(),this.checkSum=e.popUInt8(),this.streamData=e.popUint8Array32(),this}},{key:"getFrameTime",value:function(){if(this.dts!==o.default.Utils.UintMax)return this.dts;if(!this.isFirstSeq)return o.default.Utils.UintMax;var e=0;0===this.frameType&&(e=this.streamData[0],e+=this.streamData[1]<<8,e+=this.streamData[2]<<16,e+=this.streamData[3]<<24>>>0,e+=4);var t=(255&this.streamData[e+7])<<24>>>0,i=(255&this.streamData[e+4])<<16,s=(255&this.streamData[e+5])<<8,a=255&this.streamData[e+6];return this.dts=t+i+s+a,this.dts}},{key:"isVideo",get:function(){return this.streamGroupId.isVideoStream}},{key:"isAudio",get:function(){return this.streamGroupId.isAudioStream}},{key:"frameType",get:function(){return 3&this.priority}},{key:"isFirstSeq",get:function(){return 0!=(4096&this.playTime)}},{key:"isUplinkResend",get:function(){return 0!=(32768&this.playTime)}},{key:"isFastAccessPacket",get:function(){return 0!=(512&this.playTime)}},{key:"isForceSubscribePacket",get:function(){return 0!=(1024&this.playTime)}},{key:"isRawStreamInput",get:function(){return 0!=(16384&this.playTime)}},{key:"isServerResend",get:function(){return 0!=(8192&this.playTime)}},{key:"hasCheckSum",get:function(){return 0!=(2048&this.playTime)}}]),e}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=(n(i(3)),n(i(4)));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.streamGroupIds=[],this.uid=0,this.subscribe=!1,this.resCode=0,this.firstSeq=0,this.lastSeq=0,this.firstDts=0,this.lastDts=0}return(0,a.default)(e,[{key:"unmarshall",value:function(e){this.streamGroupIds=[];for(var t=e.popUInt32(),i=0;i<t;i++){var s=new r.default;this.streamGroupIds.push(s.unmarshall(e))}return this.uid=e.popUInt64(),this.subscribe=e.popBool(),this.resCode=e.popUInt16(),this.firstSeq=e.popUInt32(),this.lastSeq=e.popUInt32(),this.firstDts=e.popUInt32(),this.lastDts=e.popUInt32(),this}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(5)),a=n(i(0)),r=n(i(1));n(i(3));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,a.default)(this,e),this.appid=0,this.configInfo=new s.default,this.streamCodecType=0}return(0,r.default)(e,[{key:"unmarshall",value:function(e){this.appid=e.popUInt32(),this.configInfo.clear();for(var t=e.popUInt32(),i=0;i<t;i++){var s=e.popUInt16(),a=e.popUInt32();this.configInfo.set(s,a)}return this.streamCodecType=e.popUInt32(),this}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(5)),a=u(i(0)),r=u(i(1)),n=(u(i(3)),u(i(4)));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,a.default)(this,e),this.streamGroupId=new n.default,this.uid=0,this.metaDatas=new s.default,this.stringDatas=new s.default}return(0,r.default)(e,[{key:"unmarshall",value:function(e){this.streamGroupId.unmarshall(e),this.uid=e.popUInt64(),this.metaDatas.clear();for(var t=e.popUInt32(),i=0;i<t;i++){var s=e.popUInt32(),a=e.popUInt32();this.metaDatas.set(s,a)}this.stringDatas.clear();for(t=e.popUInt32(),i=0;i<t;i++){s=e.popUInt32(),a=e.popString();this.stringDatas.set(s,a)}return this}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));r(i(3));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){(0,s.default)(this,e),this.stampc=0,this.stamps=0,this.proxyRtt=0,this.wanIp=0,this.wanPort=0,this.reserved=0,this.peerType=0}return(0,a.default)(e,[{key:"unmarshall",value:function(e){return this.stampc=e.popUInt32(),this.stamps=e.popUInt32(),this.proxyRtt=e.popUInt32(),this.wanIp=e.popUInt32(),this.wanPort=e.popUInt16(),this.reserved=e.popUInt32(),this.peerType=e.popUInt8(),this}}]),e}();t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(5)),a=u(i(0)),r=u(i(1)),n=(u(i(3)),u(i(4)));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,a.default)(this,e),this.streamGroupId=new n.default,this.uid=0,this.localTime=0,this.osTime=0,this.minBw=0,this.streamId2SpeakerDelay=new s.default,this.curCodeRate=0,this.reserve=0,this.metaDatas=new s.default}return(0,r.default)(e,[{key:"unmarshall",value:function(e){this.streamGroupId.unmarshall(e),this.uid=e.popUInt64(),this.localTime=e.popUInt32(),this.osTime=e.popUInt32(),this.minBw=e.popUInt32(),this.streamId2SpeakerDelay.clear();for(var t=e.popUInt32(),i=0;i<t;i++){(a=new n.default).unmarshall(e);var s=e.popUInt32();this.streamId2SpeakerDelay.set(a,s)}this.curCodeRate=e.popUInt16(),this.reserve=e.popUInt32(),this.metaDatas.clear();for(t=e.popUInt32(),i=0;i<t;i++){var a=e.popUInt8();s=e.popUInt32();this.metaDatas.set(a,s)}return this}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={FRAMETYPE_VIDEO_I:0,FRAMETYPE_VIDEO_P:1,FRAMETYPE_VIDEO_B:2,FRAMETYPE_VIDEO_SP:3}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=h(i(206)),a=h(i(0)),r=h(i(1)),n=h(i(11)),u=h(i(209)),o=h(i(25)),l=h(i(38)),d=h(i(2));function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t,i){(0,a.default)(this,e),this.hyPlayer=t,this.huyaMgr=i,this.audioLinkDict={},this.audioLinkTsDict={},this.audioPlayers={},localStorage._windowCall&&(window._audioLinks=this.audioLinkDict,window._startVoice=this.startVoice.bind(this))}return(0,r.default)(e,[{key:"reset",value:function(){this.stopAllVoice(),this.audioLinkDict={},this.audioLinkTsDict={},window._audioLinks=this.audioLinkDict}},{key:"updateAudioPlay",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(d.default.logger.log("AudioMgr.updateAudioPlay: ",t),t)if(t.length>0){var i=(0,s.default)(this.audioPlayers);t.forEach((function(t){var s=t.unionId;if(!e.audioPlayers[s]){var a=t.uid||e._generateUid();t.uid||d.default.logger.warn("info.uid is empty, use cryptonym uid: ",a),e.audioPlayers[s]={presenterUid:a,streamName:t.streamName,volume:t.volume},e.startVoice({presenterUid:a,streamName:t.streamName,volume:t.volume,isPureAudio:!0})}var r=i.findIndex((function(e){return String(e)===String(s)}));r>=0&&(r>=0&&i.splice(r,1),d.default.logger.log("AudioMgr.updateAudioPlay: %cstreamName="+t.streamName+" is running","color:#1890ff"))})),i.length>0&&i.forEach((function(t){var i=e.audioPlayers[t].streamName;e.stopVoice(i),e.audioPlayers[t]=void 0}))}else this.stopAllVoice();else d.default.logger.warn("AudioMgr.updateAudioPlay: infos cannot be null")}},{key:"startVoice",value:function(e){var t=e.streamName,i=e.subSid,s=e.presenterUid,a=e.serviceType,r=e.isPureAudio;d.default.logger.log("AudioMgr.startVoice: streamName=%s, presenterUid=%s",t,s),this._getVoiceProxy({streamName:t,subSid:i,presenterUid:s,serviceType:a}),this.huyaMgr&&(this.huyaMgr.startVoice(),this.huyaMgr.setAudioInfo(s,t),this.huyaMgr.setPureAudio(r))}},{key:"stopVoice",value:function(e){var t=this.audioLinkDict[e];if(t){d.default.logger.log("%cAudioMgr.stopVoice "+e,"background:#FFBFFF"),delete this.audioLinkDict[e];var i=t.presenterUid;t.destroy(),this.huyaMgr&&this.huyaMgr.stopPlayer(i)}}},{key:"stopAllVoice",value:function(){for(var e in d.default.logger.log("AudioMgr.stopAllVoice"),this.audioLinkDict){var t=this.audioLinkDict[e];if(t){var i=t.presenterUid;t.destroy(),this.huyaMgr&&this.huyaMgr.stopPlayer(i)}}this.audioLinkDict={},window._audioLinks=this.audioLinkDict,this.audioPlayers={}}},{key:"sendToAudioServ",value:function(e,t){var i=this.audioLinkDict[e];i&&t&&i.send(t)}},{key:"_generateUid",value:function(){var e=(Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295;return d.default.logger.log("AudioMgr._generateUid uid=",e),e}},{key:"_getVoiceProxy",value:function(e){var t=e.streamName,i=e.subSid,s=e.presenterUid,a=e.serviceType,r=d.default.TimeUtil.now(),u=this.audioLinkTsDict[t];if(u&&r-u<1e3)d.default.logger.warn("AudioMgr._getVoiceProxy exist",t);else{this.audioLinkTsDict[t]=r;var h=new o.default;h.sid=i||0,h.fuzzyParam.h264Only=!0,h.fuzzyParam.maxCodeRateH264=480,h.fuzzyParam.maxCodeRateH265=580;var f=this._generateUid(),c=new l.default;c.uid=f,c.version=1,c.sdkVersion=1,c.fuzzyQueryKeys=[h],c.streamNames=[t],c.appid=d.default.UserInfo.appid,c.clientAppid=0,c.clientType=4,c.sendTime=.001*Date.now()>>0,c.useCase=1;var p={serviceType:a||0,streamName:t,subSid:i||0,presenterUid:s};d.default.logger.log("AudioMgr._getVoiceProxy uid="+f,c),n.default.proxyLink.sendYY(c,this._onVoiceProxy(p,f).bind(this),f,!1)}}},{key:"_onVoiceProxy",value:function(e,t){var i=this;return function(s){if(s.uid==t){if(0!=s.result){var a="UNKNOWN ERROR!";return 1==s.result?a="EGetVP_NO_RESOURCE":2==s.result&&(a="EGetVP_FUZZY_NO_MATCH"),void d.default.logger.warn("AudioMgr._getVoiceProxy",a,s)}var r=e.streamName;i.stopVoice(r),d.default.logger.log("%cAudioMgr._onVoiceProxy lPresenterUid="+e.presenterUid+"\nsStreamName="+r,"background:#FFBFFF",s);var n=new u.default(e);n.uid=t,n.connect(s),i.audioLinkDict[r]=n}else d.default.logger.warn("[x] AudioMgr._onVoiceProxy No requested uid.")}}}]),e}();t.default=f},function(e,t,i){e.exports=i(115)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=h(i(0)),a=h(i(2)),r=h(i(116)),n=h(i(180)),u=h(i(205)),o=h(i(210)),l=h(i(211)),d=h(i(113));function h(e){return e&&e.__esModule?e:{default:e}}var f=function e(t){(0,s.default)(this,e),a.default.UserInfo=t.UserInfo,a.default.roomInfo=t.roomInfo,a.default.config=t.config,a.default.TafLink=t.TafLink,a.default.Timer=t.Timer,a.default.TimeUtil=t.TimeUtil,a.default.logger=t.logger,a.default.HUYA=t.HUYA,a.default.Taf=t.Taf,a.default.Const=t.Const,a.default.Event=t.Event,a.default.StatCfg=t.StatCfg,a.default.P2PLibProxy=t.P2PLibProxy,a.default.Ntp=t.Ntp,a.default.AverageCalculator=t.AverageCalculator,a.default.Utils=t.Utils,a.default.ProtoLink=t.ProtoLink,a.default.Status=t.Status,a.default.MetadataTick=t.MetadataTick,a.default.MSEPlayer=t.MSEPlayer,a.default.AacFrame=t.AacFrame,a.default.init()};t.default=f,f.StreamPlayer=r.default,f.HuyaMgr=n.default,f.LiveMeetingMgr=u.default,f.VoiceStreamMgr=o.default,f.VideoPixelateUtil=l.default,f.AudioMgr=d.default,window.MainLib=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l(i(0)),a=l(i(1)),r=l(i(43)),n=l(i(57)),u=l(i(179)),o=l(i(2));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t){(0,s.default)(this,e),this.hyPlayer=t,o.default.UserInfo.uuid=t.uuid,r.default.streamPlayer=this,r.default.tsdbUtil=t.tsdbUtil,r.default.tsdbStat=t.stat}return(0,a.default)(e,[{key:"start",value:function(e){e.curBitrate=2e3,u.default.isSupportP2P()?n.default.signalUserProperty=1:n.default.signalUserProperty=2,r.default.start(e)}},{key:"stop",value:function(){r.default.stop()}},{key:"stopStream",value:function(e){r.default.stopStream(e)}},{key:"destroy",value:function(){this.stop()}},{key:"turnToFlv",value:function(e){}}]),e}();t.default=d},function(e,t,i){e.exports={default:i(118),__esModule:!0}},function(e,t,i){i(119);var s=i(6).Object;e.exports=function(e,t,i){return s.defineProperty(e,t,i)}},function(e,t,i){var s=i(9);s(s.S+s.F*!i(10),"Object",{defineProperty:i(13).f})},function(e,t,i){i(121),e.exports=i(6).Object.assign},function(e,t,i){var s=i(9);s(s.S+s.F,"Object",{assign:i(122)})},function(e,t,i){"use strict";var s=i(10),a=i(24),r=i(53),n=i(31),u=i(22),o=i(45),l=Object.assign;e.exports=!l||i(17)((function(){var e={},t={},i=Symbol(),s="abcdefghijklmnopqrst";return e[i]=7,s.split("").forEach((function(e){t[e]=e})),7!=l({},e)[i]||Object.keys(l({},t)).join("")!=s}))?function(e,t){for(var i=u(e),l=arguments.length,d=1,h=r.f,f=n.f;l>d;)for(var c,p=o(arguments[d++]),v=h?a(p).concat(h(p)):a(p),y=v.length,m=0;y>m;)c=v[m++],s&&!f.call(p,c)||(i[c]=p[c]);return i}:l},function(e,t,i){var s=i(21),a=i(48),r=i(124);e.exports=function(e){return function(t,i,n){var u,o=s(t),l=a(o.length),d=r(n,l);if(e&&i!=i){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===i)return e||d||0;return!e&&-1}}},function(e,t,i){var s=i(49),a=Math.max,r=Math.min;e.exports=function(e,t){return(e=s(e))<0?a(e+t,0):r(e,t)}},function(e,t,i){i(32),i(35),e.exports=i(132)},function(e,t,i){"use strict";var s=i(127),a=i(78),r=i(23),n=i(21);e.exports=i(54)(Array,"Array",(function(e,t){this._t=n(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values"),r.Arguments=r.Array,s("keys"),s("values"),s("entries")},function(e,t){e.exports=function(){}},function(e,t,i){"use strict";var s=i(33),a=i(28),r=i(34),n={};i(15)(n,i(8)("iterator"),(function(){return this})),e.exports=function(e,t,i){e.prototype=s(n,{next:a(1,i)}),r(e,t+" Iterator")}},function(e,t,i){var s=i(13),a=i(16),r=i(24);e.exports=i(10)?Object.defineProperties:function(e,t){a(e);for(var i,n=r(t),u=n.length,o=0;u>o;)s.f(e,i=n[o++],t[i]);return e}},function(e,t,i){var s=i(12).document;e.exports=s&&s.documentElement},function(e,t,i){var s=i(49),a=i(47);e.exports=function(e){return function(t,i){var r,n,u=String(a(t)),o=s(i),l=u.length;return o<0||o>=l?e?"":void 0:(r=u.charCodeAt(o))<55296||r>56319||o+1===l||(n=u.charCodeAt(o+1))<56320||n>57343?e?u.charAt(o):r:e?u.slice(o,o+2):n-56320+(r-55296<<10)+65536}}},function(e,t,i){var s=i(16),a=i(81);e.exports=i(6).getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return s(t.call(e))}},function(e,t,i){var s=i(6),a=s.JSON||(s.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},function(e,t,i){i(83),i(35),i(32),i(135),i(144),i(147),i(149),e.exports=i(6).Map},function(e,t,i){"use strict";var s=i(136),a=i(86);e.exports=i(140)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=s.getEntry(a(this,"Map"),e);return t&&t.v},set:function(e,t){return s.def(a(this,"Map"),0===e?0:e,t)}},s,!0)},function(e,t,i){"use strict";var s=i(13).f,a=i(33),r=i(84),n=i(20),u=i(85),o=i(36),l=i(54),d=i(78),h=i(139),f=i(10),c=i(56).fastKey,p=i(86),v=f?"_s":"size",y=function(e,t){var i,s=c(t);if("F"!==s)return e._i[s];for(i=e._f;i;i=i.n)if(i.k==t)return i};e.exports={getConstructor:function(e,t,i,l){var d=e((function(e,s){u(e,d,t,"_i"),e._t=t,e._i=a(null),e._f=void 0,e._l=void 0,e[v]=0,null!=s&&o(s,i,e[l],e)}));return r(d.prototype,{clear:function(){for(var e=p(this,t),i=e._i,s=e._f;s;s=s.n)s.r=!0,s.p&&(s.p=s.p.n=void 0),delete i[s.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var i=p(this,t),s=y(i,e);if(s){var a=s.n,r=s.p;delete i._i[s.i],s.r=!0,r&&(r.n=a),a&&(a.p=r),i._f==s&&(i._f=a),i._l==s&&(i._l=r),i[v]--}return!!s},forEach:function(e){p(this,t);for(var i,s=n(e,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(s(i.v,i.k,this);i&&i.r;)i=i.p},has:function(e){return!!y(p(this,t),e)}}),f&&s(d.prototype,"size",{get:function(){return p(this,t)[v]}}),d},def:function(e,t,i){var s,a,r=y(e,t);return r?r.v=i:(e._l=r={i:a=c(t,!0),k:t,v:i,p:s=e._l,n:void 0,r:!1},e._f||(e._f=r),s&&(s.n=r),e[v]++,"F"!==a&&(e._i[a]=r)),e},getEntry:y,setStrong:function(e,t,i){l(e,t,(function(e,i){this._t=p(e,t),this._k=i,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?d(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,d(1))}),i?"entries":"values",!i,!0),h(t)}}},function(e,t,i){var s=i(16);e.exports=function(e,t,i,a){try{return a?t(s(i)[0],i[1]):t(i)}catch(t){var r=e.return;throw void 0!==r&&s(r.call(e)),t}}},function(e,t,i){var s=i(23),a=i(8)("iterator"),r=Array.prototype;e.exports=function(e){return void 0!==e&&(s.Array===e||r[a]===e)}},function(e,t,i){"use strict";var s=i(12),a=i(6),r=i(13),n=i(10),u=i(8)("species");e.exports=function(e){var t="function"==typeof a[e]?a[e]:s[e];n&&t&&!t[u]&&r.f(t,u,{configurable:!0,get:function(){return this}})}},function(e,t,i){"use strict";var s=i(12),a=i(9),r=i(56),n=i(17),u=i(15),o=i(84),l=i(36),d=i(85),h=i(14),f=i(34),c=i(13).f,p=i(141)(0),v=i(10);e.exports=function(e,t,i,y,m,g){var _=s[e],S=_,P=m?"set":"add",T=S&&S.prototype,k={};return v&&"function"==typeof S&&(g||T.forEach&&!n((function(){(new S).entries().next()})))?(S=t((function(t,i){d(t,S,e,"_c"),t._c=new _,null!=i&&l(i,m,t[P],t)})),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in T)||g&&"clear"==e||u(S.prototype,e,(function(i,s){if(d(this,S,e),!t&&g&&!h(i))return"get"==e&&void 0;var a=this._c[e](0===i?0:i,s);return t?this:a}))})),g||c(S.prototype,"size",{get:function(){return this._c.size}})):(S=y.getConstructor(t,e,m,P),o(S.prototype,i),r.NEED=!0),f(S,e),k[e]=S,a(a.G+a.W+a.F,k),g||y.setStrong(S,e,m),S}},function(e,t,i){var s=i(20),a=i(45),r=i(22),n=i(48),u=i(142);e.exports=function(e,t){var i=1==e,o=2==e,l=3==e,d=4==e,h=6==e,f=5==e||h,c=t||u;return function(t,u,p){for(var v,y,m=r(t),g=a(m),_=s(u,p,3),S=n(g.length),P=0,T=i?c(t,S):o?c(t,0):void 0;S>P;P++)if((f||P in g)&&(y=_(v=g[P],P,m),e))if(i)T[P]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return P;case 2:T.push(v)}else if(d)return!1;return h?-1:l||d?d:T}}},function(e,t,i){var s=i(143);e.exports=function(e,t){return new(s(e))(t)}},function(e,t,i){var s=i(14),a=i(87),r=i(8)("species");e.exports=function(e){var t;return a(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),s(t)&&null===(t=t[r])&&(t=void 0)),void 0===t?Array:t}},function(e,t,i){var s=i(9);s(s.P+s.R,"Map",{toJSON:i(145)("Map")})},function(e,t,i){var s=i(55),a=i(146);e.exports=function(e){return function(){if(s(this)!=e)throw TypeError(e+"#toJSON isn't generic");return a(this)}}},function(e,t,i){var s=i(36);e.exports=function(e,t){var i=[];return s(e,!1,i.push,i,t),i}},function(e,t,i){i(148)("Map")},function(e,t,i){"use strict";var s=i(9);e.exports=function(e){s(s.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,i){i(150)("Map")},function(e,t,i){"use strict";var s=i(9),a=i(74),r=i(20),n=i(36);e.exports=function(e){s(s.S,e,{from:function(e){var t,i,s,u,o=arguments[1];return a(this),(t=void 0!==o)&&a(o),null==e?new this:(i=[],t?(s=0,u=r(o,arguments[2],2),n(e,!1,(function(e){i.push(u(e,s++))}))):n(e,!1,i.push,i),new this(i))}})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=v(i(152)),a=v(i(0)),r=v(i(1)),n=v(i(155)),u=v(i(165)),o=v(i(2)),l=v(i(173)),d=v(i(174)),h=v(i(177)),f=v(i(178)),c=v(i(3)),p=v(i(43));function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(e,i){(0,a.default)(this,t);var r=(0,n.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return r.info=e,r.streamId=new l.default,r.onTurnBack=null,r.isStop=!1,r.stream=null,r.comParser=new d.default(r,o.default.P2PLibProxy),r.record=new f.default(r),r.recvTime=o.default.TimeUtil.now(),r.getStreamInfo(e.presenterUid,e.sStreamName),r.hyPlayer=i,r}return(0,u.default)(t,e),(0,r.default)(t,[{key:"getStreamInfo",value:function(e,t){var i=this;o.default.TafLink.connected?this._getStreamInfo(e,t):o.default.TafLink.on(o.default.TafLink.TAFLINK_INITED,(function(){i._getStreamInfo(e,t)}))}},{key:"_getStreamInfo",value:function(e,t){var i=new o.default.HUYA.GetP2PStreamInfoReq;i.lUid=e,i.sStreamName=t,i.iP2PType=o.default.config.iP2PType,-1!==o.default.config.danmuZipPids.indexOf(e+"")&&(i.iP2PType=2),localStorage._iP2PType&&(i.iP2PType=Number(localStorage._iP2PType)),o.default.logger.log("WebrtcStream.getStreamInfo","lUid",e,"streamName",t),o.default.TafLink.sendWup("mediaui","getP2PStreamInfo",i,this.onGetStreamInfo.bind(this),!0,o.default.TafLink.getRequestId())}},{key:"onGetStreamInfo",value:function(e){o.default.logger.log("WebrtcStream.onGetStreamInfo","sP2PUrl",e.sP2PUrl,"sCodecType",e.sCodecType,"sCdnBrand",e.sCdnBrand,"sP2pAntiCode",e.sP2PToken,"pkg.mpOption.baseSubs",e.mpOption.get(1),"Config.baseSubs",o.default.config.baseSubs),this.isStop||e.sStreamName!==this.info.sStreamName||(this.info.codecType=e.sCodecType,this.info.cdnBrand=e.sCdnBrand,this.info.antiCode=e.sP2PToken,this.info.streamUrl=e.sP2PUrl,this.info.lineType=e.line||0,this.loadLib())}},{key:"loadLib",value:function(){o.default.logger.log("WebrtcStream.loadLib"),o.default.P2PLibProxy.on(o.default.P2PLibProxy.ON_LOAD,this.onLoadLib,this),o.default.P2PLibProxy.loadLib(this.info.h5Root,this.hyPlayer)}},{key:"onLoadLib",value:function(){o.default.logger.log("WebrtcStream.onLoadLib"),o.default.P2PLibProxy.off(o.default.P2PLibProxy.ON_LOAD,this.onLoadLib,this),this.isStop||this.startStream()}},{key:"startStream",value:function(){o.default.P2PLibProxy.hasLib()?(o.default.logger.log("WebrtcStream.startStream"),this.stream=o.default.P2PLibProxy.playStream(this.info),this.stream.streamHandler=this,this.stream.tsdbUtil=p.default.tsdbUtil,this.stream.tsdbStat=p.default.tsdbStat,this.stream.start(),this.comParser.start()):o.default.logger.log("WebrtcStream.startStream P2PLibProxy load fail")}},{key:"onSliceData",value:function(e){this.recvTime=o.default.TimeUtil.now(),e.parent.uri===c.default.PP2pSliceSignalData&&this.comParser.recvSignalSlice(e.child)}},{key:"stop",value:function(){this.isStop=!0,this.comParser.reset(),o.default.P2PLibProxy.removeStream(this.stream),this.stream=null}},{key:"turnToFlv",value:function(e){o.default.logger.log("WebrtcStream.turnBack reason",e,this.info.sStreamName),this.onTurnBack&&this.onTurnBack(this,e)}},{key:"getMetric",value:function(e){return this.record.getMetric(e)}},{key:"printInfo",value:function(){this.stream&&this.stream.printInfo()}}]),t}(h.default);t.default=y},function(e,t,i){e.exports={default:i(153),__esModule:!0}},function(e,t,i){i(154),e.exports=i(6).Object.getPrototypeOf},function(e,t,i){var s=i(22),a=i(80);i(88)("getPrototypeOf",(function(){return function(e){return a(s(e))}}))},function(e,t,i){"use strict";t.__esModule=!0;var s,a=i(89),r=(s=a)&&s.__esModule?s:{default:s};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,r.default)(t))&&"function"!=typeof t?e:t}},function(e,t,i){e.exports={default:i(157),__esModule:!0}},function(e,t,i){i(35),i(32),e.exports=i(58).f("iterator")},function(e,t,i){e.exports={default:i(159),__esModule:!0}},function(e,t,i){i(160),i(83),i(163),i(164),e.exports=i(6).Symbol},function(e,t,i){"use strict";var s=i(12),a=i(18),r=i(10),n=i(9),u=i(79),o=i(56).KEY,l=i(17),d=i(51),h=i(34),f=i(30),c=i(8),p=i(58),v=i(59),y=i(161),m=i(87),g=i(16),_=i(14),S=i(22),P=i(21),T=i(42),k=i(28),I=i(33),E=i(162),R=i(91),U=i(53),A=i(13),M=i(24),C=R.f,D=A.f,O=E.f,V=s.Symbol,x=s.JSON,w=x&&x.stringify,N=c("_hidden"),b=c("toPrimitive"),L={}.propertyIsEnumerable,F=d("symbol-registry"),q=d("symbols"),j=d("op-symbols"),H=Object.prototype,G="function"==typeof V&&!!U.f,B=s.QObject,K=!B||!B.prototype||!B.prototype.findChild,W=r&&l((function(){return 7!=I(D({},"a",{get:function(){return D(this,"a",{value:7}).a}})).a}))?function(e,t,i){var s=C(H,t);s&&delete H[t],D(e,t,i),s&&e!==H&&D(H,t,s)}:D,z=function(e){var t=q[e]=I(V.prototype);return t._k=e,t},Y=G&&"symbol"==typeof V.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof V},J=function(e,t,i){return e===H&&J(j,t,i),g(e),t=T(t,!0),g(i),a(q,t)?(i.enumerable?(a(e,N)&&e[N][t]&&(e[N][t]=!1),i=I(i,{enumerable:k(0,!1)})):(a(e,N)||D(e,N,k(1,{})),e[N][t]=!0),W(e,t,i)):D(e,t,i)},X=function(e,t){g(e);for(var i,s=y(t=P(t)),a=0,r=s.length;r>a;)J(e,i=s[a++],t[i]);return e},Q=function(e){var t=L.call(this,e=T(e,!0));return!(this===H&&a(q,e)&&!a(j,e))&&(!(t||!a(this,e)||!a(q,e)||a(this,N)&&this[N][e])||t)},Z=function(e,t){if(e=P(e),t=T(t,!0),e!==H||!a(q,t)||a(j,t)){var i=C(e,t);return!i||!a(q,t)||a(e,N)&&e[N][t]||(i.enumerable=!0),i}},$=function(e){for(var t,i=O(P(e)),s=[],r=0;i.length>r;)a(q,t=i[r++])||t==N||t==o||s.push(t);return s},ee=function(e){for(var t,i=e===H,s=O(i?j:P(e)),r=[],n=0;s.length>n;)!a(q,t=s[n++])||i&&!a(H,t)||r.push(q[t]);return r};G||(u((V=function(){if(this instanceof V)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(i){this===H&&t.call(j,i),a(this,N)&&a(this[N],e)&&(this[N][e]=!1),W(this,e,k(1,i))};return r&&K&&W(H,e,{configurable:!0,set:t}),z(e)}).prototype,"toString",(function(){return this._k})),R.f=Z,A.f=J,i(90).f=E.f=$,i(31).f=Q,U.f=ee,r&&!i(29)&&u(H,"propertyIsEnumerable",Q,!0),p.f=function(e){return z(c(e))}),n(n.G+n.W+n.F*!G,{Symbol:V});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ie=0;te.length>ie;)c(te[ie++]);for(var se=M(c.store),ae=0;se.length>ae;)v(se[ae++]);n(n.S+n.F*!G,"Symbol",{for:function(e){return a(F,e+="")?F[e]:F[e]=V(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in F)if(F[t]===e)return t},useSetter:function(){K=!0},useSimple:function(){K=!1}}),n(n.S+n.F*!G,"Object",{create:function(e,t){return void 0===t?I(e):X(I(e),t)},defineProperty:J,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var re=l((function(){U.f(1)}));n(n.S+n.F*re,"Object",{getOwnPropertySymbols:function(e){return U.f(S(e))}}),x&&n(n.S+n.F*(!G||l((function(){var e=V();return"[null]"!=w([e])||"{}"!=w({a:e})||"{}"!=w(Object(e))}))),"JSON",{stringify:function(e){for(var t,i,s=[e],a=1;arguments.length>a;)s.push(arguments[a++]);if(i=t=s[1],(_(t)||void 0!==e)&&!Y(e))return m(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!Y(t))return t}),s[1]=t,w.apply(x,s)}}),V.prototype[b]||i(15)(V.prototype,b,V.prototype.valueOf),h(V,"Symbol"),h(Math,"Math",!0),h(s.JSON,"JSON",!0)},function(e,t,i){var s=i(24),a=i(53),r=i(31);e.exports=function(e){var t=s(e),i=a.f;if(i)for(var n,u=i(e),o=r.f,l=0;u.length>l;)o.call(e,n=u[l++])&&t.push(n);return t}},function(e,t,i){var s=i(21),a=i(90).f,r={}.toString,n="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return n&&"[object Window]"==r.call(e)?function(e){try{return a(e)}catch(e){return n.slice()}}(e):a(s(e))}},function(e,t,i){i(59)("asyncIterator")},function(e,t,i){i(59)("observable")},function(e,t,i){"use strict";t.__esModule=!0;var s=n(i(166)),a=n(i(170)),r=n(i(89));function n(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,r.default)(t)));e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(s.default?(0,s.default)(e,t):e.__proto__=t)}},function(e,t,i){e.exports={default:i(167),__esModule:!0}},function(e,t,i){i(168),e.exports=i(6).Object.setPrototypeOf},function(e,t,i){var s=i(9);s(s.S,"Object",{setPrototypeOf:i(169).set})},function(e,t,i){var s=i(14),a=i(16),r=function(e,t){if(a(e),!s(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,s){try{(s=i(20)(Function.call,i(91).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return r(e,i),t?e.__proto__=i:s(e,i),e}}({},!1):void 0),check:r}},function(e,t,i){e.exports={default:i(171),__esModule:!0}},function(e,t,i){i(172);var s=i(6).Object;e.exports=function(e,t){return s.create(e,t)}},function(e,t,i){var s=i(9);s(s.S,"Object",{create:i(33)})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(0)),a=u(i(1)),r=u(i(92)),n=u(i(7));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){(0,s.default)(this,e),this.streamName="",this.codecType=0,this.cdnBrand=0}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new n.default(!1);return e.pushString(this.streamName),e.pushUInt16(this.codecType),e.pushUInt16(this.cdnBrand),e.marshall()}},{key:"unmarshall",value:function(e){return this.streamName=e.popString(),this.codecType=e.popUInt16(),this.cdnBrand=e.popUInt16(),this}},{key:"getDefCodecRate",value:function(){return this.codecType>=r.default.VIDEO_264_START&&this.codecType<=r.default.VIDEO_H264_END?100*(this.codecType-r.default.VIDEO_264_START):this.codecType>=r.default.VIDEO_265_START&&this.codecType<=r.default.VIDEO_H265_END?100*(this.codecType-r.default.VIDEO_265_START):128}},{key:"text",value:function(){return this.streamName+"_"+this.codecType+"_"+this.cdnBrand}},{key:"equal",value:function(e){return!!e&&(this.streamName==e.streamName&&this.codecType==e.codecType&&this.cdnBrand==e.cdnBrand)}},{key:"isValidID",get:function(){return this.codecType>0}},{key:"isH264",get:function(){return this.codecType>=r.default.VIDEO_264_START&&this.codecType<=r.default.VIDEO_H264_END}},{key:"isH265",get:function(){return this.codecType>=r.default.VIDEO_265_START&&this.codecType<=r.default.VIDEO_H265_END}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=c(i(19)),a=c(i(5)),r=c(i(0)),n=c(i(1)),u=c(i(2)),o=c(i(43)),l=c(i(175)),d=c(i(57)),h=c(i(92)),f=c(i(176));function c(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t,i){(0,r.default)(this,e),this.wStream=t,this.seqs=[],this.index=0,this.lostMap=new a.default,this.lostCompressMap=new a.default,this.waits=[],this.lostFrameNum=0,this.lostCompressFrameNum=0,this.recvFrameNum=0,this.enc_flow=0,this.dec_flow=0,this.dec_ok_cnt=0,this.dec_fail_cnt=0,this.codec_type=0,this.isFirstPkg=!0,this.speed=new u.default.AverageCalculator(10),this.delay=new f.default(t),this.P2PLibProxy=i}return(0,n.default)(e,[{key:"start",value:function(){u.default.Timer.add(this.onCheckFastTimer,this,100)}},{key:"stop",value:function(){this.reset(),u.default.Timer.remove(this.onCheckFastTimer,this)}},{key:"reset",value:function(){this.isFirstPkg=!0,this.lostFrameNum=0,this.lostCompressFrameNum=0,this.recvFrameNum=0,this.seqs=[],this.index=0,this.waits=[],this.lostMap.clear(),this.lostCompressMap.clear(),this.speed.reset()}},{key:"onCheckFastTimer",value:function(e,t){t%10==0&&this.speed.calculate(),this.checkFullFrame(e),this.checkFullCompressFrame(e);var i=this.waits.length;if(i>0){for(var s=Math.min(i,Math.ceil(.1*i)),a=[],r=0;r<s;r++){var n=this.waits[r];a.push(n),this.delay.addMerge2NotifyDelay(n),this.delay.addDelayTotal(n)}this.waits=this.waits.slice(s),o.default.streamPlayer.hyPlayer.trigger(u.default.Event.SIGNAL_DATA,a)}}},{key:"recvSignalSlice",value:function(e){this.isFirstPkg&&(this.isFirstPkg=!1,d.default.signalUserProperty=3,o.default.streamPlayer.hyPlayer.trigger(u.default.Event.SIGNAL_PLAY,this.wStream.info.oStreamName)),-1===this.seqs.indexOf(e.seq)&&(this.seqs[this.index]=e.seq,this.index++,1e4===this.index&&(this.index=0),this.codec_type=e.codecType,e.codecType===h.default.SIGNAL_STREAM_COMPRESS_DATA?this.getCompressWaits(e):e.codecType===h.default.SIGNAL_STREAM_DATA&&this.setStreamWaits(e))}},{key:"getCompressWaits",value:function(e){var t=null;0===e.frameNum?(t=this.inflate(e.streamData),e.streamData=t,this._sliceMoreInOne(e)):1===e.frameNum?(t=this.inflate(e.streamData),e.streamData=t,this._sliceOneInOne(e),this.delay.addRec2MergeDelay(null)):e.frameNum>=2&&this.sliceOneInMoreCompress(e)}},{key:"inflate",value:function(e){var t=null;try{t=this.P2PLibProxy.inflate(e),this.enc_flow+=e.length,this.dec_flow+=t.length,this.dec_ok_cnt++}catch(e){this.dec_fail_cnt++,u.default.logger.warn("inflate compress data err = "+e.message)}return t}},{key:"sliceOneInMoreCompress",value:function(e){var t=this.lostCompressMap.get(e.frameId);if(t||(t=new l.default,this.lostCompressMap.set(e.frameId,t)),t.append(e),t.isFull()){this.lostCompressMap.delete(e.frameId);var i=t.streamData,s=this.inflate(i);e.streamData=s,this._sliceOneInOne(e),this.delay.addRec2MergeDelay(t)}}},{key:"setStreamWaits",value:function(e){0===e.frameNum?this._sliceMoreInOne(e):1===e.frameNum?(this._sliceOneInOne(e),this.delay.addRec2MergeDelay(null)):e.frameNum>=2&&this._sliceOneInMore(e)}},{key:"_sliceMoreInOne",value:function(e){for(var t=new DataView(e.streamData.buffer),i=e.streamData.length,s=0,a=void 0,r=void 0,n=this.delay.calcSer2RecDelay(e);s<i;)a=t.getUint32(s,!0),t.getUint32(s+4,!0),(r=e.streamData.slice(s+8,s+a)).__fullTime=e.streamData.__fullTime,r.__delay=e.streamData.__delay,this.delay.addSer2RecDelay(n),this.delay.addRec2MergeDelay(null),this.addWait(r),s+=a}},{key:"_sliceOneInOne",value:function(e){this.delay.addSer2RecDelayBySlice(e);var t=e.streamData.slice();t.__fullTime=e.streamData.__fullTime,t.__delay=e.streamData.__delay,this.addWait(t)}},{key:"_sliceOneInMore",value:function(e){var t=this.lostMap.get(e.frameId);if(t||(t=new l.default,this.lostMap.set(e.frameId,t)),t.append(e),t.isFull()){this.lostMap.delete(e.frameId);var i=t.packets[0];this.delay.addSer2RecDelayBySlice(i),this.delay.addRec2MergeDelay(t),t.streamData.__fullTime=i.__fullTime,t.streamData.__delay=i.__delay,this.addWait(t.streamData)}}},{key:"checkFullFrame",value:function(e){var t=!0,i=!1,a=void 0;try{for(var r,n=(0,s.default)(this.lostMap.values());!(t=(r=n.next()).done);t=!0){var u=r.value;u.isTimeout(e)&&(this.lostFrameNum++,this.lostMap.delete(u.frameId))}}catch(e){i=!0,a=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw a}}}},{key:"checkFullCompressFrame",value:function(e){var t=!0,i=!1,a=void 0;try{for(var r,n=(0,s.default)(this.lostCompressMap.values());!(t=(r=n.next()).done);t=!0){var u=r.value;u.isTimeout(e)&&(this.lostCompressFrameNum++,this.lostCompressMap.delete(u.frameId))}}catch(e){i=!0,a=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw a}}}},{key:"addWait",value:function(e){this.recvFrameNum++,this.speed.addCur(1),this.waits.push(e)}}]),e}();t.default=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.key=0,this.pktNum=0,this.size=0,this.packets=[],this.firstPktSeq=0,this.lastPktSeq=0,this.streamData=null,this.firstTs=0}return(0,a.default)(e,[{key:"append",value:function(e){if(0==this.packets.length)this.key=e.frameId,this.pktNum=e.frameNum,this.packets.push(e),this.size=e.streamData.length,this.firstTs=r.default.TimeUtil.now();else{if(this.isFull())return!0;for(var t=!0,i=this.packets.length-1;i>=0;i--){if(this.packets[i].seqNum===e.seqNum)return!0;if(this.packets[i].seqNum<e.seqNum){this.packets.splice(i+1,0,e),this.size+=e.streamData.length,t=!1;break}}t&&(this.packets.splice(0,0,e),this.size+=e.streamData.length)}if(this.isFull()){this.streamData=new Uint8Array(this.size);for(var s=0,a=this.packets.length,n=0;n<a;n++){var u=this.packets[n];if(!u.streamData)return r.default.logger.error("ComFrame.append slice streamData null, seq",u.seq,"frameId",u.frameId),!1;this.streamData.set(u.streamData,s),s+=u.streamData.length}}return this.firstPktSeq=this.packets[0].seq,this.lastPktSeq=this.packets[this.packets.length-1].seq,!0}},{key:"getLostSeqs",value:function(){if(this.isFull())return[];var e=[],t=this.packets.length,i=this.packets[0].seq,s=t>1?this.packets[t-1].seq:i,a=s-i,r=this.pktNum-t-a,n=0;for(n=i;n<s;n++)e.push(n);for(n=1;n<=r;n++)e.push(i-n),e.push(s+n);return e}},{key:"isFull",value:function(){return this.pktNum<2||this.pktNum==this.packets.length}},{key:"isTimeout",value:function(e){return e-this.firstTs>2e3}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,s.default)(this,e),this.wStream=t,this.delayTotal=new r.default.AverageCalculator(1e5),this.ser2RecDelay=new r.default.AverageCalculator(1e5),this.rec2MergeDelay=new r.default.AverageCalculator(1e5),this.merge2NotifyDelay=new r.default.AverageCalculator(1e5)}return(0,a.default)(e,[{key:"getStats",value:function(){var e={min_delay:this.delayTotal.min(),max_delay:this.delayTotal.max(),ave_delay:this.delayTotal.average(),ser_2_rec_delay:this.ser2RecDelay.average(),rec_2_merge_delay:this.rec2MergeDelay.average(),merge_2_notify_delay:this.merge2NotifyDelay.average()};return this.delayTotal.reset(),this.ser2RecDelay.reset(),this.rec2MergeDelay.reset(),this.merge2NotifyDelay.reset(),e}},{key:"addSer2RecDelayBySlice",value:function(e){this.addSer2RecDelay(this.calcSer2RecDelay(e))}},{key:"addSer2RecDelay",value:function(e){e>=0&&this.ser2RecDelay.add(e)}},{key:"calcSer2RecDelay",value:function(e){if(!r.default.Ntp.isFinishNtp())return-1;var t=this.getStampc(e);return t<=0?-1:(e.streamData.__delay=Math.max(0,r.default.Ntp.getSyncTime()-t),e.streamData.__fullTime=r.default.TimeUtil.now(),e.streamData.__delay)}},{key:"getStampc",value:function(e){var t=0;return e.config.has(14)&&(t=1e3*Number(e.config.get(14))),e.config.has(15)&&(t+=Number(e.config.get(15))),t}},{key:"addRec2MergeDelay",value:function(e){if(r.default.Ntp.isFinishNtp())if(e){var t=r.default.TimeUtil.now()-e.firstTs;t>0&&this.rec2MergeDelay.add(t)}else this.rec2MergeDelay.add(1)}},{key:"addMerge2NotifyDelay",value:function(e){if(r.default.Ntp.isFinishNtp()&&e.__fullTime){var t=e.__fullTime,i=Math.max(0,r.default.TimeUtil.now()-t);this.merge2NotifyDelay.add(i)}}},{key:"addDelayTotal",value:function(e){if(r.default.Ntp.isFinishNtp()&&e.__fullTime&&e.__delay){var t=e.__fullTime,i=e.__delay;i=Math.max(0,i+(r.default.TimeUtil.now()-t)),this.delayTotal.add(i)}}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){(0,s.default)(this,e)}return(0,a.default)(e,[{key:"onNoVideo",value:function(){}},{key:"onRestart",value:function(e){}},{key:"turnToFlv",value:function(e){}},{key:"onSliceData",value:function(e){}},{key:"onGetToken",value:function(e){}},{key:"autoReport",value:function(){}},{key:"getBufferLen",value:function(){return 0}}]),e}();t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,s.default)(this,e),this.wStream=t,this.heart_type=r.default.StatCfg.HEART_TYPE.START}return(0,a.default)(e,[{key:"reset",value:function(){this.heart_type=r.default.StatCfg.HEART_TYPE.START}},{key:"getMetric",value:function(e){if(this.wStream.isStop||!this.wStream.stream)return null;e&&(this.heart_type=r.default.StatCfg.HEART_TYPE.END);var t={sMetricName:r.default.StatCfg.SIGNAL_HEART20.name,vDimension:{},vExLog:{},vField:{}},i=this.wStream.comParser,s=this.wStream.stream,a=s.stat,n=i.delay.getStats();return t.vDimension[r.default.StatCfg.SIGNAL_HEART20.STREAM_NAME]=this.wStream.info.sStreamName,t.vDimension[r.default.StatCfg.DIM_CORE.HEART_TYPE]=this.heart_type,t.vDimension[r.default.StatCfg.DIM_COM.CODEC_TYPE]=i.codec_type,this.fillCore(t.vDimension,a),this.fillComp(t.vDimension,a,r.default.StatCfg.SUB_RETURN.sub_name),this.fillComp(t.vDimension,a,r.default.StatCfg.SIGNAL_HEART20.STREAM_DELAY),this.fillFlow(t.vField,a),t.vField[r.default.StatCfg.CORE.HAS_PUNCH_NODES]=s.getPunchedCnt(),t.vField[r.default.StatCfg.SIGNAL_HEART20.FULL_FRAME_NUM]=i.recvFrameNum,t.vField[r.default.StatCfg.SIGNAL_HEART20.LOST_FRAME_NUM]=i.lostFrameNum,t.vField[r.default.StatCfg.CORE.ENC_FLOW]=i.enc_flow,t.vField[r.default.StatCfg.CORE.DEC_FLOW]=i.dec_flow,t.vField[r.default.StatCfg.CORE.DEC_OK_CNT]=i.dec_ok_cnt,t.vField[r.default.StatCfg.CORE.DEC_FAIL_CNT]=i.dec_fail_cnt,t.vField[r.default.StatCfg.SIGNAL_HEART20.MIN_DELAY]=n.min_delay,t.vField[r.default.StatCfg.SIGNAL_HEART20.MAX_DELAY]=n.max_delay,t.vField[r.default.StatCfg.SIGNAL_HEART20.AVE_DELAY]=n.ave_delay,t.vField[r.default.StatCfg.SIGNAL_HEART20.SER_2_REC_DELAY]=n.ser_2_rec_delay,t.vField[r.default.StatCfg.SIGNAL_HEART20.REC_2_MERGE_DELAY]=n.rec_2_merge_delay,t.vField[r.default.StatCfg.SIGNAL_HEART20.MERGE_2_NOTIFY_DELAY]=n.merge_2_notify_delay,i.recvFrameNum=0,i.lostFrameNum=0,i.enc_flow=0,i.dec_flow=0,i.dec_ok_cnt=0,i.dec_fail_cnt=0,a.reset(),this.heart_type===r.default.StatCfg.HEART_TYPE.START&&(this.heart_type=r.default.StatCfg.HEART_TYPE.CONTINUS),t}},{key:"fillCore",value:function(e,t){if(t.core)for(var i in t.core)e[i]=t.core[i]}},{key:"fillComp",value:function(e,t,i){if(t.hasOwnProperty(i)){var s="",a=t[i];for(var r in a)s.length>0&&(s+=";"),s+=r+","+a[r];""!==s&&(e[i]=s)}}},{key:"fillFlow",value:function(e,t){if(t.bw)for(var i in t.bw){var s=t.bw[i];s>0&&(e[i]=s)}}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(93)),a=r(i(2));function r(e){return e&&e.__esModule?e:{default:e}}t.default={isMacChrome72:function(){return"mac"===s.default.platform&&"chrome"===s.default.name&&72===Number(s.default.version.major)},isNeedAud:function(){return s.default.chrome&&s.default.version.major>=73},isBrowserSupport:function(){return s.default.firefox||s.default.opera||s.default.chrome&&53!=s.default.version.major||s.default.safari||s.default.edge||s.default.edg},isP2PCooling:function(){return 1===Number(a.default.config.needCooling)&&1===Number(localStorage.getItem("__p2p_cooling_play"))},isSupportP2P:function(){return this.isBrowserSupport()&&!this.isP2PCooling()},isWebrtcSupport:function(){try{var e=navigator.userAgent,t={Trident:e.indexOf("Trident")>0||e.indexOf("NET CLR")>0,Presto:e.indexOf("Presto")>0,WebKit:e.indexOf("AppleWebKit")>0,Gecko:e.indexOf("Gecko/")>0,UC:e.indexOf("UC")>0||e.indexOf(" UBrowser")>0,BaiDu:e.indexOf("Baidu")>0||e.indexOf("BIDUBrowser")>0,Maxthon:e.indexOf("Maxthon")>0,LBBROWSER:e.indexOf("LBBROWSER")>0,SouGou:e.indexOf("MetaSr")>0||e.indexOf("Sogou")>0,IE:e.indexOf("MSIE")>0||e.indexOf("Trident")>0,Firefox:e.indexOf("Firefox")>0,Opera:e.indexOf("Opera")>0||e.indexOf("OPR")>0,Safari:e.indexOf("Safari")>0,Chrome:e.indexOf("Chrome")>0||e.indexOf("CriOS")>0,Wechat:e.indexOf("MicroMessenger")>0,Windows:e.indexOf("Windows")>0,Linux:e.indexOf("Linux")>0,Mac:e.indexOf("Macintosh")>0,Android:e.indexOf("Android")>0||e.indexOf("Adr")>0,WP:e.indexOf("IEMobile")>0,BlackBerry:e.indexOf("BlackBerry")>0||e.indexOf("RIM")>0||e.indexOf("BB")>0,MeeGo:e.indexOf("MeeGo")>0,Symbian:e.indexOf("Symbian")>0,iOS:e.indexOf("like Mac OS X")>0,iPhone:e.indexOf("iPh")>0,iPad:e.indexOf("iPad")>0,Mobile:e.indexOf("Mobi")>0||e.indexOf("iPh")>0||e.indexOf("480")>0,Tablet:e.indexOf("Tablet")>0||e.indexOf("iPad")>0||e.indexOf("Nexus 7")>0};return t.Chrome&&(t.Chrome=!(t.Opera||t.BaiDu||t.Maxthon||t.SouGou||t.UC||t.LBBROWSER)),t.Chrome}catch(e){return!1}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=m(i(94)),a=m(i(19)),r=m(i(5)),n=m(i(0)),u=m(i(1)),o=m(i(11)),l=m(i(3)),d=m(i(190)),h=m(i(191)),f=m(i(2)),c=m(i(192)),p=m(i(67)),v=m(i(72)),y=m(i(71));function m(e){return e&&e.__esModule?e:{default:e}}var g=function(){function e(t){(0,n.default)(this,e),this.hyPlayer=t,this.started=!1,this.startTs=0,this.isPureAudio=!1,this.flvPlayers=new r.default,this.audioInfos={},o.default.proxyLink=new d.default(this,t),o.default.videoLink=new h.default(this),o.default.addListener(l.default.PLoginVideoProxyUniformlyRes,this.onLoginVideoProxyUniformlyRes,this),o.default.addListener(l.default.PNotifyCurrentStream4,this.onPNotifyCurrentStream4,this),o.default.addListener(l.default.PSubscribeStreamRes3,this.onSubscribeStreamRes3,this),o.default.addListener(l.default.PStreamData3,this.onStreamData,this),o.default.addListener(l.default.PStopStream3,this.onStopStream,this),o.default.addListener(l.default.PStopStream,this.onStopStream,this),o.default.addListener(l.default.PNotifyStreamSwitch,this.onPNotifyStreamSwitch,this),o.default.addListener(l.default.PVideoSyncSpeakerTime3,this.onVideoSyncSpeakerTime,this)}return(0,u.default)(e,[{key:"init",value:function(e){o.default.uuid=e.uuid,o.default.uid=e.uid,o.default.sid=e.sid,o.default.subSid=e.subSid}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8e3;o.default.subSid?(this.stop(),f.default.logger.log("HuyaMgr.start codeRate="+e),o.default.codeRate=Number(e),this.started=!0,this.startTs=f.default.TimeUtil.now(),o.default.proxyLink.switchCodeRate(o.default.codeRate),f.default.Timer.add(this.onCheckTimer,this,1e3),f.default.Timer.add(this.onCheckFastTimer,this,100)):f.default.logger.warn("HuyaMgr.start No subSid.")}},{key:"stop",value:function(e){this.started&&(f.default.logger.log("HuyaMgr.stop"),this.started=!1,5!==e&&(o.default.codeRate=0,o.default.audioMgr&&o.default.audioMgr.reset()),o.default.audioMgr&&o.default.audioMgr.reset(),this.closeVideo(),this.audioInfos={},f.default.Timer.remove(this.onCheckTimer,this),f.default.Timer.remove(this.onCheckFastTimer,this))}},{key:"startVoice",value:function(){this.started||(this.started=!0),f.default.Timer.has(this.onCheckTimer,this)||(f.default.Timer.add(this.onCheckTimer,this,1e3),f.default.Timer.add(this.onCheckFastTimer,this,100))}},{key:"closeVideo",value:function(){f.default.logger.log("HuyaMgr.closeVideo"),o.default.videoLink.close();var e=!0,t=!1,i=void 0;try{for(var s,r=(0,a.default)(this.flvPlayers.values());!(e=(s=r.next()).done);e=!0){s.value.dispose()}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}this.flvPlayers.clear()}},{key:"stopPlayer",value:function(e){var t=this.getPlayer(e);if(t){f.default.logger.log("HuyaMgr.stopPlayer uid="+e),t.dispose(),this.flvPlayers.delete(e);for(var i=window._audios||[],s=i.length-1;s>=0;s--){var a=i[s],r=a.uid;(r&&r==e||a.error&&4==a.error.code)&&i.splice(s,1)}}}},{key:"setConfig",value:function(e,t){f.default.logger.log("HuyaMgr.setConfig key="+e+" value="+t),o.default.setConfig(e,t)}},{key:"getConfig",value:function(e){return o.default.getConfig(e)}},{key:"onLoginVideoProxyUniformlyRes",value:function(e){if(f.default.logger.log("HuyaMgr.onLoginVideoProxyUniformlyRes: pkg=",e),!e._isFromVoice){o.default.proxyAreaType=e.proxyAreaType,o.default.clientAreaType=e.clientAreaType,o.default.isFirstViewer=1==e.firstViewer;var t=!0,i=!1,s=void 0;try{for(var r,n=(0,a.default)(this.flvPlayers.values());!(t=(r=n.next()).done);t=!0){r.value.resetVideo()}}catch(e){i=!0,s=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw s}}}}},{key:"onPNotifyCurrentStream4",value:function(e){if(this.started||(this.started=!0),e._isFromVoice)this.onAudioPNotifyCurrentStream4(e);else{e.uid!=o.default.presenterUid&&(o.default.presenterUid=e.uid,f.default.logger.log("presenterUid = "+o.default.presenterUid));var t=null,i=0,s=e.streamGroupId.isVideoStream;if(s){o.default.videoStreamId=e.streamGroupId,i=e.metaDatasMap.get(p.default.SERVER_FASTACCESS_MODE)||0,o.default.videoMetaData=this.mergeMetaData(o.default.videoMetaData,e.metaDatasMap),t=o.default.videoMetaData,o.default.isH265=Boolean(t.get(p.default.SERVER_H265_STREAM));var a=e.metaDatasMap.get(p.default.PUBLISHER_CUR_BIT_RATE)||0;(a/=1e3)&&a!=o.default.curBitrate&&(0==o.default.curBitrate?f.default.logger.log("curBitrate "+a):f.default.logger.log("curBitrate change "+o.default.curBitrate+"->"+a),o.default.curBitrate=a)}else i=e.metaDatasMap.get(p.default.SERVER_FASTACCESS_MODE)||0,o.default.audioStreamId=e.streamGroupId,o.default.audioMetaData=this.mergeMetaData(o.default.audioMetaData,e.metaDatasMap),t=o.default.audioMetaData;var r=s?"Video":"Audio",n=t?t.get("log"):"";if(n&&(f.default.logger.log("PNotifyCurrentStream4 "+r+":"+n),t.delete("log")),i){f.default.logger.info(r+" AccessMode: "+["normal","pull","push"][i]);var u=t.get(p.default.SERVER_FASTACCESS_FIRST_SEQ)||0,l=t.get(p.default.SERVER_FASTACCESS_LAST_SEQ)||0;if(!(1!=i||!u||!l||u<=0||u>=l))this.getOrNewPlayer(e.uid).setPullSeq(u,l,s)}}}},{key:"onAudioPNotifyCurrentStream4",value:function(e){}},{key:"onSubscribeStreamRes3",value:function(e){if(0==e.resCode){var t=this.getOrNewPlayer(e.uid);t&&t.onSubscribeStreamRes(e)}else{var i=v.default[e.resCode];f.default.logger.error("HuyaMgr.onSubscribeStreamRes3",i)}}},{key:"onStreamData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.recvOsTime=f.default.TimeUtil.now(),e.peerUid=t;var i=this.getOrNewPlayer(e.uid);e.isVideo?i.onVideoStreamData(e):i.onAudioStreamData(e)}},{key:"onStopStream",value:function(e){if(this.started){var t=this.getPlayer(e.uid);t&&t.onStopStream(e)}}},{key:"onPNotifyStreamSwitch",value:function(e){f.default.logger.warn("HuyaMgr.onPNotifyStreamSwitch switchReason="+e.switchReason)}},{key:"onVideoSyncSpeakerTime",value:function(e){var t=this.getPlayer(e.uid);t&&t.onVideoSyncSpeakerTime(e)}},{key:"onCheckTimer",value:function(e,t){if(this.started){var i=!0,r=!1,n=void 0;try{for(var u,o=(0,a.default)(this.flvPlayers);!(i=(u=o.next()).done);i=!0){var l=u.value,d=(0,s.default)(l,2),h=d[0];d[1].onCheckTimer(e,t)&&this.flvPlayers.delete(h)}}catch(e){r=!0,n=e}finally{try{!i&&o.return&&o.return()}finally{if(r)throw n}}}}},{key:"onCheckFastTimer",value:function(e,t){if(this.started){var i=!0,s=!1,r=void 0;try{for(var n,u=(0,a.default)(this.flvPlayers.values());!(i=(n=u.next()).done);i=!0){n.value.onCheckFastTimer(e,t)}}catch(e){s=!0,r=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw r}}}}},{key:"setAudioInfo",value:function(e,t){this.audioInfos[e]=t,this.audioInfos[t]=e}},{key:"setPureAudio",value:function(e){this.isPureAudio=e}},{key:"deleteAudioInfo",value:function(e){var t=this.audioInfos[e];t&&delete this.audioInfos[t],delete this.audioInfos[e]}},{key:"subscribeAllStream",value:function(){var e=0,t=!0,i=!1,s=void 0;try{for(var r,n=(0,a.default)(this.flvPlayers.values());!(t=(r=n.next()).done);t=!0){var u=r.value;if(0!==u.streamId.low){var l=new y.default(this.userGroupId,u.streamId,o.default.getUid(),!0,0,0);this.sendVideo(l.marshall()),e++}}}catch(e){i=!0,s=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw s}}f.default.logger.log("HuyaMgr.subscribeAllStream streamCnt="+e)}},{key:"unsubscribeAllStream",value:function(){var e=0,t=!0,i=!1,s=void 0;try{for(var r,n=(0,a.default)(this.flvPlayers.values());!(t=(r=n.next()).done);t=!0){var u=r.value;if(0!==u.streamId){var l=new y.default(this.userGroupId,u.streamId,o.default.getUid(),!1,0,0);o.default.send(l.marshall()),e++}}}catch(e){i=!0,s=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw s}}f.default.logger.log("HuyaMgr.unsubscribeAllStream streamCnt="+e)}},{key:"getPlayer",value:function(e){return this.flvPlayers.has(e)?this.flvPlayers.get(e):null}},{key:"getOrNewPlayer",value:function(e){if(this.flvPlayers.has(e))return this.flvPlayers.get(e);var t=this.isPureAudio||!!this.audioInfos[e];f.default.logger.log("HuyaMgr.getOrNewPlayer uid="+e,t);var i=new c.default(e,this,t);return this.flvPlayers.set(e,i),i}},{key:"getAllPlayer",value:function(){return this.flvPlayers}},{key:"setVolume",value:function(e){var t=!0,i=!1,s=void 0;try{for(var r,n=(0,a.default)(this.flvPlayers.values());!(t=(r=n.next()).done);t=!0){r.value.msePlayer.setVolume(e)}}catch(e){i=!0,s=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw s}}}},{key:"setMuted",value:function(e){var t=!0,i=!1,s=void 0;try{for(var r,n=(0,a.default)(this.flvPlayers.values());!(t=(r=n.next()).done);t=!0){r.value.msePlayer.setMuted(e)}}catch(e){i=!0,s=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw s}}}},{key:"getMuted",value:function(){var e=!0,t=!1,i=void 0;try{for(var s,r=(0,a.default)(this.flvPlayers.values());!(e=(s=r.next()).done);e=!0){return s.value.msePlayer.getMuted()}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}return-1}},{key:"onPlayVideo",value:function(e,t,i,s,a){var r=f.default.TimeUtil.now();o.default.onPlayTime=r,f.default.logger.log("%c[TIME] onPlayTime="+(r-o.default.firstRenderTime)+" totalTime="+(r-o.default.startTime),"color:#A23400;background:#FFF5C2"),t.autoplay=!0,t.volume=this.hyPlayer.getVolume(),this.hyPlayer.trigger(f.default.Event.VIDEO_PLAY,{uid:e,video:t,width:i,height:s,hasVideo:a}),0!==this.startTs?(this.hyPlayer.tsdbUtil.sendCdnTime(o.default,!1),f.default.logger.log("%cHuyaMgr.onPlayVideo uid="+e+" w/h="+i+"/"+s+" loadTime="+(o.default.onPlayTime-this.startTs),"color:#A23400;background:#FFF5C2"),this.startTs=0,o.default.printUseTime()):f.default.logger.log("HuyaMgr.onPlayVideo uid="+e+" w/h="+i+"/"+s)}},{key:"onPlayAudio",value:function(e,t){var i=f.default.TimeUtil.now();if(f.default.logger.log("%c[TIME] onPlayAudio uid="+e+" totalTime="+(i-o.default.startTime),"color:#A23400;background:#FFF5C2"),t.volume=this.hyPlayer.getVolume(),t.autoplay=!0,t.uid=e,o.default.isLiveMeeting){var s={uid:e,video:t,width:0,height:0,hasVideo:!1};this.hyPlayer.trigger(f.default.Event.AUDIO_PLAY,s),this.hyPlayer.voiceMgr.liveMeetingMgr.detectSound(t)}var a=window._audios||[];a.push(t),window._audios=a}},{key:"callback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.hyPlayer.trigger(e,t)}},{key:"mergeMetaData",value:function(e,t){var i=new r.default;if(e&&e.forEach((function(e,t){i.set(t,e)})),t){var s="";t.forEach((function(t,a){if(e&&7!=a&&255!=a){var r=e.get(a);null==r&&(r="[]"),r!=t&&(s+="\n+---- "+a+": "+r+"->"+t)}i.set(a,t)})),s.length>0&&i.set("log",s)}return i}}]),e}();window.HuyaMgr=g,t.default=g},function(e,t,i){e.exports={default:i(182),__esModule:!0}},function(e,t,i){i(32),i(35),e.exports=i(183)},function(e,t,i){var s=i(55),a=i(8)("iterator"),r=i(23);e.exports=i(6).isIterable=function(e){var t=Object(e);return void 0!==t[a]||"@@iterator"in t||r.hasOwnProperty(s(t))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(5)),a=o(i(0)),r=o(i(1)),n=o(i(37)),u=o(i(185));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,a.default)(this,e),this.configs=new s.default,this.initDefaultConfig()}return(0,r.default)(e,[{key:"initDefaultConfig",value:function(){var e=this.configs;e.set(n.default.VIDEO_ACCESS_MODE,u.default.VIDEO_ACCESS_PULL),e.set(n.default.VIDEO_JIT_BUFLEN,2e3),e.set(n.default.VIDEO_JIT_MAX_BUFLEN,4e3),e.set(n.default.VIDEO_P2P_MODE,u.default.VIDEO_P2P_ENABLE),e.set(n.default.AUDIO_ACCESS_MODE,u.default.AUDIO_ACCESS_PUSH),e.set(n.default.AUDIO_JIT_BUFLEN,1e3),e.set(n.default.AUDIO_PUSH_LEN,4e3),e.set(n.default.JIT_DOWN_MODE,u.default.JIT_DOWN_ENABLE),e.set(n.default.JIT_UP_MODE,u.default.JIT_UP_ENABLE),e.set(n.default.JIT_ADJUST_MODE,u.default.JIT_ADJUST_LOW_DELAY_MODE),e.set(n.default.PUSH_GOP,!1),e.set(n.default.P2P_MAX_SUB_NUM,15)}},{key:"setConfig",value:function(e,t){this.configs.set(e,t)}},{key:"getConfig",value:function(e){return this.configs.get(e)}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={VIDEO_ACCESS_NORMAL:0,VIDEO_ACCESS_PULL:2,AUDIO_ACCESS_NORMAL:0,AUDIO_ACCESS_PUSH:1,VIDEO_P2P_DISABLE:!1,VIDEO_P2P_ENABLE:!0,JIT_DOWN_DISABLE:!1,JIT_DOWN_ENABLE:!0,JIT_UP_DISABLE:!1,JIT_UP_ENABLE:!0,JIT_ADJUST_NORMAL_MODE:0,JIT_ADJUST_LOW_DELAY_MODE:1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(0)),a=o(i(1)),r=o(i(187)),n=o(i(188)),u=o(i(2));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,s.default)(this,e),this.burstChangeChecker=new r.default,this.averageCalculator=new n.default(60),this.smoothRtt=0,this.smoothRttVar=0,this.devRttVar=60,this.downlinkRTO=150}return(0,a.default)(e,[{key:"OnRecvRtt",value:function(e){this.averageCalculator.add(e),this.calculateSmoothRtt(e),this.calculateRttVariance(),this.calculateDownlinkRTO()}},{key:"GetSmoothRtt",value:function(){return this.smoothRtt}},{key:"GetDownlinkRTO",value:function(){return Math.round(this.downlinkRTO)}},{key:"CheckInvalidDownlinkRtt",value:function(e,t){var i=this.averageCalculator.max();if(0===i||!this.isTooBiggerUint32(i,e))return this.OnRecvRtt(e),!0;if(this.burstChangeChecker.AddInvalid(e,t),!this.burstChangeChecker.CheckInvalid()){var s=this.burstChangeChecker.GetInvalidSize();return u.default.logger.warn("DownlinkRTOCalculator.CheckInvalidDownlinkRtt invalid down link rtt max="+i+" rtt="+e+" invalidSize="+s),!1}var a=this.burstChangeChecker.GetInvalidValues();if(null!=a)for(var r=0;r<a.length;r++)this.OnRecvRtt(a[r]);return this.burstChangeChecker.Reset(),!0}},{key:"calculateSmoothRtt",value:function(e){if(0===this.smoothRtt)this.smoothRtt=e,this.smoothRttVar=e>>1;else{var t=e>this.smoothRtt?e-this.smoothRtt:this.smoothRtt-e;this.smoothRtt=this.getSmoothValue(this.smoothRtt,e),this.smoothRttVar=this.getSmoothValue(this.smoothRttVar,t)}}},{key:"calculateRttVariance",value:function(){this.devRttVar=1*this.smoothRttVar,this.devRttVar<this.smoothRttVar+60?this.devRttVar=this.smoothRttVar+60:this.devRttVar>this.smoothRttVar+600&&(this.devRttVar=this.smoothRttVar+600)}},{key:"calculateDownlinkRTO",value:function(){0===this.smoothRtt?this.downlinkRTO=150:this.downlinkRTO=this.smoothRtt+this.devRttVar}},{key:"isTooBiggerUint32",value:function(e,t){return 0!==e&&(e>50&&5*e<t||e+500<t)}},{key:"getSmoothValue",value:function(e,t){return t>e?3*e+t>>2:7*e+t>>3}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){(0,s.default)(this,e),this.stampc=0,this.invalidRtts=[]}return(0,a.default)(e,[{key:"Reset",value:function(){this.stampc=0,this.invalidRtts=[]}},{key:"AddInvalid",value:function(e,t){0===t&&(t=1),0===this.stampc&&(this.stampc=t),t-this.stampc>5e3?this.Reset():(this.invalidRtts.push(e),this.invalidRtts.length>100&&this.invalidRtts.pop())}},{key:"CheckInvalid",value:function(){return 0!==this.stampc&&this.invalidRtts.length>10}},{key:"GetInvalidValues",value:function(){var e=this.invalidRtts;return this.invalidRtts=[],e}},{key:"GetInvalidSize",value:function(){return this.invalidRtts.length}}]),e}();t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(19)),a=u(i(0)),r=u(i(1)),n=u(i(2));function u(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;(0,a.default)(this,e),this.maxSize=t,this.sum=0,this.list=[],this.idx=0,this.cur=0}return(0,r.default)(e,[{key:"reset",value:function(){this.sum=0,this.list=[],this.idx=0,this.cur=0}},{key:"addCur",value:function(e){this.cur+=e}},{key:"calculate",value:function(){this.add(this.cur);var e=this.cur;return this.cur=0,e}},{key:"add",value:function(e){this.sum+=e,this.list.length<this.maxSize?this.list.push(e):(this.sum-=this.list[this.idx],this.list[this.idx]=e),this.idx++,this.idx>=this.maxSize&&(this.idx=0)}},{key:"average",value:function(){return 0===this.list.length?n.default.Utils.UintMax:Math.round(this.sum/this.list.length)}},{key:"getSamples",value:function(){return this.list}},{key:"max",value:function(){if(0===this.list.length)return n.default.Utils.UintMax;var e=0,t=!0,i=!1,a=void 0;try{for(var r,u=(0,s.default)(this.list);!(t=(r=u.next()).done);t=!0){var o=r.value;o>e&&(e=o)}}catch(e){i=!0,a=e}finally{try{!t&&u.return&&u.return()}finally{if(i)throw a}}return e}},{key:"min",value:function(){var e=n.default.Utils.UintMax,t=!0,i=!1,a=void 0;try{for(var r,u=(0,s.default)(this.list);!(t=(r=u.next()).done);t=!0){var o=r.value;o<e&&(e=o)}}catch(e){i=!0,a=e}finally{try{!t&&u.return&&u.return()}finally{if(i)throw a}}return e}}]),e}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.osTime=0,this.syncLocalTime=0,this.rttList=[]}return(0,a.default)(e,[{key:"convertToSrvTime",value:function(e){if(0===this.osTime)return 0;var t=e-this.osTime;return this.syncLocalTime+t}},{key:"isFinishNtp",value:function(){return 0!==this.osTime}},{key:"ntpProcess",value:function(e,t){var i=r.default.TimeUtil.now(),s=i-e,a=Math.round(t+s/2);if(0===this.osTime&&0===this.syncLocalTime)this.osTime=i,this.syncLocalTime=a,this.rttList.push(s);else if(this.rttList.length<10)this.osTime=i,this.syncLocalTime=a,this.rttList.push(s);else{for(var n=[],u=0;u<this.rttList.length;++u)n.push(this.rttList[u]);n.sort((function(e,t){return e-t}));for(var o=0,l=0;l<4;++l)o+=n[l];var d=o>>2;(4*s>3*d&&4*s<5*d||s>6e4)&&(this.osTime=i,this.syncLocalTime=a),this.rttList.shift(),this.rttList.push(s),n=null}}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l(i(0)),a=l(i(1)),r=l(i(11)),n=l(i(25)),u=l(i(38)),o=l(i(2));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,i){(0,s.default)(this,e),this.huyaMgr=t,this.hyPlayer=i,this._delayGetProxy=!1,this._retryTimer=0,this._codeRate=420,o.default.TafLink.connected?this._onConnected():o.default.TafLink.inited?o.default.TafLink.addListener(o.default.TafLink.WEBSOCKET_CONNECTED,this._onConnected.bind(this)):r.default.addListener(o.default.TafLink.TAFLINK_INITED,this._onConnected.bind(this))}return(0,a.default)(e,[{key:"getUserId",value:function(){return o.default.TafLink.getUserId()}},{key:"trigger",value:function(e,t){r.default._onYYData(e,t)}},{key:"_onConnected",value:function(){this._delayGetProxy&&(this._delayGetProxy=!1,this.getProxy())}},{key:"sendWup",value:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];o.default.TafLink.sendWup(e,t,i,s,a,r,n)}},{key:"sendYY",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=i||r.default.getUid();o.default.TafLink.sendYY(e,t,a,s,!1)}},{key:"switchCodeRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8e3;(e=Number(e))>0&&e%100==0&&(e=e<=8e3?e/100+400|0:e/100+1e3|0),this._codeRate=e,this.getProxy()}},{key:"getProxy",value:function(){if(o.default.TafLink.connected){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=0);var e=new n.default;e.sid=Number(r.default.subSid),e.fuzzyParam.h264Only=!0,e.fuzzyParam.maxCodeRateH264=this._codeRate,e.fuzzyParam.maxCodeRateH265=580;var t=new u.default;t.uid=r.default.getUid(),t.version=1,t.sdkVersion=1,t.fuzzyQueryKeys=[e],t.appid=o.default.UserInfo.appid,t.clientAppid=0,t.clientType=4,t.sendTime=.001*Date.now()>>0,r.default.initUseTime(o.default.TimeUtil.now()),this.sendYY(t,this._rspProxy.bind(this))}else this._delayGetProxy=!0}},{key:"_rspProxy",value:function(e){if(r.default.getVPTime=o.default.TimeUtil.now(),o.default.logger.log("%c[TIME] getVPTime="+(r.default.getVPTime-r.default.startTime),"color:#A23400;background:#FFF5C2"),0==e.result)r.default.videoLink.connect(e);else{var t="UNKNOWN ERROR!";if(1==e.result?t="EGetVP_NO_RESOURCE":2==e.result&&(t="EGetVP_FUZZY_NO_MATCH"),o.default.logger.warn("ProxyLink",t),1==e.retryType)this.hyPlayer.trigger(o.default.Event.NO_VIDEO);else{var i=this;this._retryTimer=setTimeout((function(){o.default.logger.log("ProxyLink retry getProxy"),i.getProxy()}),1e3*e.retryFreq)}}}},{key:"connected",get:function(){return o.default.TafLink.connected}}]),e}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=p(i(5)),a=p(i(0)),r=p(i(1)),n=p(i(11)),u=p(i(3)),o=p(i(62)),l=p(i(37)),d=p(i(26)),h=p(i(40)),f=p(i(41)),c=p(i(2));function p(e){return e&&e.__esModule?e:{default:e}}var v=function(){function e(t){(0,a.default)(this,e),this.huyaMgr=t,this.vps=null,this.link=new c.default.ProtoLink(this,!0,1e3),this.printProtocol=!!Number(localStorage._printProtocol),this.started=!1,this.proxys=null,this.streamIds=[],this.tokens=new s.default,this.connectedTime=0,this.forceConnectTime=0,this.lastGetProxyTime=0,this.pingCnt=0,this.wsUrl="",this.sslUrl="",this.rttCalc=new c.default.AverageCalculator(12),this.rttMax=0,this.selfIp="",this.selfPort=0}return(0,r.default)(e,[{key:"destroy",value:function(){this.close(),this.link.destroy(),this.link=null}},{key:"close",value:function(){this.started&&(c.default.logger.info("VideoLink.close"),this.started=!1,this.forceConnectTime=0,this.reset(),c.default.Timer.remove(this.onCheckTimer,this))}},{key:"reset",value:function(){c.default.logger.log("VideoLink.reset"),this.vps=null,this.link.destroy(),this.link=new c.default.ProtoLink(this,!0,1e3),this.lastGetProxyTime=0,this.pingCnt=0,this.proxys=null,this.streamIds=[],this.tokens.clear(),this.connectedTime=0,this.rttMax=0,this.rttCalc.reset()}},{key:"connect",value:function(e){this.vps=e,this.sslUrl=e.sslUrl||"",n.default.userArea=e.userArea;var t=[];if(e.allocatedStreams.forEach((function(e,i){t=t.concat(e)})),0!==t.length){this.lastGetProxyTime=c.default.TimeUtil.now()-3e3,this.forceConnectTime=0,this.link.destroy(),this.link=new c.default.ProtoLink(this,!0,1e3);var i=this.tokens;i.clear();var s=[],a=null;if(t.forEach((function(e){var t=e.streamId,r=t.streamType,n=t.codecType;r+=r<10?"\t\t":"\t",n+=n<10?"\t\t":"\t",c.default.logger.info("sg --- streamType="+r+"codecType="+n+"startTs="+t.startTs),s.push(t),i.set(t,e.token),!a&&e&&(a=e.videoProxyInfos.slice())})),!a||0!=a.length)return this.streamIds=s,this.proxys=a,this.started=!0,this.pingCnt=0,this.reconnect(),c.default.Timer.add(this.onCheckTimer,this,1e3),this.wsUrl.replace(/ws+?:\/\//g,"");c.default.logger.warn("VideoLink.connect NO STREAM!")}else c.default.logger.warn("VideoLink.connect proxys is empty")}},{key:"reconnect",value:function(){if(this.started)if(this.proxys&&0!=this.proxys.length){var e=this.proxys.shift();this.isWss(e)?this.connectWss(e):this.connectWs(e)}else this.getProxy()}},{key:"isWss",value:function(e){return!(!this.sslUrl||!e.videoProxyInfo.has(8))&&e.videoProxyInfo.get(8)>0}},{key:"connectWs",value:function(e){var t=Math.floor(Math.random()*e.tcpPorts.length),i=t;if(465===e.tcpPorts[t]&&(++t>=e.tcpPorts.length&&(t=0),t===i))return c.default.logger.warn("VideoLink.connect has no correct ports"),void this.reconnect();this.wsUrl="ws://"+e.ip+":"+e.tcpPorts[t],c.default.logger.info("%cconnecting video "+this.wsUrl,y("#0000E3")),localStorage._setWssUrl?this.link.connect(localStorage._setWssUrl):this.link.connect(this.wsUrl)}},{key:"connectWss",value:function(e){var t=e.videoProxyInfo.get(8),i=[t>>16,65535&t],s=i[Math.floor(Math.random()*i.length)];this.wsUrl="wss://"+c.default.Utils.ip2uint(e.ip)+this.sslUrl+":"+s,c.default.logger.info("%cconnecting video "+this.wsUrl,y("#0000E3")),localStorage._setWssUrl?this.link.connect(localStorage._setWssUrl):this.link.connect(this.wsUrl)}},{key:"send",value:function(e){if(!e||!this.connected)return!1;var t=e.constructor.name;return this.printProtocol&&!m[t]&&c.default.logger.debug("%c>>>>> "+t,y("#009100"),e),"Uint8Array"!=t&&(e=e.marshall()),this.link.send(e),!0}},{key:"getProxy",value:function(){var e=c.default.TimeUtil.now();e-this.lastGetProxyTime<5e3||(c.default.logger.log("VideoLink.getProxy lastGetProxyTime="+this.lastGetProxyTime+" now="+e),this.reset(),this.lastGetProxyTime=e,n.default.proxyLink.getProxy())}},{key:"onopen",value:function(){c.default.logger.log("VideoLink.onopen");var e=c.default.TimeUtil.now();this.connectedTime=e,n.default.connectVideoTime=e,c.default.logger.log("%c[TIME] connectVideoTime="+(n.default.connectVideoTime-n.default.getVPTime)+" totalTime="+(e-n.default.startTime),"color:#A23400;background:#FFF5C2"),n.default.addListener(u.default.PLoginVideoProxyUniformlyRes,this.onLoginVideoProxy,this),n.default.addListener(u.default.PVideoProxyPingRes4,this.onVideoProxyPingRes,this),n.default.addListener(u.default.PForceConnectVideoProxy3,this.onForceReconnect,this),this.login()}},{key:"onclose",value:function(){c.default.logger.log("%cVideoLink.onclose","color:white;background:black;"),this.connectedTime=0,this.reconnect()}},{key:"onerror",value:function(e){c.default.logger.warn("VideoLink.onerror",e),this.reconnect()}},{key:"onData",value:function(e,t){var s=new o.default(t),a=u.default[e];if(!a)throw new Error("[x] Unmatched uri, uri="+(s.uri>>8)+" resCode="+s.resCode+" len="+s.len);var r=s,l=null;try{l=i(95)("./"+a).default}catch(t){c.default.logger.warn("%c[x] Unmatched protocol "+(e>>8)+" "+a,"color:red;background:#FFF0F0")}l&&(null==(r=new l).unmarshall?c.default.logger.error("[x]"+a+".unmarshall undefined!"):r.unmarshall(s)),this.printProtocol&&!m[a]&&c.default.logger.debug("%c<<<<< "+a,y("#0000E3"),r),n.default._onYYData(e,r)}},{key:"onCheckTimer",value:function(e,t){if(this.started&&(this.onPingTimer(e,t),this.onCheckConnect(e,t),this.onForceConnectTimer(e,t),t%10==0)){var i=this.link.speed;i!=c.default.Utils.UintMax&&(i=c.default.Utils.formatByteSize(i),c.default.logger.log("huya VideoLink speed "+i+"/s"))}}},{key:"onPingTimer",value:function(e,t){if(this.link.connected&&t%3==0){if(this.pingCnt>=4)return c.default.logger.warn("VideoLink.onPingTimer ping time out"),void this.reconnect();this.pingCnt++;var i=new f.default;i.uid=n.default.getUid(),i.stampc=e,i.loginStamp=0,i.uplinkBw=0,i.availPeers=0,i.bPunched=!1,i.tcpEstableIds=0,i.tcpId=0,i.vipUser=0,i.vipProxy=0,this.send(i)}}},{key:"onCheckConnect",value:function(e){this.connected||this.forceConnectTime>0||this.reconnect()}},{key:"onForceConnectTimer",value:function(e,t){if(!(this.forceConnectTime>e||0===this.forceConnectTime)){if(null===this.proxys)this.getProxy();else{var i=this.proxys;this.reset(),this.lastGetProxyTime=e,this.proxys=i,this.reconnect(),c.default.logger.info("VideoLink.onForceConnectTimer addr="+this.wsUrl)}this.forceConnectTime=0}}},{key:"login",value:function(){var e=new h.default;e.version=1,e.uid=n.default.getUid(),e.streamGroupIds=this.streamIds,e.clientAppid=301,e.clientType=1,e.loginStamp=c.default.TimeUtil.now(),e.videoGroupId=this.vps.videoGroupId,e.tcpId=0,e.commandType=1,e.fastAccessInterval=n.default.getConfig(l.default.VIDEO_JIT_BUFLEN),e.fastAccessInterval>0&&e.fastAccessInterval<2e3&&(e.fastAccessInterval=2e3),e.cookie="",e.localIps=[],e.localPort=0,e.sdkVersion=1,e.token="",e.tokenVersion=this.vps.tokenVersion,e.tokens=this.tokens,e.audioCodecType=[d.default.AUDIO_AACPLUS],e.serviceType=0,e.loginSeq=0,this.send(e)}},{key:"onLoginVideoProxy",value:function(e){n.default.loginTime=c.default.TimeUtil.now(),c.default.logger.log("%c[TIME] loginTime="+(n.default.loginTime-n.default.connectVideoTime)+" totalTime="+(n.default.loginTime-n.default.startTime),"color:#A23400;background:#FFF5C2"),this.selfIp=c.default.Utils.inet_ntoa(e.wlanIp),this.selfPort=e.wlanPort,e.reject>0&&c.default.logger.warn("VideoLink.onLoginVideoProxy reject="+e.reject)}},{key:"onVideoProxyPingRes",value:function(e){this.pingCnt=0,n.default.videoNtp.ntpProcess(e.stampc,e.stamps);var t=c.default.TimeUtil.now(),i=t-e.stampc;i<6e5&&this.onRtt(i),n.default.downlinkRTOCalculator.CheckInvalidDownlinkRtt(i,t)}},{key:"onForceReconnect",value:function(e){var t=c.default.TimeUtil.now();this.proxys=e.videoProxyIpInfo,this.forceConnectTime=Math.round(e.reconnectTime*Math.random()*1e3),this.forceConnectTime<1e3?this.forceConnectTime=t:this.forceConnectTime+=t,c.default.logger.info("VideoLink.onForceReconnect time="+e.reconnectTime+"-"+this.forceConnectTime+"-"+t+" status="+e.reconnectStatus+" new proxy cnt="+e.videoProxyInfo.length),this.onForceConnectTimer(t,0)}},{key:"getVideoConnectedDuration",value:function(){return this.link.connected?c.default.TimeUtil.now()-this.connectedTime:0}},{key:"avgRtt",value:function(){var e=this.rttCalc.average();return e===c.default.Utils.UintMax?0:e}},{key:"getMaxRtt",value:function(){var e=this.rttMax;return this.rttMax=0,e}},{key:"onRtt",value:function(e){this.rttCalc.add(e),e>this.rttMax&&(this.rttMax=e)}},{key:"connected",get:function(){return this.link&&this.link.connected}}]),e}();function y(e){return"color:"+e+";font-weight:900"}t.default=v;var m={PStreamData3:1,PPullStreamData:1,PVideoProxyPing3:1,PVideoProxyPingRes4:1,PNotifyCurrentStream4:1,PReSendStreamData4:1,PP2pVideoPing3:1,PNotifyUplinkRecvCount3:1,PVideoSyncSpeakerTime3:1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=T(i(0)),a=T(i(1)),r=T(i(11)),n=T(i(2)),u=T(i(93)),o=T(i(193)),l=T(i(37)),d=T(i(73)),h=T(i(39)),f=T(i(3)),c=T(i(62)),p=T(i(194)),v=T(i(112)),y=T(i(195)),m=T(i(196)),g=T(i(197)),_=T(i(201)),S=T(i(202)),P=T(i(203));function T(e){return e&&e.__esModule?e:{default:e}}var k=function(){function e(t,i,a){(0,s.default)(this,e),this.uid=t,this.huyaMgr=i,this.isPureAudio=a,this.flvHeader=m.default.getFlvHeader(),this.msePlayer=new n.default.MSEPlayer(this,{videoType:"flv",isPureAudio:a}),this.msePlayer.appendFlv(this.flvHeader),this.msePlayer.setPushGop(r.default.getConfig(l.default.PUSH_GOP)),this.isPureAudio&&this.msePlayer.setJitter(200,100,400),this.metadataTick=new n.default.MetadataTick(i.hyPlayer,this.msePlayer),this.FIRST_TS_INIT=-1,this.FIRST_TS_AUDIO=0,this.FIRST_TS_AUDIO_PUSH=1,this.FIRST_TS_VIDEO=2,this.FIRST_TS_VIDEO_PUSH=3,this.firstTsStatus=this.FIRST_TS_INIT,this.firstTs=0,this.firstOsTs=0,this.lastPlayTs=0,this.lastPlayVideoSeq=0,this.lastPlayVideoKey=0,this.lastPlayAudioKey=0,this.lastAvcStr=null,this.lastAacStr=null,this.lastATs=0,this.VIDEO_STOP_TIME=1e4,this.AUDIO_STOP_TIME=1e4,this.lastRecvVideoTs=0,this.lastRecvAudioTs=0,this.videoChain=new o.default,this.audioChain=new o.default,this.videoPlayStat=new P.default(this),this.audioSsrc=n.default.Utils.UintMax,this.videoStatus=n.default.Status.VIDEO_STOP,this.videoResender=new g.default(this),this.videoQuickAccess=new p.default(t,!0),this.audioQuickAccess=new p.default(t,!1),this.JitterBufLen=0,this.pauseStartTs=0,this.osTime=0,this.localTime=0,r.default.addListener(f.default.PResendStreamDataFailAck,this.onResenderFailedAck,this)}return(0,a.default)(e,[{key:"dispose",value:function(){n.default.logger.info("FlvPlayer.dispose uid="+this.uid),this.resetAudio(),this.msePlayer.destroy(),this.msePlayer=null,this.resetVideo()}},{key:"resetVideo",value:function(){this.lastRecvVideoTs&&n.default.logger.info("FlvPlayer.resetVideo uid="+this.uid),this.lastRecvVideoTs=0,this.lastAvcStr=null,this.updateStatus(n.default.Status.VIDEO_STOP),this.videoChain.reset(),this.videoQuickAccess.reset(),this.audioQuickAccess.reset(),this.videoResender.reset(),this.videoPlayStat.reset(!0),this.firstTsStatus=this.FIRST_TS_INIT,this.firstTs=0,this.firstOsTs=0,this.lastPlayTs=0,this.lastPlayVideoKey=0,this.lastPlayVideoSeq=0,this.metadataTick.reset(),this.resetAudio(),this.msePlayer&&this.resetMsePlayer()}},{key:"resetAudio",value:function(){this.lastRecvAudioTs>0&&n.default.logger.info("FlvPlayer.resetAudio uid="+this.uid),this.lastRecvAudioTs=0,this.updateStatus(n.default.Status.AUDIO_STOP),this.firstTsStatus!==this.FIRST_TS_AUDIO&&this.firstTsStatus!==this.FIRST_TS_AUDIO_PUSH&&this.firstTsStatus!==this.FIRST_TS_INIT||(this.lastPlayAudioKey=0,this.audioChain.reset(),this.audioSsrc=n.default.Utils.UintMax,this.firstTs=0,this.firstOsTs=0,this.firstTsStatus=this.FIRST_TS_INIT,this.lastPlayTs=0)}},{key:"resetMsePlayer",value:function(){n.default.logger.log("FlvPlayer.resetMsePlayer uid="+this.uid);var e=void 0,t=void 0;null!==this.msePlayer&&(e=this.msePlayer.getWidth(),t=this.msePlayer.getHeight(),this.msePlayer.destroy()),this.msePlayer=new n.default.MSEPlayer(this,{videoType:"flv",isPureAudio:this.isPureAudio}),this.msePlayer.appendFlv(this.flvHeader),this.isPureAudio&&this.msePlayer.setJitter(200,100,400),e&&t&&this.msePlayer.setResolution(e,t),this.msePlayer.setPushGop(r.default.getConfig(l.default.PUSH_GOP)),this.lastAacStr=null,this.lastAvcStr=null,this.pauseStartTs=0,this.metadataTick&&(this.metadataTick.mse=this.msePlayer)}},{key:"onCheckTimer",value:function(e,t){return this.lastRecvAudioTs&&e-this.lastRecvAudioTs>this.AUDIO_STOP_TIME&&(n.default.logger.info("FlvPlayer.onCheckTimer stop audio uid="+this.uid),this.resetAudio()),this.lastRecvVideoTs&&e-this.lastRecvVideoTs>this.VIDEO_STOP_TIME&&(n.default.logger.info("FlvPlayer.onCheckTimer stop video uid="+this.uid),this.resetVideo()),0===this.lastRecvAudioTs&&0===this.lastRecvVideoTs?(this.dispose(),n.default.logger.info("FlvPlayer.onCheckTimer remove uid="+this.uid),!0):(this.msePlayer&&this.msePlayer.onCheckTimer(e,t),this.metadataTick.onCheckTimer(e,t),!1)}},{key:"onCheckFastTimer",value:function(e,t){this.videoQuickAccess.checkPull(e),this.audioQuickAccess.checkPull(e),this.msePlayer&&this.msePlayer.onCheckFastTimer(e,t),this.play(e,t),this.videoResender.onCheckFastTimer(e,t)}},{key:"checkVideoPushPlay",value:function(e){if(!this.lastPlayTs){this.audioChain.size>0&&this.audioChain.size<40&&this.firstOsTs;for(var t=this.videoChain.head,i=0;null!==t;){var s=t.data;if(s.isFull)if(0===i)s.dts===this.firstTs&&(i=s.dts);else if(s.dts-i>=500){var a=500+this.JitterBufLen-(e-this.firstOsTs);return this.firstOsTs-=a,void n.default.logger.log("FlvPlayer.checkVideoPushPlay start="+i+" end="+s.dts+" firstOsTs="+this.firstOsTs+" elapseTime="+(e-this.firstOsTs)+" modifyTime="+a)}(t=t.next)===this.videoChain.head&&(t=null)}}}},{key:"checkAudioPushPlay",value:function(e){if(!this.lastPlayTs)for(var t=this.audioChain.head,i=0;null!==t;){var s=t.data;if(0===i)i=s.dts;else if(s.dts-i>=500){var a=500+this.JitterBufLen-(e-this.firstOsTs);return this.firstOsTs-=a,void n.default.logger.log("FlvPlayer.checkAudioPushPlay start="+i+" end="+s.dts+" firstOsTs="+this.firstOsTs)}(t=t.next)===this.audioChain.head&&(t=null)}}},{key:"play",value:function(e,t){if(this.firstTsStatus!==this.FIRST_TS_INIT){this.firstTsStatus>=this.FIRST_TS_VIDEO?this.checkVideoPushPlay(e):this.firstTsStatus>=this.FIRST_TS_AUDIO&&this.checkAudioPushPlay(e);var i=e-this.firstOsTs;if(!(i<this.JitterBufLen)){for(var s=this.firstTs+i-this.JitterBufLen,a=n.default.Utils.UintMax,r=null,u=this.videoChain.head;null!==u;){if((r=u.data).isFull&&r.dts>=this.firstTs){a=r.dts;break}(u=u.next)===this.videoChain.head&&(u=null)}for(var o=this.lastPlayAudioKey+1,l=this.getNextATs(),d=this.lastPlayVideoKey,h=this.getPlayTime(),f=h>0&&l-h>400,c=this.firstTsStatus<this.FIRST_TS_VIDEO;a<=s||l<=s;)if(l<=a){var p=this.audioChain.peek();if(null!==p)if(c)this.lastATs=l=p.dts;else{var m=this.audioSsrc===p.ssrc,g=p.key-o,_=p.dts-l;if(_<=-1*y.default.MUSIC_MID_TIME_LEN){this.audioChain.get();continue}_>(m&&0===g?10:.5)*y.default.MUSIC_MID_TIME_LEN&&(p=this.getEmptyAudioFrame(l,o))}else{if(f||c){s=l-y.default.MUSIC_MID_TIME_LEN;break}p=this.getEmptyAudioFrame(l,o)}this.playAudio(p,e,l),o=this.lastPlayAudioKey+1,l=this.getNextATs()}else{var S=!1;if((r=u.data).isFull&&r.key>this.lastPlayVideoKey){var P=r.key-d-1;if(P>0)if(P>=4)S=!0;else for(var T=1;T<=P;++T)if(r.getLastFrameType(T)!==v.default.FRAMETYPE_VIDEO_B){S=!0;break}S&&!r.isKeyFrame||(S&&0!==d&&(n.default.logger.log("FlvPlayer.play skipVideo uid="+this.uid+" skipCnt="+P+" key="+d+"-"+r.key+" ts="+r.dts),this.videoPlayStat.skipVideoFrameCnt+=P),this.playVideo(r,e,d,u,P),d=r.key)}(u=u.next)===this.videoChain.head?a=n.default.Utils.UintMax:(r=u.data).isFull&&(a=r.dts)}for(;null!==(r=this.videoChain.peek())&&r.key<=d;)r=this.videoChain.get();this.lastPlayVideoKey=d,s>this.lastPlayTs&&(this.lastPlayTs=s),this.playAsMoreAsPossible(s,e)}}}},{key:"playAsMoreAsPossible",value:function(e,t){for(var i=null,s=null,a=0,r=0,u=0,o=this.lastPlayVideoKey;null!==(i=this.videoChain.peek())&&(a=i.stamp,i.isFull&&i.key===this.lastPlayVideoKey+1);){for(var l=!0;r=this.getNextATs(),u=this.lastPlayAudioKey+1,!(r>a);){if(null===(s=this.audioChain.peek())){l=!1;break}if(s.key!==u){l=!1;break}var d=s.dts-r;if(d<-10*y.default.MUSIC_MID_TIME_LEN){n.default.logger.warn("FlvPlayer.playAsMoreAsPossible audioFrame key continue but dts smaller, curAts:"+r+" audio dts:"+s.dts),this.audioChain.get(),l=!1;break}if(d>=3*y.default.MUSIC_MID_TIME_LEN){l=!1;break}this.playAudio(s,t,r)}if(!l)break;this.playVideo(i,t,o,null,0),o=(i=this.videoChain.get()).key,this.lastPlayVideoKey=o}}},{key:"playVideo",value:function(e,t,i,s,a){if(e.isKeyFrame){var u=m.default.getAvc(e),o=u.toString();if(this.lastAvcStr!==o){this.lastAvcStr=o;var l=m.default.packAvcFlvTag(e.dts,u);this.msePlayer&&this.msePlayer.appendFlv(l)}m.default.trimIFrame(e,u.length)}var d=e.dts-this.firstTs;m.default.setFrameTimestamp(d,e.streamData),this.lastAvcStr&&(this.msePlayer&&this.msePlayer.appendFlv(e.streamData),e.streamData=null,e.isPlayed=!0),this.lastPlayVideoSeq=e.lastPktSeq,this.videoPlayStat.onPlayStat(e,t,i,s,a),0==r.default.firstRenderTime&&(r.default.firstRenderTime=t,n.default.logger.log("%c[TIME] firstRenderTime="+(t-r.default.firstIFrameTime)+" totalTime="+(t-r.default.startTime),"color:#A23400;background:#FFF5C2"))}},{key:"playAudio",value:function(e,t,i){e.aacConfig&&(n.default.logger.log("FlvPlayer.playAudio aacConfig change uid="+this.uid),this.msePlayer&&this.msePlayer.appendFlv(e.aacConfig),e.aacConfig=null);var s=i-this.firstTs;m.default.setFrameTimestamp(s,e.streamData),this.msePlayer&&this.msePlayer.appendFlv(e.streamData),e.streamData=null,this.lastPlayAudioKey=e.key,this.incAts(1),e.isEmpty||this.audioChain.get(),e.isEmpty||(this.audioSsrc=e.ssrc)}},{key:"getEmptyAudioFrame",value:function(e,t){var i=new _.default;i.isEmpty=!0,i.key=t,i.dts=e,i.ssrc=n.default.Utils.UintMax;var s=new Uint8Array(n.default.AacFrame.emptyAacFrameAdts);u.default.chrome&&u.default.version.major<50&&(s=n.default.AacFrame.getSilentFrame(5,2));var a=1&s[0]?7:9;if(null===this.lastAacStr){var r=s.subarray(0,a),o=m.default.adtsToConfig(r);this.lastAacStr=o.toString();var l=m.default.packAudioFlvTag(0,o,0);this.msePlayer&&this.msePlayer.appendFlv(l),n.default.logger.log("FlvPlayer.getEmptyAudioFrame append aacConfig="+this.lastAacStr+" uid="+this.uid)}else Number(localStorage._printPreEmpytFrame)&&n.default.logger.log("FlvPlayer.getEmptyAudioFrame key="+t+" dts="+e+" uid="+this.uid);return s=s.subarray(a),i.streamData=m.default.packAudioFlvTag(e,s,1),i}},{key:"trimAudioBeforeDts",value:function(e){for(var t=this.audioChain.peek();t&&t.dts<e;)this.audioChain.get(),t=this.audioChain.peek();return t}},{key:"trimVideoBeforeDts",value:function(e){for(var t=this.videoChain.peek();t&&t.dts<e;)this.videoChain.get(),t=this.videoChain.peek();return t}},{key:"setLastAts",value:function(e){this.lastATs=e-y.default.MUSIC_MID_TIME_LEN}},{key:"getNextATs",value:function(){return Math.round(this.lastATs+y.default.MUSIC_MID_TIME_LEN)}},{key:"incAts",value:function(e){this.lastATs+=y.default.MUSIC_MID_TIME_LEN*e}},{key:"setFirstTs",value:function(e,t,i,s){var a=this.firstTsStatus;if(a>=e)n.default.logger.error("FlvPlayer.setFirstTs error change oldstatus:"+a+" new:"+e+" uid="+this.uid);else if(this.firstTs=t,this.firstOsTs=i,this.firstTsStatus=e,n.default.logger.log("FlvPlayer.setFirstTs status="+a+"->"+e+" firstTs="+t+" firstOsTs="+this.firstOsTs+" jitBufLen="+this.JitterBufLen+" firstSeq="+s+" uid="+this.uid),a!==this.FIRST_TS_AUDIO&&a!==this.FIRST_TS_AUDIO_PUSH||e>=this.FIRST_TS_VIDEO&&this.updateFirstTsForce(),this.firstTsStatus==this.FIRST_TS_VIDEO||this.firstTsStatus==this.FIRST_TS_VIDEO_PUSH){var u=this.trimVideoBeforeDts(this.firstTs);this.lastPlayVideoKey=u.key-1,this.lastPlayVideoSeq=u.lastPktSeq-2,n.default.logger.log("FlvPlayer.setFirstTs first video key="+this.lastPlayVideoKey+" ts="+u.dts+" pktNum="+u.pktNum+" uid="+this.uid);var o=this.trimAudioBeforeDts(this.firstTs);if(!o||o.dts-this.firstTs>y.default.MUSIC_MID_TIME_LEN?(this.lastPlayAudioKey=0,this.setLastAts(this.firstTs)):(this.lastPlayAudioKey=o.key-1,this.setLastAts(o.dts)),n.default.logger.log("FlvPlayer.setFirstTs first audio key="+this.lastPlayAudioKey+" ts="+this.lastATs+" uid="+this.uid),r.default.firstIFrameTime=i,n.default.logger.log("%c[TIME] firstIFrameTime="+(i-r.default.firstVideoPkgTime)+" totalTime="+(i-r.default.startTime),"color:#A23400;background:#FFF5C2"),null!==this.lastAacStr){var l=new Uint8Array(this.lastAacStr.split(",")),d=l.length>2?-1:0,h=m.default.packAudioFlvTag(0,l,d);this.msePlayer&&this.msePlayer.appendFlv(h)}}else if(this.firstTsStatus==this.FIRST_TS_AUDIO||this.firstTsStatus==this.FIRST_TS_AUDIO_PUSH){var f=this.trimAudioBeforeDts(this.firstTs);f&&f.dts===this.firstTs&&(this.lastPlayAudioKey=f.key-1,this.setLastAts(f.dts),n.default.logger.log("FlvPlayer.setFirstTs first pure audio key="+this.lastPlayAudioKey+" ts="+this.lastATs+" uid="+this.uid))}}},{key:"updateFirstTsForce",value:function(){n.default.logger.info("FlvPlayer.updateFirstTsForce uid="+this.uid),this.resetMsePlayer(),this.lastPlayTs=0,this.lastPlayAudioKey=0,this.lastPlayVideoKey=0,this.audioSsrc=n.default.Utils.UintMax}},{key:"getPlayTime",value:function(){if(!this.msePlayer)return 0;var e=this.msePlayer.getCurrentDts();return e>0&&(e+=this.firstTs),e}},{key:"calcCapToPlayDelay",value:function(e,t){if(0===t||0===this.osTime||!this.msePlayer)return 0;var i=0,s=r.default.videoNtp.convertToSrvTime(e);s&&(i=s-(this.localTime-(this.osTime-t)));return i+=this.msePlayer.getParserBufLen()+this.msePlayer.getBufferLen(),Math.round(i)}},{key:"calcRecvToPlayDelay",value:function(e,t){return this.msePlayer?e-t+this.msePlayer.getParserBufLen()+this.msePlayer.getBufferLen():0}},{key:"setPullSeq",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(i){if(this.lastPlayVideoSeq>=t)return;this.lastPlayVideoSeq>e&&(e=this.lastPlayVideoSeq+2);var s=this.videoQuickAccess.setPullSeq(e,t);s&&(r.default.isPull=!0,this.videoResender.setMaxPullSeq(t))}else this.audioQuickAccess.setPullSeq(e,t)}},{key:"onSubscribeStreamRes",value:function(e){n.default.logger.log("FlvPlayer.onSubscribeStreamRes uid="+this.uid+" sub="+e.subscribe+" res="+e.resCode),!e.subscribe||e.resCode>0||this.videoQuickAccess.setPullSeq(e.firstSeq,e.lastSeq)}},{key:"onVideoStreamData",value:function(t){var i=n.default.TimeUtil.now();if(0==r.default.firstVideoPkgTime&&(r.default.firstVideoPkgTime=i,n.default.logger.log("%c[TIME] firstVideoPkgTime="+(i-r.default.connectVideoTime)+" totalTime="+(i-r.default.startTime),"color:#A23400;background:#FFF5C2")),this.lastRecvVideoTs=i,this.videoQuickAccess.updatePull(t),t.seqNum<=this.lastPlayVideoSeq)return e.RECV_TOO_LATE;this.videoPlayStat.recvVideoPktCnt++,this.videoPlayStat.recvVideoByteCnt+=t.streamData.length+52;var s=e.RECV_SUCCESS;this.videoResender.OnRecvPacket(t,i)===g.default.RESENDRET_DOWNLINK_RESEND&&(s=e.DOWNLINK_RESEND);var a=this.videoChain.getOrNewNode(t.lastKeyFrame);if(!a)return e.RECV_ERROR;var u=null;return null===a.data?((u=new S.default).append(t),a.data=u,this.videoPlayStat.recvVideoFrameCnt++):(u=a.data).append(t),u.isFull&&u.isKeyFrame&&(this.firstTsStatus<this.FIRST_TS_VIDEO&&!u.isFastAccess&&this.setFirstTs(this.FIRST_TS_VIDEO,u.dts,u.recvTs,u.firstPktSeq),this.firstTsStatus<this.FIRST_TS_VIDEO_PUSH&&u.isFastAccess&&this.setFirstTs(this.FIRST_TS_VIDEO_PUSH,u.dts,u.recvTs,u.firstPktSeq)),s}},{key:"onAudioStreamData",value:function(t){var i=n.default.TimeUtil.now();this.lastRecvAudioTs=i,this.audioQuickAccess.updatePull(t);var s=0,a=t.streamGroupId.streamType;return s=a>=h.default.STREAM_AUDIO_FLV_RAW&&a<=h.default.STREAM_AUDIO_ALL_SID?this.packFlvAudioFrame(t,i):this.packRawAudioFrames(t,i),isNaN(s)||s<=0?e.RECV_ERROR:(this.firstTsStatus<this.FIRST_TS_AUDIO&&!t.isFastAccessPacket&&this.setFirstTs(this.FIRST_TS_AUDIO,s,i,t.seqNum),this.firstTsStatus<this.FIRST_TS_AUDIO_PUSH&&t.isFastAccessPacket&&this.setFirstTs(this.FIRST_TS_AUDIO_PUSH,s,i,t.seqNum),e.RECV_SUCCESS)}},{key:"packFlvAudioFrame",value:function(e,t){e.getFrameTime()<=this.lastPlayTs&&Number(localStorage._printDropAudio)&&n.default.logger.debug("FlvPlayer.packFlvAudioFrame drop seqNum="+e.seqNum);var i=new _.default;i.uid=e.uid,i.key=e.lastKeyFrame,i.seqNum=e.seqNum,i.isEmpty=!1,i.isFastAccess=e.isFastAccessPacket,i.isKeyFrame=1,i.dts=e.getFrameTime(),i.ssrc=0,i.codec=1,i.recvTs=t;var s=m.default.getAvc(e),a=s.toString();if(null===this.lastAacStr){this.lastAacStr=a;var r=m.default.packAudioFlvTag(0,s,-1);this.msePlayer&&this.msePlayer.appendFlv(r),n.default.logger.log("FlvPlayer.packFlvAudioFrame append aacConfig="+a+" uid="+this.uid)}else this.lastAacStr!=a&&(i.aacConfig=m.default.packAudioFlvTag(0,s,-1),n.default.logger.warn("FlvPlayer.packFlvAudioFrame aacConfig change, "+this.lastAacStr+" -> "+a+" uid="+this.uid),this.lastAacStr=a);return m.default.trimIFrame(e,s.length),i.streamData=e.streamData,this.audioChain.put(i),i.dts}},{key:"packRawAudioFrames",value:function(e,t){var i=new DataView(e.streamData.buffer),s=new c.default(i,!1),a=new d.default;a.unmarshall(s);var r=a.type;if(r!==y.default.MUSIC_MID&&r!==y.default.MUSIC_MID_128&&r!==y.default.MUSIC_MID_160&&r!==y.default.MUSIC_MID_192)return e.seqNum%200==0&&n.default.logger.warn("FlvPlayer.packRawAudioFrames not supported audio codec type="+r+" uid="+this.uid),!1;a.capTimeStamp<=this.lastPlayTs&&Number(localStorage._printDropAudio)&&n.default.logger.debug("FlvPlayer.packRawAudioFrames drop seqNum="+e.seqNum);for(var u=y.default.getAudioTimeLen(r),o=a.capTimeStamp,l=a.framenum,h=a.payload,f=h.length,p=null,v=0,g=0,S=0;S<l;S++){if(f<=1){n.default.logger.error("FlvPlayer.packRawAudioFrames invalid length "+S+"/"+l+" uid="+this.uid);break}(p=new _.default).uid=e.uid,p.key=a.framebase+(15&h[v++]),p.seqNum=e.seqNum,p.isEmpty=!1,p.isFastAccess=e.isFastAccessPacket,p.isKeyFrame=a.isKeyVoice,p.dts=o,p.ssrc=a.ssrc,p.codec=r,p.recvTs=t;var P=h.subarray(v);if(l>1&&0==(g=y.default.caculateOneFrameLength(r,P))){n.default.logger.warn("FlvPlayer.packRawAudioFrames tagLen invalid. uid="+this.uid);break}var T=1&P[0]?7:9,k=void 0;if(r==y.default.MUSIC_MID_128||r==y.default.MUSIC_MID_160||r==y.default.MUSIC_MID_192)T=2,k=m.default.creatAdtsConfig();else{var I=P.subarray(0,T);k=m.default.adtsToConfig(I)}var E=k.toString();if(null===this.lastAacStr){this.lastAacStr=E;var R=m.default.packAudioFlvTag(0,k,0);this.msePlayer&&this.msePlayer.appendFlv(R),n.default.logger.log("FlvPlayer.packRawAudioFrames append aacConfig="+E+" uid="+this.uid)}else this.lastAacStr!=E&&(p.aacConfig=m.default.packAudioFlvTag(0,k,0),n.default.logger.warn("FlvPlayer.packRawAudioFrames aacConfig change, "+this.lastAacStr+" -> "+E+" uid="+this.uid),this.lastAacStr=E);P=P.subarray(T),p.streamData=m.default.packAudioFlvTag(o,P,1),this.audioChain.put(p),o+=u,f-=1+g,v+=g,g=0}return a.capTimeStamp}},{key:"onStopStream",value:function(e){var t=this.msePlayer?this.msePlayer.getBufferLen():0;n.default.logger.info("FlvPlayer.onStopStream uid="+this.uid+" bufLen="+t),this.resetVideo(),this.huyaMgr.callback(n.default.Event.ANCHOR_STOP,{uid:this.uid})}},{key:"onVideoSyncSpeakerTime",value:function(e){this.osTime=e.osTime,this.localTime=e.localTime}},{key:"onResenderFailedAck",value:function(e){this.videoPlayStat.videoResendFailedAck++,this.videoResender.onResenderFailedAck(e)}},{key:"onPlayVideo",value:function(e,t,i,s,a){s?(this.huyaMgr.onPlayVideo(this.uid,e,t,i,s),this.updateStatus(n.default.Status.VIDEO_PLAYING),r.default.isPull&&this.firstTsStatus==this.FIRST_TS_VIDEO&&n.default.logger.warn("%cFlvPlayer.onPlayVideo No fast access pkg received!!! uid="+this.uid,"font-weight:900")):this.huyaMgr.onPlayAudio(this.uid,e)}},{key:"onVideoStop",value:function(e,t){n.default.logger.log("FlvPlayer.onVideoStop uid="+this.uid+" hasVideo="+t),t?(this.updateStatus(n.default.Status.VIDEO_STOP),this.huyaMgr.callback(n.default.Event.VIDEO_STOP,{uid:this.uid,video:e,haveVideo:!0})):this.updateStatus(n.default.Status.AUDIO_STOP)}},{key:"onPlayerError",value:function(e){this.resetMsePlayer(),e&&this.huyaMgr.callback(n.default.Event.H5_PLAYER_ERROR)}},{key:"onPlayPause",value:function(e,t){this.pauseStartTs=e,t&&this.updateStatus(n.default.Status.VIDEO_CACHING)}},{key:"onPlayResume",value:function(e,t){if(this.pauseStartTs){var i=e-this.pauseStartTs;i>200&&(n.default.logger.warn("FlvPlayer.onPlayResume uid="+this.uid+" pauseTime="+i+" start="+this.pauseStartTs+" now="+e),this.videoPlayStat.sensePauseTime+=i,this.videoPlayStat.sensePauseCnt++,this.videoPlayStat.sensePauseTime5+=i,this.videoPlayStat.sensePauseCnt5++),this.pauseStartTs=0}t&&this.updateStatus(n.default.Status.VIDEO_PLAYING)}},{key:"updateStatus",value:function(e){this.videoStatus!==e&&(this.videoStatus=e,this.huyaMgr.callback(n.default.Event.PLAY_STATUS,{uid:this.uid,status:e}))}}]),e}();k.RECV_SUCCESS=0,k.DOWNLINK_RESEND=1,k.RECV_TOO_LATE=3,k.RECV_ERROR=4,k.TEMP_BUFFERED=5,t.default=k},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){(0,s.default)(this,e),this.size=0,this.head=null,this.freeChainSize=0,this.freeChain=null,this.travelNode=null}return(0,a.default)(e,[{key:"resetTravel",value:function(){this.travelNode=this.head}},{key:"travel",value:function(){if(null===this.travelNode&&(this.travelNode=this.head,null===this.travelNode))return null;var e=this.travelNode.data;return this.travelNode=this.travelNode.next,this.travelNode===this.head||null===this.travelNode?null:e}},{key:"reset",value:function(){this.resetTravel();var e=null,t=null;for(e=this.head;null!=e;)t=e,e=e.next,t.data=null,t.prev=null,t.next=null,e===this.head&&(e=null);for(this.head=null,e=this.freeChain;null!=e;)t=e,e=e.next,t.data=null,t.prev=null,t.next=null;this.freeChain=null,this.size=0,this.freeChainSize=0}},{key:"put",value:function(e){var t=this.getFree(e);if(this.size++,null===this.head)t.prev=t,t.next=t,this.head=t;else if(t.data.key<this.head.data.key)t.prev=this.head.prev,t.next=this.head,t.prev.next=t,t.next.prev=t,this.head=t;else{for(var i=this.head.prev;t.data.key<i.data.key;)i=i.prev;if(t.data.key===i.data.key)return this.size--,this.putFree(t),!1;t.prev=i,t.next=i.next,t.prev.next=t,t.next.prev=t}return!0}},{key:"put2",value:function(e){var t=this.getFree(e);if(this.size++,null===this.head)t.prev=t,t.next=t,this.head=t;else if(t.data.key<this.head.data.key)t.prev=this.head.prev,t.next=this.head,t.prev.next=t,t.next.prev=t,this.head=t;else{for(var i=this.head;t.data.key>i.data.key&&(i=i.next)!==this.head;);if(t.data.key===i.data.key)return this.size--,this.putFree(t),!1;t.prev=i.prev,t.next=i,i.prev.next=t,i.prev=t}return!0}},{key:"get",value:function(){if(null===this.head)return null;var e=this.head,t=e.data;return this.size--,0===this.size?this.head=null:(e.prev.next=e.next,e.next.prev=e.prev,this.head=this.head.next),this.putFree(e),t}},{key:"peek",value:function(){return null===this.head?null:this.head.data}},{key:"peekLast",value:function(){return null===this.head?null:this.head.prev.data}},{key:"getOrNewNode",value:function(e){var t=null;if(null===this.head)this.size++,(t=this.getFree(null)).prev=t,t.next=t,this.head=t;else if(e<this.head.data.key)this.size++,(t=this.getFree(null)).prev=this.head.prev,t.next=this.head,t.prev.next=t,t.next.prev=t,this.head=t;else{for(var i=this.head.prev;e<i.data.key;)i=i.prev;i.data.key===e?t=i:(this.size++,(t=this.getFree(null)).prev=i,t.next=i.next,t.prev.next=t,t.next.prev=t)}return t}},{key:"putFree",value:function(e){e.data=null,e.next=this.freeChain,e.prev=null,this.freeChain=e,this.freeChainSize++}},{key:"getFree",value:function(e){if(null===this.freeChain)return new u(e);var t=this.freeChain;return t.data=e,this.freeChain=t.next,this.freeChainSize--,t}},{key:"getLast",value:function(){if(null==this.head)return null;var e=this.head.prev,t=e.data;return this.size--,0===this.size?this.head=null:(e.prev.next=e.next,e.next.prev=e.prev),this.putFree(e),t}}]),e}(),u=function e(t){(0,s.default)(this,e),this.next=null,this.prev=null,this.data=t};t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(0)),a=o(i(1)),r=o(i(11)),n=o(i(69)),u=o(i(2));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,s.default)(this,e),this.uid=t,this.isVideo=i,this.LOG_TAG=i?"Video":"Audio",this.MAX_PULL_SEQ_INTERVAL=15e3,this.MAX_PULL_CNT_PER_TIME=100,this.MAX_PULL_TASK_CNT=5,this.QUICK_ACCESS_OT=1e4,this.firstPullSeq=u.default.Utils.UintMax,this.lastPullSeq=u.default.Utils.UintMax,this.reqMaxPullSeq=u.default.Utils.UintMax,this.pullTasks=[],this.startPullTs=0,this.isPulling=!1}return(0,a.default)(e,[{key:"setPullSeq",value:function(e,t){if(this.isPulling)return u.default.logger.info(this.LOG_TAG+"QuickAccess.setPullSeq pull task not finished, refuse new pull request"),!1;if(e===u.default.Utils.UintMax||t===u.default.Utils.UintMax||t<=e)return u.default.logger.log(this.LOG_TAG+"QuickAccess.setPullSeq invalid seq uid="+this.uid+" seq=["+e+","+t+"] cnt="+i),!1;if(this.firstPullSeq!==u.default.Utils.UintMax&&this.lastPullSeq!==u.default.Utils.UintMax)if(e>this.lastPullSeq);else{if(t<=this.lastPullSeq)return!1;e=this.lastPullSeq+2}var i=(t-e)/2+1;if(t-e>this.MAX_PULL_SEQ_INTERVAL)u.default.logger.log(this.LOG_TAG+"QuickAccess.setPullSeq too much uid="+this.uid+" seq=["+e+","+t+"] cnt="+i),this.reset();else{var s=u.default.TimeUtil.now();this.firstPullSeq=e,this.lastPullSeq=t,this.reqMaxPullSeq=this.firstPullSeq-2,this.startPullTs=s,u.default.logger.log(this.LOG_TAG+"QuickAccess.setPullSeq uid="+this.uid+" seq=["+e+","+t+"] cnt="+i),this.checkPull(s)}return!0}},{key:"updatePull",value:function(e){if(e.isFastAccessPacket&&(!this.isVideo||!e.isAudio)&&(this.isVideo||!e.isVideo))for(var t=e.seqNum,i=0;i<this.pullTasks.length;i++){var s=this.pullTasks[i];if(t<s.startSeq)break;if(t>=s.startSeq&&t<=s.endSeq){this.pullTasks.shift();var a=u.default.TimeUtil.now();this.checkPull(a);break}}}},{key:"checkPull",value:function(e){if(this.reqMaxPullSeq!==this.lastPullSeq){if(e-this.startPullTs>=this.QUICK_ACCESS_OT)return u.default.logger.warn(this.LOG_TAG+"QuickAccess.checkPull pull timeout uid="+this.uid),this.isPulling=!1,void this.reset();if(!(this.pullTasks.length>=this.MAX_PULL_TASK_CNT))for(var t=this.MAX_PULL_TASK_CNT-this.pullTasks.length;0!==t;){var i=new n.default;i.uid=this.uid,this.isVideo&&r.default.videoStreamId?i.streamGroupId=r.default.videoStreamId:!this.isVideo&&r.default.audioStreamId&&(i.streamGroupId=r.default.audioStreamId);var s=this.reqMaxPullSeq+2,a=this.reqMaxPullSeq+2*this.MAX_PULL_CNT_PER_TIME;a=a>this.lastPullSeq?this.lastPullSeq:a;for(var o=s;o<=a;o+=2)i.seqNums.push(o);var l={startSeq:s,endSeq:a};this.pullTasks.push(l),t--,this.reqMaxPullSeq=a,r.default.send(i);var d=a===this.lastPullSeq;d?(t=0,this.isPulling=!1):this.isPulling=!0,u.default.logger.log("pull"+this.LOG_TAG+" uid="+this.uid+" seq=["+s+", "+a+"] num="+i.seqNums.length+" taskCnt="+this.pullTasks.length+" "+(d?"finished":""))}}}},{key:"reset",value:function(){u.default.logger.log(this.LOG_TAG+"QuickAccess.reset"),this.firstPullSeq=u.default.Utils.UintMax,this.lastPullSeq=u.default.Utils.UintMax,this.reqMaxPullSeq=u.default.Utils.UintMax,this.pullTasks.splice(0,this.pullTasks.length),this.startPullTs=0}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={Quality_AAC:"AAC",Quality_SILK:"SILK",MUSIC_MID:1,MUSIC_MID_TIME_LEN:2048e3/44100,MUSIC_MID_128:35,MUSIC_MID_128_TIME_LEN:1024e3/44100,MUSIC_MID_160:36,MUSIC_MID_160_TIME_LEN:1024e3/44100,MUSIC_MID_192:37,MUSIC_MID_192_TIME_LEN:1024e3/44100,VOICE_HIGHER:2,VOICE_HIGHER_TIME_LEN:20,VOICE_HIGHER_FRAME_LEN:882,VOICE_HIGHER_QUALITY1:22,VOICE_HIGHER_QUALITY1_TIME_LEN:20,VOICE_HIGHER_QUALITY1_FRAME_LEN:882,getAudioTimeLen:function(e){switch(e){case this.MUSIC_MID:return this.MUSIC_MID_TIME_LEN;case this.MUSIC_MID_128:return this.MUSIC_MID_128_TIME_LEN;case this.MUSIC_MID_160:return this.MUSIC_MID_160_TIME_LEN;case this.MUSIC_MID_192:return this.MUSIC_MID_192_TIME_LEN;case this.VOICE_HIGHER:return this.VOICE_HIGHER_TIME_LEN;default:return 0}},getAudioQualityType:function(e){switch(e){case this.MUSIC_MID:case this.MUSIC_MID_128:case this.MUSIC_MID_160:case this.MUSIC_MID_192:return s.Quality_AAC;case this.VOICE_HIGHER:default:return s.Quality_SILK}},NET_UNKNOWN_CODEC:-1e3,NET_AACPLUS:1,NET_AAC_128K:35,NET_AAC_160K:36,NET_AAC_192K:37,NET_AMRWB:3,NET_SILK_16K:2,NET_SILK_24K:22,NET_SPEEX_MODE_8:0,NET_SPEEX_MODE_4:21,NET_SPEEX_MODE_2:23,NET_OPUS_24K4:50,NET_VIDEO_H264:2e3,NET_VIDEO_VP8:2001,NET_VIDEO_H265:2002,NET_PHONE_1ON1_PROTO:98,caculateOneFrameLength:function(e,t){var i=0,a=t.length;switch(e){case s.NET_AACPLUS:case s.NET_AAC_128K:case s.NET_AAC_160K:case s.NET_AAC_192K:if(a>=7){var r=3&t[3],n=t[4],u=t[5]>>5&7;(i=r<<11|n<<3|u)>a&&(i=0),0!=r&&console.log("-------caculateOneFrameLength--------")}break;case s.NET_AMRWB:if(a>=1){(i=[18,24,33,37,41,47,51,59,61,6,6,0,0,0,1,1][t[0]>>3&15])>a&&(i=0)}break;case s.NET_SILK_16K:case s.NET_SILK_24K:if(a>=2){var o=t[1]<<8|t[0];64512==(64512&o)&&(i=2+(1023&o))>a&&(i=0)}break;case s.NET_SPEEX_MODE_8:(i=38)>a&&(i=0);break;case s.NET_SPEEX_MODE_4:(i=20)>a&&(i=0);break;case s.NET_SPEEX_MODE_2:(i=15)>a&&(i=0)}return i}};t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){(0,s.default)(this,e)}return(0,a.default)(e,null,[{key:"getFlvHeader",value:function(){var e=new Uint8Array(13),t=0;return e[t++]=70,e[t++]=76,e[t++]=86,e[t++]=1,e[t++]=5,e[t++]=0,e[t++]=0,e[t++]=0,e[t++]=9,e[t++]=0,e[t++]=0,e[t++]=0,e[t++]=0,e}},{key:"packAudioFlvTag",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,s=t.length+2,a=new Uint8Array(11+s+4),r=0;return a[r++]=8,a[r++]=s>>16&255,a[r++]=s>>8&255,a[r++]=255&s,a[r++]=e>>16&255,a[r++]=e>>8&255,a[r++]=255&e,a[r++]=e>>24&255,a[r++]=0,a[r++]=0,a[r++]=0,-1!=i&&(a[r++]=175,a[r++]=i),a.set(t,r),r+=t.length,s+=11,a[r++]=s>>24&255,a[r++]=s>>16&255,a[r++]=s>>8&255,a[r++]=255&s,a}},{key:"packAvcFlvTag",value:function(e,t){var i=t.length+5,s=new Uint8Array(11+i+4),a=0;s[a++]=9,s[a++]=i>>16&255,s[a++]=i>>8&255,s[a++]=255&i,s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=255&e,s[a++]=e>>24&255,s[a++]=0,s[a++]=0,s[a++]=0,s[a++]=23,s[a++]=0,s[a++]=0,s[a++]=0,s[a++]=0,s.set(t,a),a+=t.length;var r=11+i;return s[a++]=r>>24&255,s[a++]=r>>16&255,s[a++]=r>>8&255,s[a++]=255&r,s}},{key:"adtsToConfig",value:function(e){var t=new Uint8Array(2),i=1+((192&e[2])>>6),s=(60&e[2])>>2,a=(1&e[2])<<2|(192&e[3])>>6;return t[0]=i<<3|(14&s)>>1,t[1]=(1&s)<<7|a<<3,t}},{key:"creatAdtsConfig",value:function(){var e=new Uint8Array(2);return e[0]=18,e[1]=16,e}},{key:"setFrameTimestamp",value:function(e,t){t[4]=e>>16&255,t[5]=e>>8&255,t[6]=255&e,t[7]=e>>24&255}},{key:"getAvc",value:function(e){var t=e.streamData[0];return t+=e.streamData[1]<<8,t+=e.streamData[2]<<16,t+=e.streamData[3]<<24>>>0,e.streamData.subarray(4,4+t)}},{key:"trimIFrame",value:function(e,t){e.streamData=e.streamData.subarray(4+t)}}]),e}();t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=p(i(19)),a=p(i(94)),r=p(i(5)),n=p(i(0)),u=p(i(1)),o=p(i(11)),l=p(i(198)),d=p(i(199)),h=p(i(200)),f=p(i(70)),c=p(i(2));function p(e){return e&&e.__esModule?e:{default:e}}var v=function(){function e(t){(0,n.default)(this,e),this.player=t,this.videoPlayStat=t.videoPlayStat,this.CheckResendInterval=20,this.KeepLateSeqGap=500,this.MaxTolerateDelayDelta=15e3,this.FailedAckWaitTime=500,this.MaxQueueLen=1e4,this.MaxResendSeqCnt=50,this.resendAgainWhileFailedAck=!0,this.lastResendStamp=0,this.seqStatus=new l.default,this.firstRtoCalc=new h.default(200),this.waitResendMap=new r.default,this.alreadyResendMap=new r.default,this.start=!0,this.minDelayDelta=0}return(0,u.default)(e,[{key:"reset",value:function(){c.default.logger.log("VideoResender.reset()"),this.firstRtoCalc.reset(),this.seqStatus.reset(),this.lastResendStamp=0,this.minDelayDelta=0,this.cleanAllMaps()}},{key:"onCheckFastTimer",value:function(e,t){if(this.start&&!(0!==this.lastResendStamp&&e<this.lastResendStamp+this.CheckResendInterval)){this.lastResendStamp=e;var i=[],r=[],n=this.player.lastPlayVideoSeq,u=0,o=!0,l=!1,d=void 0;try{for(var h,f=(0,s.default)(this.waitResendMap);!(o=(h=f.next()).done);o=!0){var p=h.value,v=(0,a.default)(p,2),y=v[0],m=v[1];if(u++>this.MaxQueueLen)return c.default.logger.warn("VideoResender.onCheckFastTimer notResendCnt exceed MaxQueueLen"),void this.reset();this.seqStatus.IsServerHave(y)&&c.default.Utils.isBiggerUint(e,m.createStampc+m.delta)?(m.sendStampc=e,m.resendTimes++,r.push(y),i.push(m.seq),this.alreadyResendMap.set(y,m)):m.resendTimes>=3?(this.videoPlayStat.videoResendNotRecvCnt++,r.push(y)):0!==n&&c.default.Utils.isBiggerUint(n-this.KeepLateSeqGap,y)?(this.seqStatus.IsServerLost(y)&&this.videoPlayStat.videoResendServerLostCnt++,this.videoPlayStat.videoResendNotSendCnt++,r.push(y)):e-m.createStampc>1e4&&r.push(y)}}catch(e){l=!0,d=e}finally{try{!o&&f.return&&f.return()}finally{if(l)throw d}}this.cleanSeqsFromMap(r,this.waitResendMap),this.doResend(i,e),r=[];var g=0,_=!0,S=!1,P=void 0;try{for(var T,k=(0,s.default)(this.alreadyResendMap);!(_=(T=k.next()).done);_=!0){var I=T.value,E=(0,a.default)(I,2),R=E[0],U=E[1];if(g++>this.MaxQueueLen)return c.default.logger.warn("VideoResender.onCheckFastTimer alreadyResendCnt exceed MaxQueueLen"),void this.cleanAllMaps();0!==n&&c.default.Utils.isBiggerUint(n-this.KeepLateSeqGap,R)&&(!1===U.received&&this.videoPlayStat.videoResendNotRecvCnt++,r.push(R))}}catch(e){S=!0,P=e}finally{try{!_&&k.return&&k.return()}finally{if(S)throw P}}this.cleanSeqsFromMap(r,this.alreadyResendMap)}}},{key:"OnRecvPacket",value:function(t,i){if(!this.start)return e.RESENDRET_NOTSTART;var s=e.RESENDRET_SUCCESS,a=t.seqNum;if(this.videoPlayStat.videoResendPacketsInAll++,a<=this.player.lastPlayVideoSeq-this.KeepLateSeqGap)return this.videoPlayStat.videoResendTooOldCnt++,e.RESENDRET_TOOLATE;if(a>this.player.lastPlayVideoSeq&&this.seqStatus.OnRecvPacket(t,i),this.alreadyResendMap.has(a)){var r=this.alreadyResendMap.get(a);if(r.received=!0,r.sendStampc===t.stampc){t.isDownlinkResend=!0,this.videoPlayStat.videoResendRecvCnt++;var n=i-t.stampc;o.default.downlinkRTOCalculator.CheckInvalidDownlinkRtt(n,i),s=e.RESENDRET_DOWNLINK_RESEND}else a>this.player.lastPlayVideoSeq-200&&this.videoPlayStat.videoResendRepeatCnt++,s=e.RESENDRET_SUCCESS}else if(this.waitResendMap.has(a)){var u=this.waitResendMap.get(a);if(u.seq!==a)return c.default.logger.error("VideoResender.OnRecvPacket error, info.seq:"+u.seq+" packet.seqNum"+a),e.RESENDRET_ERROR;this.waitResendMap.delete(a),s=e.RESENDRET_SUCCESS}if(!t.isDownlinkResend&&!t.isUplinkResend&&!t.isFastAccessPacket){var l=Number(i)-Number(t.stampc);(l<this.minDelayDelta||0===this.minDelayDelta)&&(this.minDelayDelta=l),l-this.minDelayDelta>this.MaxTolerateDelayDelta&&this.videoPlayStat.videoResendLargeDelay++}return t.isFastAccessPacket?e.RESENDRET_PULL:(this.checkUnResendPackets(t,i),s)}},{key:"onResenderFailedAck",value:function(e){if(this.seqStatus.OnRejecteResend(e.seqNums),this.resendAgainWhileFailedAck){for(var t=c.default.TimeUtil.now(),i=[],s=0;s<e.seqNums.length;s++){var a=e.seqNums[s];if(this.alreadyResendMap.has(a)){i.push(a);var r=this.alreadyResendMap.get(a);r.createStampc=t,r.delta=this.FailedAckWaitTime,this.waitResendMap.set(a,r)}}this.cleanSeqsFromMap(i,this.alreadyResendMap)}}},{key:"setMaxPullSeq",value:function(e){if(0==this.seqStatus.minRecvSeq)this.seqStatus.minRecvSeq=e,this.seqStatus.maxRecvSeq=e,c.default.logger.log("VideoResender.setMaxPullSeq AAA",e);else{var t=c.default.TimeUtil.now(),i=this.seqStatus.minRecvSeq,s=this.player.lastPlayVideoSeq;c.default.logger.log("VideoResender.setMaxPullSeq BBB",e,"minRecvSeq="+i),this.produceResendInfo(i,e,s,30,t)}}},{key:"checkUnResendPackets",value:function(e,t){var i=e.seqNum,s=30;e.isDownlinkResend||e.isUplinkResend||(s=this.firstRtoCalc.calculateFirstRto(e,t));var a=this.player.lastPlayVideoSeq,r=this.seqStatus.maxRecvSeq;if(this.seqStatus.checkCurrentSeq(i,a,t)){if(0===r)return;this.produceResendInfo(i,r,a,s,t)}}},{key:"produceResendInfo",value:function(e,t,i,s,a){if(!c.default.Utils.isEqualOrBiggerUint(t,e))for(var r=t+2;r<e;r+=2)if(!c.default.Utils.isEqualOrBiggerUint(i,r)&&!this.seqStatus.IsCheckedResend(r)){var n=this.firstRtoCalc.limitFirstDownlinkRto(s,r,e),u=new d.default;u.createStampc=a,u.delta=n,u.resendTimes=0,u.seq=r,this.waitResendMap.set(r,u),this.seqStatus.CheckedResend(r),this.seqStatus.SetResendSended(r)}}},{key:"doResend",value:function(e,t){for(e.length>0&&c.default.logger.log("VideoResender.doResend seqCnt="+e.length);e.length>0;){var i=e.length>this.MaxResendSeqCnt?this.MaxResendSeqCnt:e.length;this.videoPlayStat.videoResendSendCnt+=i,this.pkg||(this.pkg=new f.default);var s=this.pkg;if(o.default.videoStreamId&&(s.streamGroupId=o.default.videoStreamId),s.sender=this.player.uid,s.receiver=o.default.getUid(),s.stampc=t,s.seqNums=e.slice(0,i),!o.default.send(s))return c.default.logger.log("VideoResender.doResend sendVideo failed"),void this.reset();c.default.logger.debug("Resend: "+s.seqNums.toString()),e.splice(0,i)}}},{key:"cleanSeqsFromMap",value:function(e,t){for(var i=0;i<e.length;i++){var s=e[i];t.delete(s)}}},{key:"cleanAllMaps",value:function(){c.default.logger.info("VideoResender.cleanAllMaps"),this.waitResendMap.clear(),this.alreadyResendMap.clear()}}]),e}();v.RESENDRET_SUCCESS=0,v.RESENDRET_DOWNLINK_RESEND=1,v.RESENDRET_NOTSTART=2,v.RESENDRET_TOOLATE=3,v.RESENDRET_ERROR=4,v.RESENDRET_PULL=5,t.default=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.MaxByteIndex=4095,this.MaxSeqGap=this.MaxByteIndex<<1,this.RECVED_VIDEO=1,this.UPLINK_RESEND=2,this.DOWNLINK_RESEND=4,this.SERVER_RESEND=8,this.RECVED_LATE=16,this.SERVER_RECVED=32,this.SERVER_CONFORMED=64,this.SERVER_REJECTED=128,this.CHECKED_RESEND=256,this.DUPLICATED_VIDEO=512,this.SENT_TO_PEER=1024,this.RESEND_SENDED=2048,this.statusVec=[],this.maxSeq=0,this.minSeq=0,this.playedSeq=0,this.lastRecvStamp=0,this.seqBytes=new Uint8Array(4),this.maxRecvSeq=0,this.minRecvSeq=0,this.minRecvSeqLimit=0,this.seqInvalidStamp=0,this.packetSeqGap=400,this.reset()}return(0,a.default)(e,[{key:"reset",value:function(){this.setToZero(this.statusVec,0,this.MaxByteIndex+1),this.maxSeq=0,this.minSeq=0,this.playedSeq=0,this.lastRecvStamp=0,this.maxRecvSeq=0,this.minRecvSeq=0,this.minRecvSeqLimit=0,this.seqInvalidStamp=0}},{key:"OnRecvPacket",value:function(e,t){var i=e.seqNum,s=this.SERVER_RECVED|this.SERVER_CONFORMED|this.CHECKED_RESEND;0!==this.playedSeq&&i<=this.playedSeq?s|=this.RECVED_LATE:s|=this.RECVED_VIDEO,e.isUplinkResend&&(s|=this.UPLINK_RESEND),e.isDownlinkResend&&(s|=this.DOWNLINK_RESEND),e.isServerResend&&(s|=this.SERVER_RESEND),this.lastRecvStamp=t,this.addStatus(i,s),this.checkServerRecved(e)}},{key:"checkServerRecved",value:function(e){this.seqBytes[0]=e.ext>>24&255,this.seqBytes[1]=e.ext>>16&255,this.seqBytes[2]=e.ext>>8&255,this.seqBytes[3]=255&e.ext;for(var t=2*(255&e.playTime),i=e.seqNum,s=0;s<32;s++)i-=t,0==(this.seqBytes[s>>3]&1<<(7&s))?this.AddProperty(i,this.SERVER_CONFORMED):this.AddProperty(i,this.SERVER_CONFORMED|this.SERVER_RECVED)}},{key:"OnRejecteResend",value:function(e){for(var t=0;t<e.length;t++)this.addStatus(e[t],this.SERVER_REJECTED)}},{key:"CheckedResend",value:function(e){this.AddProperty(e,this.CHECKED_RESEND)}},{key:"SetResendSended",value:function(e){this.AddProperty(e,this.RESEND_SENDED)}},{key:"SetServerRejected",value:function(e){this.AddProperty(e,this.SERVER_REJECTED)}},{key:"IsSeqValid",value:function(e,t){if(0===this.maxSeq||0===this.lastRecvStamp||t-this.lastRecvStamp>1e4)return!0;return r.default.Utils.isEqualOrBiggerUint(this.maxSeq,e)?this.maxSeq-e<=this.MaxSeqGap:e-this.maxSeq<=this.MaxSeqGap}},{key:"IsServerHave",value:function(e){return!!this.HasProperty(e,this.SERVER_RECVED)}},{key:"IsServerLost",value:function(e){return!1!==this.IsServerConfirmed(e)&&!this.HasProperty(e,this.SERVER_RECVED)}},{key:"IsServerConfirmed",value:function(e){return!!this.HasProperty(e,this.SERVER_CONFORMED)}},{key:"IsCheckedResend",value:function(e){return!!this.HasProperty(e,this.CHECKED_RESEND)}},{key:"IsResendSended",value:function(e){return!!this.HasProperty(e,this.RESEND_SENDED)}},{key:"IsServerRejected",value:function(e){return!!this.HasProperty(e,this.SERVER_REJECTED)}},{key:"AddProperty",value:function(e,t){r.default.Utils.isBiggerUint(this.maxSeq-this.MaxSeqGap,e)||this.update(e,t)}},{key:"RemoveProperty",value:function(e,t){r.default.Utils.isBiggerUint(this.maxSeq-this.MaxSeqGap,e)||(this.statusVec[this.getPos(e)]=this.statusVec[this.getPos(e)]&(r.default.Utils.UintMax^t),(0===this.minSeq||r.default.Utils.isBiggerUint(this.minSeq,e))&&(this.minSeq=e))}},{key:"HasProperty",value:function(e,t){return(this.getStatus(e)&t)===t}},{key:"getPos",value:function(e){return e>>1&this.MaxByteIndex}},{key:"update",value:function(e,t){this.statusVec[this.getPos(e)]|=t,(0===this.minSeq||r.default.Utils.isBiggerUint(this.minSeq,e))&&(this.minSeq=e)}},{key:"addStatus",value:function(e,t){if(0===this.maxSeq)return this.maxSeq=e,void this.update(e,t);if(r.default.Utils.isBiggerUint(e,this.maxSeq))r.default.Utils.isBiggerUint(e,this.maxSeq+this.MaxSeqGap)?(this.reset(),this.maxSeq=e,this.update(e,t)):this.onBiggerSeq(e,t);else{if(r.default.Utils.isBiggerUint(this.maxSeq-this.MaxSeqGap,e))return;this.update(e,t)}}},{key:"onBiggerSeq",value:function(e,t){var i=e-this.MaxSeqGap;r.default.Utils.isBiggerUint(i,this.minSeq)&&this.resetMinPos(i),this.maxSeq=e,this.update(e,t)}},{key:"resetMinPos",value:function(e){var t=this.getPos(this.minSeq),i=this.getPos(e-2);this.minSeq=e,t>i?(this.setToZero(this.statusVec,t,this.MaxByteIndex-t+1),this.setToZero(this.statusVec,0,i+1)):this.setToZero(this.statusVec,t,i-t+1)}},{key:"setToZero",value:function(e,t,i){for(var s=0;s<i;s++)e[t+s]=0}},{key:"getStatus",value:function(e){var t=0;return 0!==this.maxSeq&&r.default.Utils.isEqualOrBiggerUint(e,this.minSeq)&&r.default.Utils.isEqualOrBiggerUint(this.maxSeq,e)&&(t=this.statusVec[this.getPos(e)]),t}},{key:"checkCurrentSeq",value:function(e,t,i){if(0===this.maxRecvSeq)return this.maxRecvSeq=e,this.minRecvSeq=e,!1;if(0!==this.minRecvSeqLimit&&r.default.Utils.isBiggerUint(this.minRecvSeqLimit,e))return r.default.logger.debug("PacketSeqChecker.checkCurrentSeq cur video seq="+e+" smaller than minRecvLimit="+this.minRecvSeqLimit),this.seqInvalidStamp=i,!1;if(r.default.Utils.isEqualOrBiggerUint(this.minRecvSeq,e))return this.minRecvSeq-e>this.packetSeqGap?(r.default.logger.debug("PacketSeqChecker.checkCurrentSeq cur video seq="+e+" too smaller than minRecvSeq="+this.minRecvSeq),this.minRecvSeqLimit=e,this.seqInvalidStamp=i,!1):(this.minRecvSeq=e,!0);if(0!==t&&r.default.Utils.isEqualOrBiggerUint(t,e))return!1;if(r.default.Utils.isEqualOrBiggerUint(this.maxRecvSeq,e))return!0;var s=this.maxRecvSeq;return this.maxRecvSeq=e,!(e-s>this.packetSeqGap)||(r.default.logger.log("PacketSeqChecker.checkCurrentSeq cur video seq="+e+" too larger than maxRecvSeq="+s),this.minRecvSeqLimit=e,this.minRecvSeq=e,this.seqInvalidStamp=i,!1)}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(){(0,s.default)(this,e),this.seq=0,this.createStampc=0,this.sendStampc=0,this.delta=0,this.resendTimes=0,this.received=!1,this.parentDelay=0,this.parentSeqDiff=0}return(0,a.default)(e,[{key:"reset",value:function(){this.seq=0,this.createStampc=0,this.sendStampc=0,this.delta=0,this.resendTimes=0,this.received=!1,this.parentDelay=0,this.perantSeqDiff=0}}]),e}();t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(i(0)),a=r(i(1));function r(e){return e&&e.__esModule?e:{default:e}}var n=function(){function e(t){(0,s.default)(this,e),this.cap=t>20?t:200,this.jittersVec=[],this.jitterIdx=0,this.maxJitter=Number.NEGATIVE_INFINITY,this.minJitter=Number.POSITIVE_INFINITY}return(0,a.default)(e,[{key:"reset",value:function(){this.jittersVec=[],this.jitterIdx=0,this.maxJitter=Number.NEGATIVE_INFINITY}},{key:"calculateFirstRto",value:function(e,t){var i=Number(t)-Number(e.stampc);this.addJitter(i);var s=this.max(),a=0;return null===s?a=150:(a=s-i,a+=200,a=this.limit(30,a,1500)),a}},{key:"addJitter",value:function(e){var t=!1;this.jittersVec.length===this.cap?(e>this.maxJitter?this.maxJitter=e:this.jittersVec[this.jitterIdx]===this.maxJitter&&(t=!0),this.jittersVec[this.jitterIdx++]=e,this.jitterIdx>=this.cap&&(this.jitterIdx=this.jitterIdx%this.cap),t&&this.reCalcMax()):(this.jittersVec.push(e),e>this.maxJitter&&(this.maxJitter=e))}},{key:"reCalcMax",value:function(){this.maxJitter=Number.NEGATIVE_INFINITY;for(var e=0;e<this.jittersVec.length;e++)this.jittersVec[e]>this.maxJitter&&(this.maxJitter=this.jittersVec[e])}},{key:"max",value:function(){return this.jittersVec.length>=20?this.maxJitter:null}},{key:"limit",value:function(e,t,i){return t<e?e:t>i?i:t}},{key:"limitFirstDownlinkRto",value:function(e,t,i){var s=6*(i-t)/2;return e=e>s?e-s:0}}]),e}();t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(i(0)),a=n(i(1)),r=n(i(2));function n(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.uid=0,this.key=0,this.seqNum=0,this.isEmpty=!1,this.isFastAccess=!1,this.isKeyFrame=!1,this.dts=0,this.streamData=null,this.aacConfig=null,this.ssrc=r.default.Utils.UintMax,this.codec=0,this.recvTs=0}return(0,a.default)(e,[{key:"reset",value:function(){this.uid=0,this.key=0,this.seqNum=0,this.isEmpty=!1,this.isFastAccess=!1,this.isKeyFrame=!1,this.dts=0,this.streamData=null,this.aacConfig=null,this.ssrc=r.default.Utils.UintMax,this.codec=0,this.recvTs=0}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(19)),a=o(i(0)),r=o(i(1)),n=o(i(112)),u=o(i(2));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(){(0,a.default)(this,e),this.uid=0,this.key=null,this.isFastAccess=!1,this.hasFirst=!1,this.pktNum=null,this.firstPktSeq=null,this.lastPktSeq=null,this.dts=null,this.recvTs=null,this.size=0,this.streamData=null,this.packets=[],this.frameType=-1,this.allframeType=null,this.isPlayed=!1}return(0,r.default)(e,[{key:"append",value:function(e){if(e.isFastAccessPacket&&(this.isFastAccess=!0),0===this.packets.length)this.uid=e.uid,this.key=e.lastKeyFrame,this.frameType=e.frameType,this.allframeType=e.priority,this.pktNum=e.frameNum,this.packets.push(e),this.size+=e.streamData.length;else{if(this.isFull)return!0;for(var t=!0,i=this.packets.length-1;i>=0;i--){if(this.packets[i].seqNum===e.seqNum)return!0;if(this.packets[i].seqNum<e.seqNum){this.packets.splice(i+1,0,e),this.size+=e.streamData.length,t=!1;break}}t&&(this.packets.splice(0,0,e),this.size+=e.streamData.length)}if(e.isFirstSeq&&(this.firstPktSeq=e.seqNum,this.lastPktSeq=e.seqNum+2*(this.pktNum-1),this.dts=e.getFrameTime(),this.hasFirst=!0),this.isFull){this.recvTs=u.default.TimeUtil.now(),this.streamData=new Uint8Array(this.size);for(var s=0,a=0;a<this.packets.length;a++)try{this.streamData.set(this.packets[a].streamData,s),s+=this.packets[a].streamData.length}catch(e){return u.default.logger.error("VideoFrame.append error, name:"+e.name+" msg:"+e.message),!1}if(s!==this.size)return u.default.logger.error("VideoFrame.Append size error, infact:"+s+" expected:"+this.size+" key:"+this.key+" firstSeq:"+this.firstPktSeq+" lastSeq:"+(this.firstPktSeq+2*this.pktNum)+" num:"+this.pktNum+" len:"+this.packets.length),this.reset(),!1}return!0}},{key:"getLastFrameType",value:function(e){return this.allframeType>>2*e&3}},{key:"getOldestPacket",value:function(){return this.packets[0]}},{key:"getLatestPacket",value:function(){var e=null,t=!0,i=!1,a=void 0;try{for(var r,n=(0,s.default)(this.packets);!(t=(r=n.next()).done);t=!0){var u=r.value;(null===e||u.recvOsTime>e.recvOsTime)&&(e=u)}}catch(e){i=!0,a=e}finally{try{!t&&n.return&&n.return()}finally{if(i)throw a}}return e}},{key:"getFirstNotRecvSeq",value:function(){if(!this.hasFirst)return u.default.logger.log("VideoFrame.getFirstNotRecvSeq error, firstPktSeq not recv"),u.default.Utils.UintMax;if(this.isFull)return u.default.logger.log("VideoFrame.getFirstNotRecvSeq error, no packet lost"),u.default.Utils.UintMax;if(1===this.packets.length)return this.firstPktSeq+2;for(var e=1;e<this.packets.length;e++){if(this.packets[e].seqNum-this.packets[e-1].seqNum>2)return this.packets[e-1].seqNum+2;if(e===this.packets.length-1)return this.packets[e].seqNum+2}return u.default.logger.log("VideoFrame.getFirstNotRecvSeq error, code error"),u.default.Utils.UintMax}},{key:"reset",value:function(){this.uid=0,this.key=null,this.isFastAccess=!1,this.hasFirst=null,this.pktNum=null,this.firstPktSeq=null,this.lastPktSeq=null,this.dts=null,this.recvTs=null,this.size=0,this.packets=[],this.frameType=-1,this.allframeType=null,this.isPlayed=!1}},{key:"isFull",get:function(){return this.packets.length===this.pktNum}},{key:"isKeyFrame",get:function(){return this.frameType===n.default.FRAMETYPE_VIDEO_I}},{key:"isPFrame",get:function(){return this.frameType===n.default.FRAMETYPE_VIDEO_P}},{key:"isBFrame",get:function(){return this.frameType===n.default.FRAMETYPE_VIDEO_B}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(0)),a=o(i(1)),r=o(i(11)),n=o(i(204)),u=o(i(2));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){(0,s.default)(this,e),this.player=t,this.recvVideoFrameCnt=0,this.recvVideoPktCnt=0,this.recvVideoByteCnt=0,this.playVideoFrameCnt=0,this.skipVideoFrameCnt=0,this.skipVideoPauseTime=0,this.skipVideoPauseCnt=0,this.videoRecvDelaySum=0,this.videoRecvDelayCnt=0,this.videoCapDelaySum=0,this.videoCapDelayCnt=0,this.pauseVideoTime=0,this.pauseVideoCnt=0,this.sensePauseCnt=0,this.sensePauseTime=0,this.pauseReason=0,this.videoResendSendCnt=0,this.videoResendRecvCnt=0,this.videoResendRepeatCnt=0,this.videoResendServerLostCnt=0,this.videoResendNotRecvCnt=0,this.videoResendNotSendCnt=0,this.videoResendTooOldCnt=0,this.videoResendUrgentSend=0,this.videoResendLargeDelay=0,this.videoResendFailedAck=0,this.videoResendPacketsInAll=0,this.skipVideoPauseTime5=0,this.skipVideoPauseCnt5=0,this.pauseVideoTime5=0,this.pauseVideoCnt5=0,this.sensePauseCnt5=0,this.sensePauseTime5=0,this.playVideoFrameCnt5=0,this.lastPlayVideoTs=0,this.lastPlayVideoOsTs=0}return(0,a.default)(e,[{key:"reset",value:function(e){this.recvVideoFrameCnt=0,this.recvVideoPktCnt=0,this.recvVideoByteCnt=0,this.playVideoFrameCnt=0,this.skipVideoFrameCnt=0,this.skipVideoPauseTime=0,this.skipVideoPauseCnt=0,this.videoRecvDelaySum=0,this.videoRecvDelayCnt=0,this.videoCapDelaySum=0,this.videoCapDelayCnt=0,this.pauseVideoTime=0,this.pauseVideoCnt=0,this.sensePauseCnt=0,this.sensePauseTime=0,this.pauseReason=0,this.videoResendSendCnt=0,this.videoResendRecvCnt=0,this.videoResendRepeatCnt=0,this.videoResendServerLostCnt=0,this.videoResendNotRecvCnt=0,this.videoResendNotSendCnt=0,this.videoResendTooOldCnt=0,this.videoResendUrgentSend=0,this.videoResendLargeDelay=0,this.videoResendFailedAck=0,this.videoResendPacketsInAll=0,e&&(this.skipVideoPauseTime5=0,this.skipVideoPauseCnt5=0,this.pauseVideoTime5=0,this.pauseVideoCnt5=0,this.sensePauseCnt5=0,this.sensePauseTime5=0,this.playVideoFrameCnt5=0),this.lastPlayVideoTs=0,this.lastPlayVideoOsTs=0}},{key:"onVideoStat",value:function(e,t){var i=this.player.pauseStartTs;if(i){var s=u.default.TimeUtil.now(),a=s-i;a>200&&(u.default.logger.warn("VideoPlayStat.onVideoStat pauseTime="+a+" start="+i+" now="+s),this.sensePauseTime+=a,this.sensePauseCnt++,this.sensePauseTime5+=a,this.sensePauseCnt5++,this.player.pauseStartTs=s)}var r=this.player.uid,n=this.onResendStat();u.default.logger.log("VIDEO_RESEND uid="+r+" "+n);var o=this.player.msePlayer,l=this.player.videoChain.size,d=this.onStat(e,t);u.default.logger.log("VIDEO_PLAY uid="+r+" playTime="+o.getCurrentTime()+" bufLen="+o.getBufferLen()+"-"+o.getParserBufLen()+" qsz="+l+d)}},{key:"onResendStat",value:function(){var e="";return e+="inAll="+this.videoResendPacketsInAll+" send="+this.videoResendSendCnt+" recv="+this.videoResendRecvCnt+" repeat="+this.videoResendRepeatCnt+(this.videoResendServerLostCnt?" serverLost="+this.videoResendServerLostCnt:"")+(this.videoResendNotRecvCnt?" notRecv="+this.videoResendNotRecvCnt:"")+(this.videoResendNotSendCnt?" notSend="+this.videoResendNotSendCnt:"")+(this.videoResendTooOldCnt?" tooOld="+this.videoResendTooOldCnt:"")+(this.videoResendUrgentSend?" urgent="+this.videoResendUrgentSend:"")+(this.videoResendLargeDelay?" largeDelay="+this.videoResendLargeDelay:"")+(this.videoResendFailedAck?" failedAck="+this.videoResendFailedAck:"")}},{key:"onStat",value:function(e,t){var i="",s=this.videoRecvDelayCnt?this.videoRecvDelaySum/this.videoRecvDelayCnt:0,a=this.videoCapDelayCnt?this.videoCapDelaySum/this.videoCapDelayCnt:0;return i+=" jitter="+(s=Math.round(s))+"-"+(a=Math.round(a))+" recv="+this.recvVideoByteCnt+"-"+this.recvVideoPktCnt+"-"+this.recvVideoFrameCnt+" play="+this.playVideoFrameCnt+(this.pauseVideoCnt?" pause="+this.pauseVideoTime+"-"+this.pauseVideoCnt:"")+(e&&this.pauseVideoCnt5?" pause5="+this.pauseVideoTime5+"-"+this.pauseVideoCnt5:"")+(this.skipVideoFrameCnt||this.skipVideoPauseTime?" skip="+this.skipVideoFrameCnt+"-"+this.skipVideoPauseTime+"-"+this.skipVideoPauseCnt:"")+(e&&this.skipVideoPauseTime5?" skip5="+this.skipVideoPauseTime5+"-"+this.skipVideoPauseCnt5:"")+(this.sensePauseCnt?" sense="+this.sensePauseTime+"-"+this.sensePauseCnt:"")+(e&&this.sensePauseCnt5?" sense5="+this.sensePauseTime5+"-"+this.sensePauseCnt5:""),this.reset(e||0===t),i}},{key:"onPlayStat",value:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=u.default.TimeUtil.now(),o=this.player.getPlayTime(),l=this.player.lastPlayTs;if(this.playVideoFrameCnt++,this.playVideoFrameCnt5++,!e.isFastAccess){var d=this.player.calcRecvToPlayDelay(r,e.recvTs);d>0&&d<25e3&&e.dts>l&&(this.videoRecvDelaySum+=d,this.videoRecvDelayCnt++);var h=this.player.calcCapToPlayDelay(r,e.dts);h>0&&h<25e3&&e.dts>l&&(this.videoCapDelaySum+=h,this.videoCapDelayCnt++)}var f=0;if(e.dts<=l&&0!==this.lastPlayVideoOsTs&&e.dts-this.player.firstTs<o){var c=e.dts-this.lastPlayVideoTs,p=t-this.lastPlayVideoOsTs;(f=p>c?p-c:0)<=200?f=0:(this.pauseVideoTime+=f,this.pauseVideoCnt++,this.pauseVideoTime5+=f,this.pauseVideoCnt5++)}var v=0;if(a>0&&0!==this.lastPlayVideoTs&&((v=e.dts-this.lastPlayVideoTs)<=200?v=0:(this.skipVideoPauseTime+=v,this.skipVideoPauseCnt++,this.skipVideoPauseTime5+=v,this.skipVideoPauseCnt5++)),(f>0||v>0)&&this.pauseReason===n.default.VPR_NORMAL){var y=this.getVideoPauseReason(a,e,s,i);n.default.isValid(y)?this.pauseReason=y:(u.default.logger.error("VideoPlayStat.onPlayStat invalid pause reson:"+y),this.pauseReason=n.default.VPR_UNKNOWN)}this.lastPlayVideoTs=e.dts,this.lastPlayVideoOsTs=t}},{key:"getVideoPauseReason",value:function(e,t,i,s){if(r.default.videoLink.getVideoConnectedDuration()<1e4)return n.default.VPR_LINKCLOSEDRECENTLY;if(r.default.downlinkRTOCalculator.GetSmoothRtt()>=2e3)return n.default.VPR_LARGERTT;if(e<=0)return this.judgeLateReason(t);var a=0;if(null===i)return n.default.VPR_UNKNOWN;for(var o=i.prev,l=null;;){if(null===o||o===i){o=null;break}if((l=o.data).key===s+1)break;o=o.prev}var d=this.player.lastPlayVideoSeq;if(null===o)a=d+2;else{if(l.isFull)return u.default.logger.error("VideoPlayStat.getVideoPauseReason error, earliestFrame.isFull === true"),n.default.VPR_UNKNOWN;if(l.hasFirst){if(a=l.getFirstNotRecvSeq(),u.default.Utils.isUintMax(a))return u.default.logger.error("VideoPlayStat.getVideoPauseReason error, destinationSeq error"),n.default.VPR_UNKNOWN}else a=d+2}return this.judgeNotRecvReason(a)}},{key:"judgeLateReason",value:function(e){var t=e.getLatestPacket();return t.isDownlinkResend?n.default.VPR_RESENDRECVLATE:t.isUplinkResend?n.default.VPR_UPLINKRESENDLATE:0!==t.peerUid?n.default.VPR_P2PLATE:n.default.VPR_DOWNLINKLATE}},{key:"judgeNotRecvReason",value:function(e){var t=this.player.videoResender.seqStatus;return t.IsServerLost(e)?n.default.VPR_SERVERLOST:t.IsServerRejected(e)?n.default.VPR_SERVERREJECT:t.IsResendSended(e)?n.default.VPR_RESENDNOTRECV:n.default.VPR_NOTRESEND}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={VPR_NORMAL:0,VPR_SERVERLOST:1,VPR_SERVERREJECT:2,VPR_NOTRESEND:3,VPR_RESENDNOTRECV:4,VPR_DOWNLINKLATE:5,VPR_UPLINKRESENDLATE:6,VPR_RESENDRECVLATE:7,VPR_P2PLATE:8,VPR_LINKCLOSEDRECENTLY:9,VPR_LARGERTT:10,VPR_UNKNOWN:100,isValid:function(e){return e>=0&&e<=10||100===e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l(i(5)),a=l(i(0)),r=l(i(1)),n=l(i(11)),u=l(i(113)),o=l(i(2));function l(e){return e&&e.__esModule?e:{default:e}}var d=window.AudioContext||window.webkitAudioContext,h=null,f=function(){function e(t,i){(0,a.default)(this,e),this.hyPlayer=t,this.huyaMgr=i,this.voiceMap=new s.default,this.posMap={},this.masterUid=0,this.masterSpeak=!1,this.masterStreamName=null,this.hyPlayer.on(o.default.Event.UPDATE_INTERSITY,this.setSoundIntensity.bind(this))}return(0,r.default)(e,[{key:"reset",value:function(){o.default.logger.log("LiveMeetingMgr.reset"),this.huyaMgr.stop(),this.voiceMap.clear(),this.posMap={},this.masterUid=0,this.masterSpeak=!1,this.masterStreamName=null}},{key:"start",value:function(e,t,i){o.default.logger.log("LiveMeetingMgr.start",e,t,i),n.default.isLiveMeeting=!0,n.default.presenterUid=e||0,n.default.sid=t||0,n.default.subSid=i||0,n.default.audioMgr=new u.default(this.hyPlayer,this.huyaMgr)}},{key:"stop",value:function(){o.default.logger.log("LiveMeetingMgr.stop"),this.reset()}},{key:"setMeetingStat",value:function(e){var t=this;if(!(this.lastLiveMeetingVer&&this.lastLiveMeetingVer>e.iVersion))if(this.lastLiveMeetingVer=e.iVersion,1==e.tStat.iState){var i=this.masterSpeak,s=this.masterStreamName;this.masterUid=e.tStat.lPresenterUid,this.masterSpeak=0==e.tStat.iSilence,this.masterStreamName=e.tStat.mpContext.get("stream_name"),this.posMap[this.masterUid]=0,this.masterStreamName==s?this.masterSpeak!=i&&(this.masterSpeak?n.default.audioMgr.startVoice({streamName:this.masterStreamName,subSid:n.default.subSid,presenterUid:this.masterUid}):n.default.audioMgr.stopVoice(s)):(s&&n.default.audioMgr.stopVoice(s),this.masterSpeak&&n.default.audioMgr.startVoice({streamName:this.masterStreamName,subSid:n.default.subSid,presenterUid:this.masterUid})),e.vSeats.value.forEach((function(e){t.posMap[e.lUid]=e.iPos;var i=t.voiceMap.get(e.iPos),s=!1,a=null;i&&(s=i.iMute+i.iSilence==0,a=i.mpContext.get("stream_name"));var r=e.mpContext.get("stream_name");if(r){t.voiceMap.set(e.iPos,e);var u=e.iMute+e.iSilence==0;r==a?u!=s&&(u?n.default.audioMgr.startVoice({streamName:r,subSid:n.default.subSid,presenterUid:e.lUid}):n.default.audioMgr.stopVoice(a)):(a&&n.default.audioMgr.stopVoice(a),u&&n.default.audioMgr.startVoice({streamName:r,subSid:n.default.subSid,presenterUid:e.lUid}))}else a&&n.default.audioMgr.stopVoice(a),t.voiceMap.delete(e.iPos)}))}else this.reset()}},{key:"setSoundIntensity",value:function(e,t){var i="";if(t.intensity&&parseInt(t.intensity)>10){var s=this.posMap[t.uid];i="@@@@@@@ speaking intensity="+t.intensity+" uid="+t.uid,this.hyPlayer.trigger(o.default.Event.AUDIO_SOUND,{uid:t.uid,pos:s})}else i="@@@@@@@ speaking sound small intensity="+t.intensity+" uid="+t.uid;1===Number(localStorage._printScriptVoice)&&o.default.logger.debug(i)}},{key:"detectSound",value:function(e){var t=this;this._detectSound(e,(function(e){var i=e.uid,s=t.posMap[i];t.hyPlayer.trigger(o.default.Event.AUDIO_SOUND,{uid:i,pos:s})}))}},{key:"_detectSound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-55;h||(h=new d);var a=h.createAnalyser(),r=h.createMediaElementSource(e);r.connect(a),a.connect(h.destination),a.minDecibels=s,a.fftSize=128;var n=new Uint8Array(a.frequencyBinCount),u=performance.now(),o=function s(r){!e||e.error||e.paused||requestAnimationFrame(s),r-u>i&&(u=r,a.getByteFrequencyData(n),n.some((function(e){return e}))&&t(e))};o(u)}}]),e}();t.default=f},function(e,t,i){e.exports={default:i(207),__esModule:!0}},function(e,t,i){i(208),e.exports=i(6).Object.keys},function(e,t,i){var s=i(22),a=i(24);i(88)("keys",(function(){return function(e){return a(s(e))}}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=p(i(5)),a=p(i(0)),r=p(i(1)),n=p(i(11)),u=p(i(37)),o=p(i(62)),l=p(i(3)),d=p(i(26)),h=p(i(40)),f=p(i(41)),c=p(i(2));function p(e){return e&&e.__esModule?e:{default:e}}var v=0,y=function(){function e(t){(0,a.default)(this,e),this.voiceInfo=t,this.presenterUid=t.presenterUid,this._num_=++v,this.uid=0,this.link=new c.default.ProtoLink(this,!0,100),this.printProtocol=!!Number(localStorage._printProtocol),this.started=!1,this.proxys=null,this.streamIds=[],this.tokens=new s.default,this.connectedTime=0,this.lastGetProxyTime=0,this.pingCnt=0,this.wsUrl="",this.sslUrl=""}return(0,r.default)(e,[{key:"destroy",value:function(){c.default.logger.log("AudioLink.destroy",this.presenterUid),this.close(),this.link&&this.link.destroy(),this.link=null,this.voiceInfo=null}},{key:"close",value:function(){this.started&&(c.default.logger.info("AudioLink.close",this.presenterUid),this.started=!1,this.reset(),c.default.Timer.remove(this.onCheckTimer,this))}},{key:"reset",value:function(){c.default.logger.log("AudioLink.reset",this.presenterUid),this.vps=null,this.link.destroy(),this.link=new c.default.ProtoLink(this,!0,100),this.lastGetProxyTime=0,this.pingCnt=0,this.proxys=null,this.streamIds=[],this.tokens.clear(),this.connectedTime=0}},{key:"connect",value:function(e){this.vps=e,this.sslUrl=e.sslUrl||"",c.default.logger.log("AudioLink sslUrl="+this.sslUrl);var t=[];if(e.allocatedStreams.forEach((function(e,i){t=t.concat(e)})),0!==t.length){this.lastGetProxyTime=c.default.TimeUtil.now()-3e3,this.link.destroy(),this.link=new c.default.ProtoLink(this,!0,100);var i=this.tokens;i.clear();var s=[],a=null;if(t.forEach((function(e){var t=e.streamId,r=t.streamType,n=t.codecType;r+=r<10?"\t\t":"\t",n+=n<10?"\t\t":"\t",c.default.logger.info("sg --- streamType="+r+"codecType="+n+"startTs="+t.startTs,t.isVideoStream?"drop":""),t.isVideoStream||(s.push(t),i.set(t,e.token),!a&&e&&(a=e.videoProxyInfos.slice()))})),!a||0!=a.length)return this.streamIds=s,this.proxys=a,this.started=!0,this.pingCnt=0,this.reconnect(),c.default.Timer.add(this.onCheckTimer,this,1e3),this.wsUrl.replace(/ws+?:\/\//g,"");c.default.logger.warn("AudioLink.connect NO STREAM!")}else c.default.logger.warn("AudioLink.connect proxys is empty")}},{key:"reconnect",value:function(){if(this.started)if(this.proxys&&0!=this.proxys.length){var e=this.proxys.shift();this.isWss(e)?this.connectWss(e):this.connectWs(e)}else this.getProxy()}},{key:"isWss",value:function(e){return!localStorage._audioWs&&(!(!this.sslUrl||!e.videoProxyInfo.has(8))&&e.videoProxyInfo.get(8)>0)}},{key:"connectWs",value:function(e){var t=Math.floor(Math.random()*e.tcpPorts.length),i=t;if(465===e.tcpPorts[t]&&(++t>=e.tcpPorts.length&&(t=0),t===i))return c.default.logger.warn("AudioLink.connect has no correct ports"),void this.reconnect();this.wsUrl="ws://"+e.ip+":"+e.tcpPorts[t],c.default.logger.info("%cconnecting audio "+this.wsUrl,m("#0000E3"),this.presenterUid),localStorage._setWssUrl?this.link.connect(localStorage._setWssUrl):this.link.connect(this.wsUrl)}},{key:"connectWss",value:function(e){var t=e.videoProxyInfo.get(8),i=[t>>16,65535&t],s=i[Math.floor(Math.random()*i.length)];this.wsUrl="wss://"+c.default.Utils.ip2uint(e.ip)+this.sslUrl+":"+s,c.default.logger.info("%cconnecting audio "+this.wsUrl,m("#0000E3"),this.presenterUid),localStorage._setWssUrl?this.link.connect(localStorage._setWssUrl):this.link.connect(this.wsUrl)}},{key:"send",value:function(e){if(!e||!this.connected)return!1;var t=e.constructor.name;return this.printProtocol&&!g[t]&&c.default.logger.debug("%c>>>>> "+t,m("#F101AC"),e),"Uint8Array"!=t&&(e=e.marshall()),this.link.send(e),!0}},{key:"getProxy",value:function(){var e=c.default.TimeUtil.now();e-this.lastGetProxyTime<4e3||(c.default.logger.log("AudioLink.getProxy lastGetProxyTime="+this.lastGetProxyTime+" now="+e),this.reset(),this.lastGetProxyTime=e,n.default.audioMgr.startVoice(this.voiceInfo))}},{key:"onopen",value:function(){c.default.logger.log("AudioLink.onopen",this.presenterUid);var e=c.default.TimeUtil.now();this.connectedTime=e,n.default.addListener(l.default.PLoginVideoProxyUniformlyRes,this.onLoginVideoProxy,this),n.default.addListener(l.default.PVideoProxyPingRes4,this.onVideoProxyPingRes,this),this.login()}},{key:"onclose",value:function(){c.default.logger.log("%cAudioLink.onclose","color:white;background:black;",this.presenterUid),this.connectedTime=0,this.reconnect()}},{key:"onerror",value:function(e){c.default.logger.warn("AudioLink.onerror",this.presenterUid,e),this.reconnect()}},{key:"onData",value:function(e,t){var s=new o.default(t),a=l.default[e];if(!a)throw new Error("[x] Unmatched uri, uri="+(s.uri>>8)+" resCode="+s.resCode+" len="+s.len);var r=s,u=null;try{u=i(95)("./"+a).default}catch(t){c.default.logger.warn("%c[x] Unmatched protocol "+(e>>8)+" "+a,"color:red;background:#FFF0F0")}u&&(null==(r=new u).unmarshall?c.default.logger.error("[x]"+a+".unmarshall undefined!"):r.unmarshall(s)),Number(localStorage._printAudioPkg)&&e==l.default.PStreamData3&&c.default.logger.debug(this._num_,"-----------",r),this.printProtocol&&!g[a]&&c.default.logger.debug("%c<<<<< "+a,m("#6F00D2"),r),r._isFromVoice=!0,n.default._onYYData(e,r)}},{key:"onCheckTimer",value:function(e,t){this.started&&(this.onPingTimer(e,t),this.onCheckConnect(e,t))}},{key:"onPingTimer",value:function(e,t){if(this.link.connected&&t%3==0){if(this.pingCnt>=4)return c.default.logger.warn("AudioLink.onPingTimer ping time out",this.presenterUid),void this.reconnect();this.pingCnt++;var i=new f.default;i.uid=this.uid,i.stampc=e,i.loginStamp=0,i.uplinkBw=0,i.availPeers=0,i.bPunched=!1,i.tcpEstableIds=0,i.tcpId=0,i.vipUser=0,i.vipProxy=0,this.send(i)}}},{key:"onCheckConnect",value:function(e){this.connected||this.reconnect()}},{key:"login",value:function(){var e=new h.default;e.version=1,e.uid=this.uid,e.streamGroupIds=this.streamIds,e.clientAppid=301,e.clientType=1,e.loginStamp=c.default.TimeUtil.now(),e.videoGroupId=this.vps.videoGroupId,e.tcpId=0,e.commandType=1,e.fastAccessInterval=n.default.getConfig(u.default.VIDEO_JIT_BUFLEN),e.fastAccessInterval>0&&e.fastAccessInterval<2e3&&(e.fastAccessInterval=2e3),e.cookie="",e.localIps=[],e.localPort=0,e.sdkVersion=1,e.token="",e.tokenVersion=this.vps.tokenVersion,e.tokens=this.tokens,e.audioCodecType=[d.default.AUDIO_AACPLUS],e.serviceType=this.voiceInfo.serviceType,e.loginSeq=0,c.default.logger.log("AudioLink.login: send PLoginVideoProxyUniformly",this.uid,e),this.send(e)}},{key:"onLoginVideoProxy",value:function(e){e.reject>0&&c.default.logger.warn("AudioLink.onLoginVideoProxy reject="+e.reject)}},{key:"onVideoProxyPingRes",value:function(e){this.pingCnt=0}},{key:"connected",get:function(){return this.link&&this.link.connected}}]),e}();function m(e){return"color:"+e+";font-weight:900"}t.default=y;var g={PStreamData3:1,PVideoProxyPing3:1,PVideoProxyPingRes4:1,PNotifyCurrentStream4:1,PP2pVideoPing3:1,PNotifyUplinkRecvCount3:1,PVideoSyncSpeakerTime3:1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(i(44)),a=o(i(0)),r=o(i(1)),n=o(i(11)),u=o(i(2));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t,i){(0,a.default)(this,e),this.hyPlayer=t,this.huyaMgr=i,this.info=null,this.addListener()}return(0,r.default)(e,[{key:"addListener",value:function(){u.default.TafLink.addListener("8102",this._livingStreamInfoNotice.bind(this)),u.default.TafLink.addListener("8103",this._livingStreamEndNotice.bind(this)),u.default.TafLink.addListener("getLivingStreamInfo",this._onGetLivingStreamInfo.bind(this)),u.default.TafLink.addListener(u.default.TafLink.WEBSOCKET_CONNECTED,this.onWebsocketConnected.bind(this))}},{key:"onWebsocketConnected",value:function(){n.default.proxyLink.connected&&this.info&&(this.getLivingStreamInfo(this.info),this.info=null)}},{key:"getLivingStreamInfo",value:function(e){if((0,s.default)(n.default,e),n.default.proxyLink.connected){var t=e.sid,i=e.subSid||e.subsid,a=e.presenterUid||e.pid,r=new u.default.HUYA.GetLivingStreamInfoReq;r.tId=n.default.proxyLink.getUserId(),0==r.tId.lUid&&(r.tId.lUid=n.default.getUid()),a?r.lPresenterUid=Number(a):(r.lTopSid=Number(t),r.lSubSid=Number(i)),n.default.sendWup("liveui","getLivingStreamInfo",r,null,!0,-1,!0)}else this.info=e}},{key:"_onGetLivingStreamInfo",value:function(e){e&&e.bIsLiving?this._livingStreamInfoNotice(e.tNotice):u.default.logger.log("GetLivingStreamInfoReq xxxxxxx no living")}},{key:"_livingStreamInfoNotice",value:function(e){var t=!1,i=e.mStreamInfo.value;for(var s in i){var a=i[s],r=a.iLiveScenarioType;if(1==r){var o=0;1==r?o=5:3==r&&(o=6);var l=a.vStreamInfo.value;for(var d in l){var h={serviceType:o},f=l[d];4==f.iLineIndex&&f.lPresenterUid!=e.lPresenterUid&&(h.streamName=f.sStreamName,h.presenterUid=f.lPresenterUid,h.subSid=f.lSubChannelId,n.default.audioMgr&&n.default.audioMgr.startVoice&&n.default.audioMgr.startVoice(h),t=!0)}}}0==t&&u.default.logger.info("No pure audio stream.")}},{key:"_livingStreamEndNotice",value:function(e){n.default.audioMgr.stopVoice(e.sStreamName)}}]),e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(i(82)),a=u(i(0)),r=u(i(1)),n=u(i(2));function u(e){return e&&e.__esModule?e:{default:e}}var o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},l=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||function(e){window.clearTimeout(e)},d=function(){function e(t,i){(0,a.default)(this,e),this.handler=t,this.stat=i,this.canvas=null,this.context=null,this.imgData=null,this.pixelateDatas=[],this.scaleW=1,this.scaleH=1,this.posY=0,this.posX=0,this.enableAiMosaic=0,this.requestAnimId=0,this.started=!1,this._startRenderBind=this._startRender.bind(this)}return(0,r.default)(e,[{key:"_initContext",value:function(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.viewElm.appendChild(this.canvas),this._resizeCanvas(),this.viewElm.appendChild(this.canvas)}},{key:"_removeContext",value:function(){n.default.logger.log("remove video plixelate"),this._clearCanvas(),l(this.requestAnimId),this.requestAnimId=0,this.started=!1,this.pixelateDatas=[],this.scaleW=1,this.scaleH=1,this.posY=0,this.posX=0,this.canvas&&this.viewElm&&this.viewElm.removeChild(this.canvas),this.context=null,this.canvas=null}},{key:"_clearCanvas",value:function(){this.context&&this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight)}},{key:"_resizeCanvas",value:function(){if(this.canvas){this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight;var e=this.mse.width,t=this.mse.height,i=this.canvasWidth,s=this.canvasHeight,a=s,r=i,n=0,u=0;e/t>i/s?(r=i,u=(s-(a=t*i/e))/2):(a=s,n=(i-(r=e*s/t))/2),this.posY=u,this.posX=n,this.scaleW=e/r,this.scaleH=t/a}}},{key:"_getVideoImgData",value:function(e){if(!this.context)return[];var t=1*e.x,i=1*e.y,s=1*e.w,a=1*e.h,r=parseInt(t/this.scaleW+this.posX),u=parseInt(i/this.scaleH+this.posY),o=parseInt(s/this.scaleW),l=parseInt(a/this.scaleH),d=this.mse.video||{},h=[];try{this.context.drawImage(d.video,t,i,s,a,r,u,o,l),h=this.context.getImageData(r,u,o,l).data}catch(e){n.default.logger.error("get mosaic image error: ",e)}return h}},{key:"_render",value:function(e){var t=this;if(this.context){this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight);var i=e.points||[];if(!(i.length<=0)){var s=e.frameHeight,a=e.frameWidth,r=this.mse.width/a,n=this.mse.height/s;i.forEach((function(e){for(var i=e.x*r||0,s=e.y*n||0,a=e.w*r||0,u=e.h*n||0,o=t._getVideoImgData({x:i,y:s,w:a,h:u}),l=parseInt(a/t.scaleW),d=parseInt(u/t.scaleH),h=parseInt(i/t.scaleW+t.posX),f=parseInt(s/t.scaleH+t.posY),c=l/16+1,p=d/16+1,v=0;v<p;v++)for(var y=16*v,m=Math.max(Math.min(y,d-1),0),g=0;g<c;g++){var _=16*g,S=4*(Math.max(Math.min(_,l-1),0)+m*l),P=o[S+0],T=o[S+1],k=o[S+2],I=o[S+3]/255*1;t.context.fillStyle="rgba("+P+","+T+","+k+","+I+")",t.context.fillRect(h+_-8,f+y-8,16,16)}}))}}}},{key:"_getPixelateData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};t.beginDts=e.beginDts,t.endDts=e.endDts,t.dtsType=e.dtsType;var i=0;if(i=0===t.dtsType?this.handler.getCurrentSeiDts():(t.dtsType,this.handler.getCurrentTime()),-1===Number(localStorage._printPixelateDts)&&n.default.logger.log("%cCurDts:%d BeginDts:%d, EndDts:%d, DtsType: %d","color:green",i,t.beginDts,t.endDts,t.dtsType),this._pixelateStat({curDts:i,beginDts:e.beginDts,endDts:e.endDts,dtsType:e.dtsType,pixelateKey:e.pixelateKey}),!(i>t.endDts)){var s=e.shapeInfos||{};t.frameHeight=s.frame_height,t.frameWidth=s.frame_width;var a=s.contrs||{},r=a.value||[],u=[];r.forEach((function(e){e=e||{},u.push(e)})),t.points=u,this.pixelateDatas.push(t)}}},{key:"_start",value:function(){this.started||this.pixelateDatas.length<=0||this.requestAnimId>0||(this.started=!0,this.requestAnimId=o(this._startRenderBind))}},{key:"_startRender",value:function(){var e=this;if(this.pixelateDatas.length<=0)return l(this.requestAnimId),this.requestAnimId=0,this.started=!1,void this._clearCanvas();var t=null;this.pixelateDatas.some((function(i){var s=(i=i||{}).dtsType,a=i.beginDts,r=i.endDts,u=0;if(u=0===s?e.handler.getCurrentSeiDts():e.handler.getCurrentTime(),-1===Number(localStorage._printCurDts)&&n.default.logger.log("curDts:%d beginDts:%d, endDts:%d",u,a,r),u>r)e.pixelateDatas.shift();else if(u>=a&&u<=r)return t=i,!0;return!1})),-1===Number(localStorage._printPixelate)&&n.default.logger.log("current pixlates: ",this.pixelateDatas),t&&t.points&&(-1===Number(localStorage._printCurPoint)&&n.default.logger.log("current pixlate info: ",(0,s.default)(t)),this._render(t)),o(this._startRenderBind)}},{key:"_pixelateStat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.beginDts,i=e.endDts,s=e.curDts,a=e.dtsType,r=e.pixelateKey,u=1;u=s<=t?0:s>t&&s<=i?2:1;var o="video_pixelate",l=[this.stat.createAct(n.default.StatCfg.ACT.MOSAIC_STATUS,{value:[u,a,s],str:[r,o]})];this.handler.trigger(n.default.Event.DATA_METRIC2,l)}},{key:"pushVideoPixlateInfo",value:function(e){this.enableAiMosaic<=0||(-1===Number(localStorage._printPixlateInfo)&&n.default.logger.log("pixlate info: ",e),this.canvas&&this.context&&(e=e||{},this._getPixelateData(e),this._start()))}},{key:"containerResize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.width,s=t.height;i===this.canvasWidth&&s===this.canvasHeight||o((function(){var t=e.viewElm?e.viewElm.clientWidth:960,a=e.viewElm?e.viewElm.clientHeight:540;e.canvasWidth=i||t,e.canvasHeight=s||a,e._resizeCanvas(),e._startRender()}))}},{key:"setVideoPixelateBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.canvas&&this.destory(),this.enableAiMosaic<=0?n.default.logger.log("Video plixelate enableAiMosaic="+this.enableAiMosaic+", mosaic is closed"):(this.viewElm=e.viewElm,this.mse=e.mse,this.viewElm?(this.canvasWidth=this.viewElm.clientWidth||960,this.canvasHeight=this.viewElm.clientHeight||540,this._initContext()):n.default.logger.error("Video plixelate box is null"))}},{key:"setEnablePixelate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.handler.config||{},i=e.presenterUid;t.getEnableAiMosaic&&(this.enableAiMosaic=t.getEnableAiMosaic(i)),n.default.logger.log("Video plixelate enableAiMosaic: ",this.enableAiMosaic)}},{key:"destory",value:function(){this._removeContext()}}]),e}();t.default=d}]);