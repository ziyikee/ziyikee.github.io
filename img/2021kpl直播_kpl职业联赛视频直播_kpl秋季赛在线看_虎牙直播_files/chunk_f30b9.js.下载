(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[125],{162:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(12),i=(0,s.__importDefault)(n(19)),o=[".msstatic.com",".yaoguo.com",".huya.com"];var r=function(e){function t(t){void 0===t&&(t=!0);var n=e.call(this)||this;return n.connected=!1,n.serverListeners={},n.serverListenerId=0,n.handle=n.handle.bind(n),!1!==t&&n.connect(),n}return(0,s.__extends)(t,e),t.prototype.connect=function(){this.connected||(this.connected=!0,window.addEventListener("message",this.handle,!1),this.emit("connect"))},t.prototype.close=function(){this.connected&&(this.connected=!1,window.removeEventListener("message",this.handle,!1),this.emit("close"))},t.prototype.destroy=function(){this.close(),this.serverListeners={},this.emit("destroy"),this.removeAllListeners()},t.prototype.handle=function(e){var t=e.origin,n=e.data,s=null;if(function(e){return o.some((function(t){return new RegExp(t.replace(".","\\.")+"$").test(e)}))}(t)){if(n&&"string"==typeof n)try{s=JSON.parse(n)}catch(e){}s&&s.code&&"string"==typeof s.code&&this.emit(s.code,s.data,e)}},t.prototype.listen=function(e,t){var n=this;if(e&&"string"==typeof e&&"function"==typeof t){var s=e.split("/"),i=s[0],o=s[1],r=function(s,r){Promise.resolve(t(s,r)).then((function(e){r.source.postMessage(JSON.stringify({code:o||i,data:e}),"*")})).catch((function(t){n.emit("error",e,t)}))};this.serverListeners["listener-"+this.serverListenerId++]={event:e,listener:r,callback:t},this.on(i,r)}},t.prototype.unlisten=function(e,t){var n=this;e&&"string"==typeof e&&"function"==typeof t&&Object.keys(this.serverListeners).forEach((function(s){var i=n.serverListeners[s];if(i&&i.event===e&&i.callback===t){var o=e.split("/"),r=o[0];o[1];n.off(r,i.listener),delete n.serverListeners[s]}}))},t}(i.default);t.default=r}}]);