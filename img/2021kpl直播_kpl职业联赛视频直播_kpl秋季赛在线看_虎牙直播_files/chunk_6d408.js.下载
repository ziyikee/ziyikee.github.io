(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[386],{106:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mount=void 0;var a=n(12),r=(0,a.__importStar)(n(28)),u=(0,a.__importDefault)(n(42)),i=n(4),o=(0,a.__importDefault)(n(960)),l=(0,a.__importDefault)(n(416)),f=(0,a.__importDefault)(n(417));function c(){var e=(0,r.useState)((function(){return(0,i.getUid)()})),t=e[0],n=e[1];(0,r.useEffect)((function(){TT.getUserInfo((function(e){var t=e.uid;n(t)}))}),[]);var a=(0,r.useCallback)((function(){TT.login.login()}),[]);return r.default.createElement("div",{className:f.default.app},!!t&&r.default.createElement(o.default,null),!t&&r.default.createElement("div",{className:f.default.loginTips,onClick:a},r.default.createElement("span",null,"登录"),"发弹幕，免费领银豆！"),!t&&r.default.createElement(l.default,{onClick:a,disabled:!0}))}t.mount=function(){var e=document.getElementById("J_RoomChatSpeaker");e&&u.default.render(r.default.createElement(c,null),e)}},416:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),r=n(28),u=(0,a.__importDefault)(n(285));t.default=function(e){var t=e.disabled,n=e.onClick,a=(0,r.useMemo)((function(){return document.getElementById("msg_send_bt")}),[]),i=(0,r.useMemo)((function(){return a.className}),[a]);return(0,r.useEffect)((function(){return a.addEventListener("click",n,!1),function(){a.removeEventListener("click",n,!1)}}),[n,a]),(0,r.useEffect)((function(){a.className=(0,u.default)(i,{"btn-sendMsg-enable":!t})}),[t,i,a]),null}},417:function(e,t,n){var a=n(963);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(287)(a,r);a.locals&&(e.exports=a.locals)},960:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),r=(0,a.__importStar)(n(28)),u=(0,a.__importDefault)(n(2)),i=(0,a.__importDefault)(n(3)),o=(0,a.__importDefault)(n(0)),l=(0,a.__importDefault)(n(326)),f=(0,a.__importStar)(n(414)),c=n(15),s=(0,a.__importDefault)(n(416)),d=(0,a.__importDefault)(n(962)),m=(0,a.__importDefault)(n(417));function p(e,t){var n=0,a="";return t>0&&e.some((function(e){var r=e.type,u=e.content;if(r===f.EditorElementType.Emoticon){var i=l.default.parse(u)[0];if(i&&"string"!=typeof i)a+=u,n+=1;else{var o=u.slice(0,t-n);a+=o,n+=o.length}}else if(r===f.EditorElementType.Text){o=u.slice(0,t-n);a+=o,n+=o.length}if(n===t)return!0})),{text:a,count:n}}t.default=function(){var e=(0,r.useState)(null),t=e[0],n=e[1],l=(0,r.useState)((function(){return p(f.default.elements,30)})),g=l[0],v=l[1],_=(0,r.useState)([-1,-1]),E=_[0],h=_[1],k=(0,r.useCallback)((function(e){f.default.input(e.target.value)}),[]),y=(0,r.useRef)(g.text);y.current=g.text;var x=(0,r.useMemo)((function(){return 0===g.count||g.count>30}),[g]);(0,r.useEffect)((function(){function e(){v(p(f.default.elements,30))}return f.default.on("change",e),f.default.on("selectionchange",h),function(){f.default.off("change",e),f.default.off("selectionchange",h)}}),[]),(0,r.useEffect)((function(){if(t){var e=t;f.default.setInputElement({getSelectionRange:function(){return[e.selectionStart,e.selectionEnd]}})}}),[t]),(0,r.useEffect)((function(){var e=E[0],n=E[1];t&&e>0&&n>0&&t.setSelectionRange(e,n)}),[t,E]);var b=(0,r.useCallback)((function(e){e&&(TT.event.emit("RoomChatSpeakerSend",e),(0,c.reportEvent)((0,a.__assign)({eid:"click/zhibo/sendwords",eid_desc:"点击/直播间/发言按钮",ayyuid:i.default.lp,gameId:u.default.gid},o.default.get("videoData")||{})))}),[]);(0,r.useEffect)((function(){TT.event.on("RoomSendMessageSuccess",(function(){f.default.input("")}))}),[]),(0,r.useEffect)((function(){function e(e){e&&e.param&&e.param.danmutext&&b(""+e.param.danmutext)}return o.default.on("sendDanmuText",e),function(){o.default.off("sendDanmuText",e)}}),[b]);var S=(0,r.useCallback)((function(e){if(!x){b(y.current);try{var t=e.isTrusted,n=e.target||{},a=n.id,r=void 0===a?"":a,u=n.className,i=void 0===u?"":u,o=n.nodeName,l=void 0===o?"":o;window.performanceInfo._hmt.push(["reportApiMess","eventClickSendMsg",JSON.stringify({id:r,className:i,nodeName:l,msg:y.current}),!1===t?200:201])}catch(e){}}}),[x,b]),T=(0,r.useCallback)((function(e){if("Enter"===e.key||13===e.keyCode)if(e.ctrlKey)f.default.insert("\r\n");else{if(e.preventDefault(),x)return;b(y.current);try{window.performanceInfo._hmt.push(["reportApiMess","eventEnterSendMsg",JSON.stringify({id:"pub_msg_input",className:"",nodeName:"TEXTAREA",msg:y.current}),!1===e.isTrusted?200:201])}catch(e){}}else if("Backspace"===e.key||"Delete"===e.key){if((i=(u=e.target).selectionStart)===u.selectionEnd)if((o=f.default.elementOf(i+("Backspace"===e.key?-1:1)))&&o.type!=f.EditorElementType.Text){var t=o.range,n=t[0],a=t[1],r="Backspace"===e.key?"backward":"forward";u.setSelectionRange(n,a,r)}}else if("ArrowLeft"===e.key||"ArrowRight"===e.key){var u,i,o;if((i=(u=e.target).selectionStart)===u.selectionEnd&&!e.shiftKey)if((o=f.default.elementOf(i+("ArrowLeft"===e.key?-1:1)))&&o.type!=f.EditorElementType.Text){e.preventDefault();var l=o.range,c=(n=l[0],a=l[1],"ArrowLeft"===e.key?n:a);u.setSelectionRange(c,c)}}}),[x,b]),C=(0,r.useCallback)((function(e){var t=e.target,n=t.selectionStart;if(n===t.selectionEnd){var a=f.default.elementOf(n);if(a&&a.type!=f.EditorElementType.Text){var r=a.range,u=r[0],i=r[1],o=n-u<(i-u)/2?u:i;t.setSelectionRange(o,o)}}}),[]),M=(0,r.useCallback)((function(e){var t=e.target,n=t.selectionStart,a=t.selectionEnd,r=t.selectionDirection,u="backward"!=r?n:a,i=f.default.elements.find((function(e){var t=e.range,n=t[0],a=t[1];return"backward"!=r?n<=u&&u<a:n<u&&u<=a}));if(i&&i.type!=f.EditorElementType.Text){var o=i.range,l=o[0],c=o[1];t.setSelectionRange(l,c)}}),[]);return r.default.createElement("div",{className:m.default.ChatSpeaker},r.default.createElement("textarea",{ref:n,value:g.text,onChange:k,onKeyDown:T,onFocus:C,onClick:C,onDoubleClick:M,id:"pub_msg_input"}),r.default.createElement(s.default,{onClick:S,disabled:x}),r.default.createElement(d.default,{count:g.count,max:30}))}},962:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),r=n(28),u=(0,a.__importDefault)(n(285));t.default=function(e){var t=e.count,n=e.max,a=(0,r.useMemo)((function(){return document.getElementById("J_chatMsgInputNum")}),[]),i=(0,r.useMemo)((function(){return document.createTextNode(t+"/"+n)}),[t,n]),o=(0,r.useMemo)((function(){return a.className}),[a]);return(0,r.useEffect)((function(){a.childNodes.forEach((function(e){a.removeChild(e)})),a.appendChild(i)}),[i,a]),(0,r.useEffect)((function(){a.className=(0,u.default)(o,{"msg-input-num-full":t===n},{"msg-input-num-out":t>n})}),[t,n,o,a]),null}},963:function(e,t,n){(t=n(286)(!1)).push([e.i,".app--29yU7qb4hvYJlv-APxOBrC{width:100%;height:100%}.loginTips--2jtFp1IH9b7ftunn9tLg2r{width:100%;height:100%;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#909090}.loginTips--2jtFp1IH9b7ftunn9tLg2r span{color:#ff8a00}.ChatSpeaker--2lgjsxdm6dK5MZ-6kVGLtx{height:100%}.ChatSpeaker--2lgjsxdm6dK5MZ-6kVGLtx textarea{width:100%;height:100%;overflow:auto;padding:4px 5px;box-sizing:border-box;line-height:16px;font-size:12px;background:#fff;border:none;outline:none;resize:none}.ChatSpeaker--2lgjsxdm6dK5MZ-6kVGLtx textarea:focus{outline:1px solid #ffab48}\n",""]),t.locals={app:"app--29yU7qb4hvYJlv-APxOBrC",loginTips:"loginTips--2jtFp1IH9b7ftunn9tLg2r",ChatSpeaker:"ChatSpeaker--2lgjsxdm6dK5MZ-6kVGLtx"},e.exports=t}}]);