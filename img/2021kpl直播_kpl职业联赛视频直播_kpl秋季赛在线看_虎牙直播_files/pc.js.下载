/*!
 * @project : diy_h5_comp
 * @version : 1.0.0
 * @author  : 
 * @update  : 2018-10-30 12:41:23 pm
 */"use strict";(function(){var t={currentMatchId:"",mid:1955,payNum:10,isLogin:false,tpl:'<div class="vote-pc-pop"><a class="pop-close"></a><div class="lol-vote-preview hide"><div class="next-title">下一场开始时间</div><div class="next-time" id="bookTime"></div><a class="book" id="book"><i></i>预约</a><div class="intro"><h2><span></span>活动介绍</h2><p>1. 粉丝投票：开赛后，粉丝为喜爱的选手投票。<br>2. 势力等级：英雄联盟赛事侧汇总所有的投票总数，投票总数会体现为选手的势力等级。<br> 3. 等级展示：选手的人气等级会实时展示在赛事直播流中，并根据投票总数的增加动态变化。</p><a href="https://blog.huya.com/news/8243" target="_blank"><img src="//hd.huya.com/20180809lolVote/img/banner.jpg" ></a></div></div><div class="lol-vote-wrap hide"><a href="https://blog.huya.com/news/8243" target="_blank"><img src="//hd.huya.com/20180809lolVote/img/banner.jpg" ></a><div class="lol-vote-title"><span></span>粉丝势力投票<i>每票需消耗100金豆</i></div><div class="lol-vote-tab"><div class="lol-vote-tab-warp"><ul id="vote-tab-list"></ul></div><i class="current-icon"></i></div><div class="lol-vote-cont" id="vote-list"></div><div class="lol-vote-bot"><ul class="info-list"><li><i class="jd-icon"></i><span id="jindou">0</span></li><li><i class="qq"></i><a href="https://activity.huya.com/txmatchvote/index.php?m=AccountLinkApi" target="_blank">绑定</a></li><li><i class="pay"></i><a id="charge">充值</a></li></ul><div class="info-menu"><a id="pay-num"><span>10</span><i></i></a><a id="vote">投票</a></div><div class="pay-list"><div class="pay-num-other"><i></i><input type="text" onkeyup="value=value.replace(/[^\\d]/g,\'\')" placeholder="其他数额"></div><ul><li><span class="pay-num">1314</span>一生一世</li><li><span class="pay-num">520</span>我爱你</li><li><span class="pay-num">188</span>要抱抱</li><li><span class="pay-num">66</span>一切顺利</li><li><span class="pay-num">30</span>想你</li><li><span class="pay-num">10</span>十全十美</li><li><span class="pay-num">1</span>一心一意</li></ul></div></div></div><p class="toast"></p></div>',checkLogin:function t(){var e=this;if(navigator.userAgent.match(/mobile/i)){HUYASdk&&HUYASdk.getCurrentUserInfo({complete:function t(a){e.isLogin=!!a.uid}})}else{e.isLogin=!!document.cookie.match(/; yyuid=/g)}},getUrl:function t(){return"https://"},formatTimeToCommon:function t(a,e){var i=new Date(parseInt(a)*1e3);if(!e||e===1){return i.getMonth()+1+"月"+i.getDate()+"日"}else if(e===2){return i.getMonth()+1+"/"+i.getDate()+" "+i.getHours()+":"+(i.getMinutes()>9?i.getMinutes():"0"+i.getMinutes())}else if(e===3){return i.getHours()+":"+(i.getMinutes()>9?i.getMinutes():"0"+i.getMinutes())}},payListAni:function t(){var a=this;if(navigator.userAgent.match(/mobile/i)){$(".pay-num-other").find("input").attr("type","number")}$(".pay-num-other").find("input").on("keyup",function(){if($(this).val()>9999){a.showToast("投票数最大限制为9999票");return}a.payNum=$(this).val()==""?10:$(this).val();$("#pay-num").find("span").html(a.payNum)});$("#pay-num").off().on("click",function(){if($(".pay-list").hasClass("open")){$(this).find("i").removeClass("close");$(".pay-list").removeClass("open");if($(".pay-num-other").find("input").val()!=""){$(".pay-num-other").find("input").val("")}}else{$(this).find("i").addClass("close");$(".pay-list").addClass("open")}});$(document).mouseup(function(t){var a=$(".pay-list");if(!a.is(t.target)&&a.has(t.target).length===0){$(".pay-list").removeClass("open")}})},getVoteTabList:function t(){var n=this;$.ajax({url:n.getUrl()+"activity.huya.com/txmatchvote/cache.php?m=MatchVoteApi&do=getMatchInfo",data:{mid:n.mid},dataType:"jsonp",cache:true,jsonpCallback:"jsonpgetFansMatchInfo",success:function t(a){if(a.status==200){var e=0,i=a.data.matchinfo,s=[],o=false;if(i&&!!i.length){i=i.reverse();for(e in i){if(i[e].vote_status!=2){s.push("<li data-matchid="+i[e].match_id+" data-votesatus="+i[e].vote_status+">"+i[e].team_info[0].team_des+"<span>vs</span>"+i[e].team_info[1].team_des+"</li>");if(n.currentMatchId=="")n.currentMatchId=i[e].match_id;o=true}}if(o){$(".lol-vote-wrap").removeClass("hide");$(".lol-vote-preview").addClass("hide");$("#vote-tab-list").html(s.join(""));$("#vote-tab-list").find("li").eq(0).addClass("current");n.matchTab();n.getVoteListInit(n.currentMatchId)}else{$(".lol-vote-preview").removeClass("hide");$(".lol-vote-wrap").addClass("hide");n.getNextGameTime()}}else{$(".lol-vote-preview").removeClass("hide");$(".lol-vote-wrap").addClass("hide");n.getNextGameTime()}}}})},getNextGameTime:function t(){var c=this;$.ajax({url:"https://www.huya.com/cacheapp.php",data:{m:"InternationMatchApi",do:"getDateMatchSchedule",mid:c.mid},dataType:"jsonp",jsonpCallback:"jsongetDateMatchSchedule",cacahe:true,success:function t(a){var e=new Date,i=["01","02","03","04","05","06","07","08","09","10","11","12"],s=e.getFullYear()+i[e.getMonth()]+(i[e.getDate()-1]||e.getDate()),o,n,l;for(o in a.data){if(o>=s){l=o;for(n in a.data[o]){if(a.nowTime<=a.data[o][n].endTime||a.data[o][n].endTime<=0){$("#bookTime").html(l.slice(4,8).slice(0,2)+"-"+l.slice(4,8).slice(2,4)+" "+c.formatTimeToCommon(a.data[o][n].startTime,3));$.ajax({url:"https://upevent.huya.com/getSubscribeState",data:{uid:("; "+document.cookie).split("; yyuid=").pop().split(";").shift(),event_ids:a.data[o][n].programId},dataType:"jsonp",success:function t(a){if(a.data[0].bSubscribe){$("#book").html("<i></i>已预约")}else{$("#book").html("<i></i>预约")}}});$("#book").off().on("click",function(){if(!c.isLogin){if(navigator.userAgent.match(/mobile/i)){HUYASdk.showLogin()}else{TT.login.login()}return}$.ajax({url:"https://www.huya.com/member/index.php",data:{m:"Upcoming",do:"subscribe",eid:a.data[o][n].programId,subscribe:$("#book").text()=="预约"?1:0},dataType:"jsonp",success:function t(a){if($("#book").text()=="预约"){c.showToast("预约成功！");$("#book").html("<i></i>已预约")}else{c.showToast("取消预约成功！");$("#book").html("<i></i>预约")}}})});return}}}}}})},formateTime:function t(a){var e=new Date(a),i=e.getMonth()+1,s=e.getDate(),o=e.getHours(),n=e.getMinutes(),l=this.getzf(i)+"-"+this.getzf(s)+" "+this.getzf(o)+":"+this.getzf(n);return l},getzf:function t(a){if(parseInt(a)<10){a="0"+a}return a},getVoteListInit:function t(a){var e=this,i=$("#vote-list"),s=[],o=[],n=[],l;i.attr("data-matchid",a);$.ajax({url:e.getUrl()+"activity.huya.com/txmatchvote/cache.php?m=MatchVoteApi&do=getVoteResult",data:{mid:e.mid,match_id:a},jsonpCallback:"jsonpFansgetVoteResult",cache:true,dataType:"jsonp",success:function t(a){if(a.status==200){if(!!a.data.vote_team.length){s.push('<div class="vote-list"><h2>'+(a.data.vote_team[0].team_side=="red"?"<i></i>红方":'<i class="vote-icon2"></i>蓝方')+"<span>"+a.data.vote_team[0].team_des+'</span></h2><ul class="player-list">');for(l in a.data.vote_player){if(a.data.vote_player[l].team_id==a.data.vote_team[0].team_id){o.push('<li data-player="'+a.data.vote_player[l].player_id+'"><img src="'+(a.data.vote_player[l].player_avatar||"https://hd.huya.com/appH5Mode/default.jpg")+'"><p>'+a.data.vote_player[l].player_des+"</p></li>")}else{n.push('<li data-player="'+a.data.vote_player[l].player_id+'"><img src="'+(a.data.vote_player[l].player_avatar||"https://hd.huya.com/appH5Mode/default.jpg")+'"><p>'+a.data.vote_player[l].player_des+"</p></li>")}}s.push(o.join(""));s.push('</ul></div><div class="vote-list"><h2>'+(a.data.vote_team[1].team_side=="red"?"<i></i>红方":'<i class="vote-icon2"></i>蓝方')+"<span>"+a.data.vote_team[1].team_des+'</span></h2><ul class="player-list">');s.push(n.join("")+"</ul></div>");i.html(s.join(""));e.currentPlayer()}}else{e.showToast(a.msg)}}})},matchTab:function t(){var i=this,s=$("#vote-tab-list");s.find("li").off().on("click",function(){var t=$(this),a=t.index();if(a>1){s.css("left",-1*(a-1)*105+"px")}else{s.css("left","0px")}i.payNum=10;$("#pay-num span").html(i.payNum);$(".current-icon").css("left",t.offset().left-$(".lol-vote-tab-warp").offset().left+"px");$(this).addClass("current").siblings().removeClass("current");var e=$(this).attr("data-matchid");i.getVoteListInit(e)})},remainPayNum:function t(){var e=this;$.ajax({url:e.getUrl()+"activity.huya.com/package/index.php?m=Api&do=queryPackageInfo",dataType:"jsonp",success:function t(a){if(a.status==200){if(!!a.data["9"]){$("#jindou").html(e.renderNum(a.data["9"].itemCount))}}}})},renderNum:function t(a){return(a||0).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,")},currentPlayer:function t(){$(".player-list").find("li").on("click",function(){$(".player-list").find("li").removeClass("select");$(this).addClass("select")})},votePlayer:function t(){var e=this;$("#vote").off().on("click",function(){if(!e.isLogin){if(navigator.userAgent.match(/mobile/i)){HUYASdk.showLogin()}else{TT.login.login()}return}if(!!$(".select").length){var t=$(".select").attr("data-player");$.ajax({url:e.getUrl()+"activity.huya.com/txmatchvote/index.php?m=MatchVoteApi&do=inputVote",data:{mid:e.mid,match_id:$("#vote-list").attr("data-matchid"),option_id:t,vote_num:e.payNum},dataType:"jsonp",success:function t(a){if(a.status==200){e.showToast("投票成功！");e.remainPayNum()}else{e.showToast(a.msg)}}})}else{e.showToast("请选择投票选手")}})},showToast:function t(a){var e=$(".toast");e.html(a);e.show();setTimeout(function(){e.hide()},1500)},payFunInit:function t(){var a=this;$("#pay-num span").html(this.payNum);$(".pay-list li").off().on("click",function(){a.payNum=$(this).find(".pay-num").text();$("#pay-num span").html(a.payNum);$("#pay-num").find("i").removeClass("close");$(".pay-list").removeClass("open")})},initPop:function t(){$(".current-icon").css("left",0);this.payListAni();this.getVoteTabList();this.remainPayNum();this.payFunInit();this.votePlayer();$(".vote-pc-pop").show()},init:function t(){var a=this;this.checkLogin();$("head").append('<link href="//hd.huya.com/20180809lolVote/css/pc.css" rel="stylesheet">');$("body").append(this.tpl);TTP.on("clickFansVote",function(){a.initPop()});$(".pop-close").on("click",function(){$(".vote-pc-pop").hide()});$("#charge").on("click",function(){if(navigator.userAgent.match(/mobile/i)){var t="yykiwi://openurl?banneraction=recharge%3a%2f%2fproduct_type%3d2";HUYASdk.openUrl({url:t})}else{$(".vote-pc-pop").hide();TT.emit("liveRoom_recharge")}})}};window.lolVote=t.init()})();